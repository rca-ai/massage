<!doctype html>
<html lang="ko">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë§ˆì‚¬ì§€ìƒµ ê´€ë¦¬ ì‹œìŠ¤í…œ (Supabase DB ì—°ë™) - V7.2</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&amp;family=Noto+Sans+Thai:wght@300;400;500;700&amp;family=Noto+Sans+Vietnamese:wght@300;400;500;700&amp;family=Roboto:wght@300;400;500;700&amp;family=Nanum+Gothic:wght@400;700;800&amp;display=swap" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
            font-family: Arial, sans-serif;
            font-size: 16px;
        }
        .remaining-time {
            font-size: 2rem;
            font-weight: bold;
            color: #ef4444;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 700px;
            max-height: 90%;
            overflow-y: auto;
        }
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .menu-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .duration-selection-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        .selection-item {
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .selection-item:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .selection-item.selected {
            border-color: #3b82f6;
            background-color: #3b82f6;
            color: white;
        }
        .edit-row {
            background-color: #f3f4f6;
        }
        .selected-staff-info {
            background-color: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .menu-row {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .required-label::after {
            content: " *";
            color: red;
            font-weight: bold;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="bg-gray-100 min-h-full"><div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600">
   <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md">
    <div class="text-center mb-8">
     <h1 class="text-3xl font-bold text-gray-800" data-translate="title">ë§ˆì‚¬ì§€ìƒµ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
     <div class="w-20 h-1 bg-blue-500 mx-auto"></div>
    </div><div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-2">ì–¸ì–´ ì„ íƒ / Language / à¸ à¸²à¸©à¸² / NgÃ´n ngá»¯</label>
     <div class="grid grid-cols-4 gap-2"><button onclick="setLanguage('ko')" class="bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600" id="langKo">í•œêµ­ì–´</button> <button onclick="setLanguage('en')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langEn">English</button> <button onclick="setLanguage('th')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langTh">à¹„à¸—à¸¢</button> <button onclick="setLanguage('vi')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langVi">Tiáº¿ng Viá»‡t</button>
     </div>
    </div>
    <div class="space-y-4">
     <div><label class="block text-sm font-medium text-gray-700 mb-2" data-translate="username">ì•„ì´ë”” (ì´ë©”ì¼)</label> <input type="text" id="loginUsername" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" data-translate-placeholder="usernameInput" placeholder="Supabase ì¸ì¦ ì´ë©”ì¼">
     </div>
     <div><label class="block text-sm font-medium text-gray-700 mb-2" data-translate="password">ë¹„ë°€ë²ˆí˜¸</label> <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" data-translate-placeholder="passwordInput" placeholder="Supabase ì¸ì¦ ë¹„ë°€ë²ˆí˜¸">
     </div><button onclick="processLogin()" class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition duration-200" data-translate="login">ë¡œê·¸ì¸</button>
    </div>
   </div>
  </div><div id="mainScreen" class="container mx-auto p-6" style="display: none;"><div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
     <div>
      <h1 class="text-3xl font-bold text-gray-800" data-translate="title">ë§ˆì‚¬ì§€ ê´€ë¦¬ í”„ë¡œê·¸ë¨</h1>
      <p id="shopName" class="text-lg text-gray-600 mt-1">Supabase DB ì—°ë™ í™”ë©´</p>
     </div>
     <div class="flex gap-2"><button onclick="showLanguageModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="changeLanguage">ì–¸ì–´ ë³€ê²½</button> <button onclick="showFontModal()" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600" data-translate="changeFont">í°íŠ¸ ë³€ê²½</button> <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600" data-translate="logout">ë¡œê·¸ì•„ì›ƒ</button>
     </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
     <div class="text-center"><label class="block text-sm font-medium mb-2" data-translate="todayDate">ì˜¤ëŠ˜ ë‚ ì§œ</label>
      <div class="flex gap-2"><input type="date" id="currentDate" class="border rounded px-3 py-2 flex-1"> <button onclick="confirmDateChange()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="confirmDate">í™•ì¸</button>
      </div>
     </div>
     <div class="text-center"><label class="block text-sm font-medium mb-2" data-translate="currentTime">í˜„ì¬ ì‹œê°„</label>
      <div id="currentTime" class="text-xl font-bold text-blue-600"></div>
     </div>
    </div>
   </div><div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6"><button onclick="showDashboard()" class="bg-blue-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-blue-600" data-translate="dashboard">í˜„í™©íŒ</button> <button onclick="showOrder()" class="bg-indigo-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-indigo-600" data-translate="order">ìˆœë²ˆ</button> <button onclick="showReservation()" class="bg-green-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-green-600" data-translate="reservation">ì˜ˆì•½</button> <button onclick="showStatistics()" class="bg-purple-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-purple-600" data-translate="statistics">í†µê³„</button> <button onclick="showDBManagement()" id="dbManagementButton" class="bg-orange-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-orange-600" data-translate="dbManagement">DB ê´€ë¦¬</button>
   </div><div id="orderSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="orderManagement">ìˆœë²ˆ ê´€ë¦¬</h2>
    <div class="mb-4"><button onclick="saveStaffOrder()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="saveOrder">ìˆœë²ˆ ì €ì¥</button>
    </div>
    <div class="overflow-x-auto">
     <table class="w-full border-collapse border border-gray-300">
      <thead>
       <tr class="bg-gray-100">
        <th class="border border-gray-300 p-2" data-translate="staffName">ì§ì›ëª…</th>
        <th class="border border-gray-300 p-2" data-translate="status">ìƒíƒœ</th>
        <th class="border border-gray-300 p-2" data-translate="orderNumber">ìˆœë²ˆ</th>
       </tr>
      </thead>
      <tbody id="orderTable">
      </tbody>
     </table>
    </div>
    <div class="mt-4 text-sm text-gray-600" data-translate="orderZeroVacationNote">
     * ìˆœë²ˆ 0ì€ íœ´ê°€ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
    </div>
   </div><div id="dashboardSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="dashboard">í˜„í™©íŒ</h2>
    <div class="overflow-x-auto">
     <table class="w-full border-collapse border border-gray-300">
      <thead>
       <tr class="bg-gray-100">
        <th class="border border-gray-300 p-2" data-translate="staff">ì§ì›ëª…</th>
        <th class="border border-gray-300 p-2" data-translate="menu">ë©”ë‰´</th>
        <th class="border border-gray-300 p-2" data-translate="duration">ì‹œê°„</th>
        <th class="border border-gray-300 p-2" data-translate="startTime">ì‹œì‘ì‹œê°„</th>
        <th class="border border-gray-300 p-2" data-translate="endTime">ëì‹œê°„</th>
        <th class="border border-gray-300 p-2" data-translate="remainingTime">ë‚¨ì€ì‹œê°„</th>
        <th class="border border-gray-300 p-2" data-translate="price">ê°€ê²©</th>
        <th class="border border-gray-300 p-2" data-translate="commission">ì»¤ë¯¸ì…˜</th>
        <th class="border border-gray-300 p-2" data-translate="roomNumber">ë°©ë²ˆí˜¸</th>
        <th class="border border-gray-300 p-2" data-translate="actions">ì‘ì—…</th>
       </tr>
      </thead>
      <tbody id="dashboardTable">
      </tbody>
     </table>
    </div>
   </div><div id="reservationSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="reservation">ì˜ˆì•½</h2><div class="mb-6"><label class="block text-sm font-medium mb-2 required-label" data-translate="selectStaff">ì§ì› ì„ íƒ</label>
     <div id="staffSelectionContainer">
      <div id="staffSelection" class="selection-grid"></div>
      <div id="selectedStaffInfo" class="selected-staff-info" style="display: none;">
       <div class="flex justify-between items-center">
        <div>
         <h4 class="font-bold text-lg">ì„ íƒëœ ì§ì›: <span id="selectedStaffName"></span></h4>
         <p class="text-sm text-gray-600">ìˆœë²ˆ: <span id="selectedStaffOrder"></span></p>
        </div><button onclick="changeStaff()" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">ì§ì› ë³€ê²½</button>
       </div>
      </div>
     </div>
    </div><div id="menuListContainer" style="display: none;">
     <div class="flex justify-between items-center mb-4"><label class="block text-sm font-medium required-label">ë©”ë‰´ ëª©ë¡</label> <button onclick="addMenuRow()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 flex items-center gap-2"> <span class="text-lg">+</span> ë©”ë‰´ ì¶”ê°€ </button>
     </div>
     <div id="menuRows"></div><div class="mt-6 p-4 bg-gray-100 rounded">
      <div class="grid grid-cols-2 gap-4">
       <div>
        <strong data-translate="totalPrice">ì´ ê°€ê²©:</strong> <span id="totalPrice">0</span><span id="totalPriceCurrency"></span>
       </div>
       <div>
        <strong data-translate="totalCommission">ì´ ì»¤ë¯¸ì…˜:</strong> <span id="totalCommission">0</span><span id="totalCommissionCurrency"></span>
       </div>
      </div>
     </div><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
      <div><label class="block text-sm font-medium mb-2" data-translate="startTime">ì‹œì‘ ì‹œê°„ (ì„ íƒì‚¬í•­)</label> <input type="time" id="reservationStartTime" class="w-full border rounded px-3 py-2" onchange="updateAllMenuTimes()">
      </div>
      <div><label class="block text-sm font-medium mb-2" data-translate="roomNumber">ë°©ë²ˆí˜¸ (ì„ íƒì‚¬í•­)</label> <select id="reservationRoom" class="w-full border rounded px-3 py-2"> <option value="" data-translate="selectRoom">ë°© ì„ íƒ</option> </select>
      </div>
      <div><label class="block text-sm font-medium mb-2" data-translate="customerName">ê³ ê°ëª… (ì„ íƒì‚¬í•­)</label> <input type="text" id="reservationCustomer" class="w-full border rounded px-3 py-2" data-translate-placeholder="enterCustomerName">
      </div>
     </div><div id="menuTimeSettings" class="mt-6" style="display: none;">
      <h4 class="font-bold mb-3">ë©”ë‰´ë³„ ì‹œê°„ ì„¤ì •</h4>
      <div id="menuTimeList" class="space-y-3">
      </div>
     </div><button onclick="addReservation()" class="mt-6 bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600" data-translate="addReservation">ì˜ˆì•½ ì¶”ê°€</button>
    </div>
   </div><div id="statisticsSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="statistics">í†µê³„</h2>
    <div class="mb-4 flex gap-4 flex-wrap"><button onclick="showDailyStats()" id="dailyStatsBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="daily">ì¼ê°„</button> <button onclick="showWeeklyStats()" id="weeklyStatsBtn" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" data-translate="weekly">ì£¼ê°„</button> <button onclick="showMonthlyStats()" id="monthlyStatsBtn" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" data-translate="monthly">ì›”ê°„</button> <button onclick="showMenuSales()" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600" data-translate="monthlyMenuSales">ì›”ê°„ ë©”ë‰´ ë§¤ì¶œ</button> <button onclick="showMonthlySalesChart()" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600" data-translate="monthlySalesChart">ì›”ê°„ ë§¤ì¶œ ê·¸ë˜í”„</button> <button onclick="downloadExcel()" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700" data-translate="download">ë‹¤ìš´ë¡œë“œ</button>
    </div><div class="mb-6 p-4 bg-gray-50 rounded"><div id="dailyDateSelection" class="mb-4"><label class="block text-sm font-medium mb-2" data-translate="selectDate">ë‚ ì§œ ì„ íƒ</label> <input type="date" id="statsDate" class="border rounded px-3 py-2" onchange="updateStats()">
     </div><div id="rangeDateSelection" class="grid grid-cols-1 md:grid-cols-2 gap-4" style="display: none;">
      <div><label class="block text-sm font-medium mb-2" data-translate="startDate">ì‹œì‘ ë‚ ì§œ</label> <input type="date" id="statsStartDate" class="w-full border rounded px-3 py-2" onchange="autoSetEndDate()">
      </div>
      <div><label class="block text-sm font-medium mb-2" data-translate="endDate">ë ë‚ ì§œ</label> <input type="date" id="statsEndDate" class="w-full border rounded px-3 py-2" onchange="updateStats()">
      </div>
     </div><div id="quickDateSelection" class="mt-3 flex gap-2 flex-wrap" style="display: none;"><button onclick="setThisWeek()" class="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm hover:bg-blue-200" data-translate="thisWeek">ì´ë²ˆ ì£¼</button> <button onclick="setLastWeek()" class="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm hover:bg-blue-200" data-translate="lastWeek">ì§€ë‚œ ì£¼</button> <button onclick="setThisMonth()" class="bg-green-100 text-green-700 px-3 py-1 rounded text-sm hover:bg-green-200" data-translate="thisMonth">ì´ë²ˆ ë‹¬</button> <button onclick="setLastMonth()" class="bg-green-100 text-green-700 px-3 py-1 rounded hover:bg-green-200" data-translate="lastMonth">ì§€ë‚œ ë‹¬</button>
     </div>
    </div><div id="chartContainer" class="mb-6" style="display: none;">
     <canvas id="statsChart" width="800" height="400"></canvas>
    </div><div class="mb-6">
     <h3 class="text-lg font-bold mb-2" data-translate="staffStatisticsTitle">ì§ì›ë³„ í†µê³„</h3>
     <div class="overflow-x-auto">
      <table class="w-full border-collapse border border-gray-300">
       <thead>
        <tr class="bg-gray-100">
         <th class="border border-gray-300 p-2" data-translate="staff">ë§ˆì‚¬ì§€ì‚¬</th>
         <th class="border border-gray-300 p-2" data-translate="totalPrice">ì´ ê°€ê²©</th>
         <th class="border border-gray-300 p-2" data-translate="totalCommission">ì´ ì»¤ë¯¸ì…˜</th>
        </tr>
       </thead>
       <tbody id="statsTable">
       </tbody>
      </table>
     </div>
    </div><div class="mb-6">
     <h3 class="text-lg font-bold mb-2" data-translate="paymentMethodStatisticsTitle">ì…ê¸ˆë°©ì‹ë³„ í†µê³„</h3>
     <div class="overflow-x-auto">
      <table class="w-full border-collapse border border-gray-300">
       <thead>
        <tr class="bg-gray-100">
         <th class="border border-gray-300 p-2" data-translate="paymentMethodColumn">ì…ê¸ˆë°©ì‹</th>
         <th class="border border-gray-300 p-2" data-translate="amountColumn">ê¸ˆì•¡</th>
        </tr>
       </thead>
       <tbody id="paymentStatsTable">
       </tbody>
      </table>
     </div>
    </div>
    <div class="p-4 bg-gray-100 rounded">
     <div class="grid grid-cols-3 gap-4">
      <div>
       <strong data-translate="grandTotal">ì´ ê¸ˆì•¡(QRíŒ ì œì™¸):</strong> <span id="grandTotalPrice">0</span><span id="grandTotalCurrency"></span>
      </div>
      <div>
       <strong data-translate="grandTotalCommission">ì´ ì»¤ë¯¸ì…˜:</strong> <span id="grandTotalCommission">0</span><span id="grandTotalCommissionCurrency"></span>
      </div>
      <div>
       <strong data-translate="profit">ìˆ˜ìµ:</strong> <span id="totalProfit">0</span><span id="totalProfitCurrency"></span>
      </div>
     </div>
    </div>
   </div><div id="dbManagementSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="dbManagement">DB ê´€ë¦¬</h2><div class="mb-6 p-4 bg-gray-100 rounded">
     <h3 class="text-lg font-bold mb-2" data-translate="dataBackupRestoreTitle">ë°ì´í„° ë°±ì—… ë° ë³µì›</h3>
     <div class="grid grid-cols-2 gap-4">
      <div>
       <h4 class="font-semibold mb-2" data-translate="backupButton">ë°±ì—…</h4>
       <div class="flex gap-2 flex-wrap"><button onclick="showLocalBackupDialog()" class="bg-green-600 text-white px-3 py-2 rounded hover:bg-green-700 text-sm" data-translate="localBackupButton">ë¡œì»¬ ë°±ì—…</button> <button onclick="showGoogleBackupDialog()" class="bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 text-sm" data-translate="googleBackupButton">êµ¬ê¸€ ë°±ì—…</button>
       </div>
      </div>
      <div>
       <h4 class="font-semibold mb-2" data-translate="restoreButton">ë³µì›</h4>
       <div class="flex gap-2 flex-wrap"><input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreData(event)"> <button onclick="showLocalRestoreDialog()" class="bg-orange-600 text-white px-3 py-2 rounded hover:bg-orange-700 text-sm" data-translate="localRestoreButton">ë¡œì»¬ ë³µì›</button> <button onclick="showGoogleRestoreDialog()" class="bg-indigo-600 text-white px-3 py-2 rounded hover:bg-indigo-700 text-sm" data-translate="googleRestoreButton">êµ¬ê¸€ ë³µì›</button>
       </div>
      </div>
     </div>
     <div class="mt-4"><button onclick="exportAllDataExcel()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700" data-translate="exportAllDataButton">ì „ì²´ ë°ì´í„° ì—‘ì…€ ë‚´ë³´ë‚´ê¸°</button>
     </div>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4"><button onclick="manageMenus()" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600" data-translate="menuManagement">ë©”ë‰´ ê´€ë¦¬</button> <button onclick="manageStaff()" class="bg-green-500 text-white py-3 px-4 rounded hover:bg-green-600" data-translate="staffManagement">ì§ì› ê´€ë¦¬</button> <button onclick="manageRooms()" class="bg-purple-500 text-white py-3 px-4 rounded hover:bg-purple-600" data-translate="roomManagement">ë°© ê´€ë¦¬</button> <button onclick="manageCustomers()" class="bg-orange-500 text-white py-3 px-4 rounded hover:bg-orange-600" data-translate="customerManagement">ê³ ê° ê´€ë¦¬</button> <button onclick="manageCurrency()" class="bg-pink-500 text-white py-3 px-4 rounded hover:bg-pink-600" data-translate="currencyManagement">í™”í ë‹¨ìœ„</button> <button onclick="managePaymentMethods()" class="bg-yellow-500 text-white py-3 px-4 rounded hover:bg-yellow-600" data-translate="paymentMethodManagement">ì…ê¸ˆë°©ì‹ ê´€ë¦¬</button> <button onclick="manageGuarantee()" class="bg-teal-500 text-white py-3 px-4 rounded hover:bg-teal-600">Guarantee ê´€ë¦¬</button>
     <div id="superAdminButtons" style="display: block;"><button onclick="manageAdmins()" class="bg-red-500 text-white py-3 px-4 rounded hover:bg-red-600" data-translate="adminManagement">ê´€ë¦¬ì ê´€ë¦¬</button>
     </div>
    </div>
   </div>
  </div><div id="paymentModal" class="modal">
   <div class="modal-content">
    <h3 class="text-xl font-bold mb-4" data-translate="payment">ì…ê¸ˆ ì²˜ë¦¬</h3>
    <div id="paymentMethods" class="space-y-4 mb-4">
    </div>
    <div class="mb-4"><strong data-translate="totalAmount">ì´ ê¸ˆì•¡:</strong> <span id="paymentTotalAmount">0</span><span id="paymentCurrency"></span>
    </div>
    <div class="mb-4"><strong data-translate="enteredAmount">ì…ë ¥ëœ ê¸ˆì•¡:</strong> <span id="paymentEnteredAmount">0</span><span id="paymentEnteredCurrency"></span>
    </div>
    <div class="flex gap-2"><button onclick="processPayment()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-translate="confirm">í™•ì¸</button> <button onclick="closePaymentModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="cancel">ì·¨ì†Œ</button>
    </div>
   </div>
  </div><div id="managementModal" class="modal">
   <div class="modal-content">
    <h3 id="managementTitle" class="text-xl font-bold mb-4"></h3>
    <div id="managementContent"></div><button onclick="closeManagementModal()" class="mt-4 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="close">ë‹«ê¸°</button>
   </div>
  </div><div id="languageModal" class="modal">
   <div class="modal-content">
    <h3 class="text-xl font-bold mb-4">ì–¸ì–´ ì„ íƒ / Language / à¸ à¸²à¸©à¸² / NgÃ´n ngá»¯</h3>
    <div class="grid grid-cols-2 gap-4"><button onclick="setLanguageAndClose('ko')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">í•œêµ­ì–´</button> <button onclick="setLanguageAndClose('en')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">English</button> <button onclick="setLanguageAndClose('th')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">à¹„à¸—à¸¢</button> <button onclick="setLanguageAndClose('vi')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">Tiáº¿ng Viá»‡t</button>
    </div><button onclick="closeLanguageModal()" class="mt-4 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">ë‹«ê¸°</button>
   </div>
  </div><div id="fontModal" class="modal">
   <div class="modal-content">
    <h3 class="text-xl font-bold mb-4" data-translate="fontSelection">í°íŠ¸ ì„ íƒ</h3><div class="mb-6 p-4 bg-gray-50 rounded">
     <h4 class="font-bold mb-3" data-translate="fontSize">í°íŠ¸ í¬ê¸°</h4>
     <div class="grid grid-cols-5 gap-2"><button onclick="setFontSize('small')" id="fontSizeSmall" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeSmall">ì‘ê²Œ</button> <button onclick="setFontSize('normal')" id="fontSizeNormal" class="bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600" data-translate="fontSizeNormal">ë³´í†µ</button> <button onclick="setFontSize('large')" id="fontSizeLarge" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeLarge">í¬ê²Œ</button> <button onclick="setFontSize('xlarge')" id="fontSizeXLarge" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeXLarge">ë§¤ìš° í¬ê²Œ</button> <button onclick="setFontSize('xxlarge')" id="fontSizeXXLarge" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeXXLarge">ìµœëŒ€</button>
     </div>
     <div class="mt-2 text-sm text-gray-600" data-translate="fontSizePreview"><span id="fontSizePreview">ë¯¸ë¦¬ë³´ê¸° í…ìŠ¤íŠ¸ - Preview Text - à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ - VÄƒn báº£n xem trÆ°á»›c</span>
     </div>
    </div><div class="mb-4">
     <h4 class="font-bold mb-3" data-translate="fontFamily">í°íŠ¸ ì¢…ë¥˜</h4>
     <div class="grid grid-cols-1 gap-3"><button onclick="setFontFamily('Arial')" id="fontFamilyArial" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600" style="font-family: Arial;">Arial (ê¸°ë³¸)</button> <button onclick="setFontFamily('Noto Sans KR')" id="fontFamilyNotoKR" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Noto Sans KR', sans-serif;">Noto Sans KR (í•œê¸€ ìµœì í™”)</button> <button onclick="setFontFamily('Malgun Gothic')" id="fontFamilyMalgun" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Malgun Gothic', sans-serif;">ë§‘ì€ ê³ ë”•</button> <button onclick="setFontFamily('Nanum Gothic')" id="fontFamilyNanum" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Nanum Gothic', sans-serif;">ë‚˜ëˆ”ê³ ë”•</button> <button onclick="setFontFamily('Roboto')" id="fontFamilyRoboto" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Roboto', sans-serif;">Roboto (ì˜ë¬¸ ìµœì í™”)</button> <button onclick="setFontFamily('Noto Sans Thai')" id="fontFamilyThai" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Noto Sans Thai', sans-serif;">Noto Sans Thai (íƒœêµ­ì–´)</button> <button onclick="setFontFamily('Noto Sans Vietnamese')" id="fontFamilyVietnamese" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Noto Sans Vietnamese', sans-serif;">Noto Sans Vietnamese (ë² íŠ¸ë‚¨ì–´)</button>
     </div>
    </div>
    <div class="flex gap-2"><button onclick="applyFontSettings()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-translate="apply">ì ìš©</button> <button onclick="closeFontModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="close">ë‹«ê¸°</button>
    </div>
   </div>
  </div><div id="googleLoginModal" class="modal">
   <div class="modal-content">
    <h3 class="text-xl font-bold mb-4">êµ¬ê¸€ ê³„ì • ë¡œê·¸ì¸</h3>
    <div class="space-y-4">
     <div><label class="block text-sm font-medium mb-2">êµ¬ê¸€ ì´ë©”ì¼:</label> <input type="email" id="googleEmail" class="w-full border rounded px-3 py-2" placeholder="example@gmail.com">
     </div>
     <div><label class="block text-sm font-medium mb-2">êµ¬ê¸€ ë¹„ë°€ë²ˆí˜¸:</label> <input type="password" id="googlePassword" class="w-full border rounded px-3 py-2" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
     </div>
     <div class="text-sm text-gray-600">
      * ì‹¤ì œ êµ¬ê¸€ ê³„ì • ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ë°±ì—…/ë³µì›ì„ ìœ„í•´ êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ì ‘ê·¼í•©ë‹ˆë‹¤.
     </div>
    </div>
    <div class="flex gap-2 mt-4"><button id="googleLoginConfirm" onclick="processGoogleLogin()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">ë¡œê·¸ì¸</button> <button onclick="closeGoogleLoginModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">ì·¨ì†Œ</button>
    </div>
   </div>
  </div>
  <script>
        // =========================================================================
        // V7.2: Supabase Client & Constants (URL/KEY ìµœì¢… ì—…ë°ì´íŠ¸)
        // =========================================================================
        const SUPABASE_URL = 'https://requjozkxlxomoamdrrf.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJlcXVqb3preGx4b21vYW1kcnJmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzMDM1NjYsImV4cCI6MjA3ODg3OTU2Nn0.LpZyM2K12EShRAZyptk6Ak2XDkxQ-WuUPklTZfqt_Tg';

        // ğŸš¨ CRITICAL FIX: Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ë°©ì‹ ìˆ˜ì •
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        console.log('Supabase Client Initialized! (V7.2 - Final URL)');
        
        const ADMIN_ROLES = {
            SUPER_USER: 'ìµœê³ ê´€ë¦¬ì',
            SHOP_MANAGER: 'ìƒ¾ê´€ë¦¬ì',
            SHOP_STAFF: 'ìƒ¾ì§ì›'
        };

        // =========================================================================
        // 3. Supabase DB CRUD í•¨ìˆ˜ (Shop ID í•„í„°ë§/ì£¼ì… ì ìš©)
        // =========================================================================

        /** ì§ì› ë°ì´í„° ë¡œë“œ (staff í…Œì´ë¸” ì¡°íšŒ) */
        async function getStaffData() {
            // RLSê°€ í•´ì œë˜ì—ˆë‹¤ê³  ê°€ì •í•˜ê³  ì „ì²´ ì¡°íšŒ (ë””ë²„ê¹… ëª©ì )
            const { data, error } = await supabaseClient.from('staff')
                .select('*')
                .order('name', { ascending: true });
            if (error) { console.error('Error fetching staff data:', error.message); return []; }
            return data;
        }
        
        /** ë©”ë‰´ ë°ì´í„° ë¡œë“œ (menus í…Œì´ë¸” ì¡°íšŒ) */
        async function getMenusData() {
            const { data, error } = await supabaseClient.from('menus')
                .select('id, name, prices')
                .order('id', { ascending: true }); 
            if (error) { console.error('Error fetching menus data:', error.message); return []; }
            return data;
        }

        /** ë°© ë°ì´í„° ë¡œë“œ (rooms í…Œì´ë¸” ì¡°íšŒ) */
        async function getRoomsData() {
            const { data: rooms, error } = await supabaseClient.from('rooms')
                .select('id, room_number, capacity')
                .order('room_number', { ascending: true }); 
            if (error) { console.error('Error fetching rooms data:', error.message); return []; }
            return rooms.map(r => ({id: r.id, roomNumber: r.room_number, capacity: r.capacity}));
        }

        /** ì˜ˆì•½ ë°ì´í„° ë¡œë“œ (reservations í…Œì´ë¸” ì¡°íšŒ) */
        async function getReservationsData(date) {
            const { data: reservations, error } = await supabaseClient.from('reservations')
                .select('*')
                .eq('date', date); 
            if (error) { console.error('Error fetching reservations data:', error.message); return []; }
             return reservations.map(r => ({
                id: r.id, date: r.date, staffId: r.staff_id, menuId: r.menu_id, duration: r.duration, 
                startTime: r.start_time, roomId: r.room_id, customerName: r.customer_name, price: r.price, 
                commission: r.commission, paid: r.paid, paymentDetails: r.payment_details,
                menuOrder: r.menu_order, isMultiMenu: r.is_multi_menu
            }));
        }

        /** ì…ê¸ˆ ë°©ì‹ ë°ì´í„° ë¡œë“œ (payment_methods í…Œì´ë¸” ì¡°íšŒ) */
        async function getPaymentMethodsData() {
             const { data, error } = await supabaseClient.from('payment_methods')
                .select('id, name')
                .order('id', { ascending: true }); 
            if (error) { 
                console.error('Error fetching payment methods data:', error.message); 
                return []; 
            }
            return data;
        }

        /** Guarantee ë°ì´í„° ë¡œë“œ (guarantees í…Œì´ë¸” ì¡°íšŒ) */
        async function getGuaranteeData() {
            const { data, error } = await supabaseClient.from('guarantees')
                .select('*')
                .order('id', { ascending: true });
            if (error) { console.error('Error fetching guarantee data:', error.message); return []; }
            return data;
        }
        
        // ... (ë‚˜ë¨¸ì§€ CRUD í•¨ìˆ˜ëŠ” ìƒëµ. V6.0ê³¼ ë™ì¼í•œ ë¡œì§ ì‚¬ìš©) ...
        async function saveNewReservations(reservationsArray) { /* ... */ }
        async function deleteReservationFromDB(id) { /* ... */ }
        async function updateReservationInDB(id, updateData) { /* ... */ }
        async function upsertData(tableName, data, id = null) { /* ... */ }
        async function deleteData(tableName, id) { /* ... */ }


        // =========================================================================
        // 4. ì´ˆê¸°í™” ë° ì¸ì¦ ë¡œì§ (Admin Role ë¡œì§ ë³µêµ¬)
        // =========================================================================
        
        async function loadAdminDetails(userId) {
            // RLSê°€ í•´ì œë˜ì—ˆìœ¼ë¯€ë¡œ, ì´ ì¡°íšŒëŠ” ì„±ê³µí•´ì•¼ í•©ë‹ˆë‹¤.
            const { data, error } = await supabaseClient
                .from('shop_admins')
                .select('role, shop_id, name')
                .eq('id', userId)
                .single();

            if (error && error.code !== 'PGRST116') {
                 console.error('Error fetching admin role (Code: %s): %s', error.code, error.message);
            }
            
            // DBì— ì •ë³´ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì„¤ì • (ìƒ¾ì§ì›)
            const role = data ? data.role : ADMIN_ROLES.SHOP_STAFF;
            const shopId = data ? data.shop_id : 'default_shop';

            let shopName;
            if (role === ADMIN_ROLES.SUPER_USER) {
                shopName = `[${role}] ì‹œìŠ¤í…œ ì „ì²´ ê´€ë¦¬`;
            } else {
                shopName = `[${shopId}] ${role} í™”ë©´`;
            }

            return {
                role: role,
                shopId: shopId,
                shopName: shopName
            };
        }

        // ì „ì—­ ë³€ìˆ˜ (V6.0ì˜ ì „ì—­ ë³€ìˆ˜ ì •ì˜ë¥¼ ì—¬ê¸°ì— ë³µì‚¬)
        let currentLanguage = 'ko';
        let currentFont = 'Arial';
        let currentFontSize = 'normal';
        let selectedFontFamily = 'Arial';
        let selectedFontSize = 'normal';
        let currentAdmin = { 
            id: null,
            username: null,
            type: ADMIN_ROLES.SHOP_STAFF, 
            shopId: 'default_shop', 
            shopName: 'ë¯¸ë¡œê·¸ì¸' 
        };
        let currentPaymentReservationId = null;
        let selectedStaff = null;
        let menuRowCounter = 0;
        let menuRows = [];
        let currency = { symbol: 'â‚©', name: 'ì›' }; // ì„ì‹œ ê¸°ë³¸ê°’

        async function initializeApp() {
            try {
                updateCurrentTime();
                setInterval(updateCurrentTime, 1000);
                
                const currentDateElement = document.getElementById('currentDate');
                if (currentDateElement) {
                    currentDateElement.value = new Date().toISOString().split('T')[0];
                }
                
                // í°íŠ¸ ì„¤ì • ë¡œì§ (ìƒëµ)

                const { data: { session } } = await supabaseClient.auth.getSession();

                if (session) {
                    const adminDetails = await loadAdminDetails(session.user.id);
                    
                    currentAdmin.id = session.user.id;
                    currentAdmin.username = session.user.email;
                    currentAdmin.type = adminDetails.role;
                    currentAdmin.shopId = adminDetails.shopId;
                    currentAdmin.shopName = adminDetails.shopName;
                    
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainScreen').style.display = 'block';
                    document.getElementById('shopName').textContent = currentAdmin.shopName;

                    console.log(`[AUTH CHECK] User Role Loaded: ${currentAdmin.type}, Shop ID: ${currentAdmin.shopId}`);
                    updateUIAccess(); 
                    loadReservationData();
                    showDashboard();
                } else {
                    document.getElementById('loginScreen').style.display = 'flex';
                    document.getElementById('mainScreen').style.display = 'none';
                }
            } catch (error) {
                console.error('ì•± ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
            }
        }

        async function processLogin() {
            const email = document.getElementById('loginUsername').value; 
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('ì•„ì´ë””(ì´ë©”ì¼)ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });

            if (error) {
                // ğŸš¨ ë¡œê·¸ì¸ ì—ëŸ¬ê°€ ê³„ì† ë°œìƒí•˜ëŠ”ì§€ í™•ì¸
                alert('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ë˜ëŠ” Supabase ì¸ì¦ì„ í™•ì¸í•˜ì„¸ìš”.)\n' + error.message);
                return;
            }

            if (data.user) {
                 const adminDetails = await loadAdminDetails(data.user.id);

                currentAdmin.id = data.user.id;
                currentAdmin.username = data.user.email;
                currentAdmin.type = adminDetails.role;
                currentAdmin.shopId = adminDetails.shopId;
                currentAdmin.shopName = adminDetails.shopName;

                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainScreen').style.display = 'block';
                document.getElementById('shopName').textContent = currentAdmin.shopName;
                
                console.log(`[AUTH CHECK] User Role Loaded: ${currentAdmin.type}, Shop ID: ${currentAdmin.shopId}`); 
                updateUIAccess(); 
                loadReservationData();
                showDashboard();
            } else {
                alert('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜)');
            }
        }
        
        // ... (ë‚˜ë¨¸ì§€ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ë° ì˜ˆì•½, DB ê´€ë¦¬ í•¨ìˆ˜ëŠ” V6.0 êµ¬í˜„ë¶€ë¥¼ ì‚¬ìš©) ...

        // =========================================================================
        // 5. ìœ í‹¸ë¦¬í‹° ë° UI ë¡œì§ (DB ê´€ë¦¬ ë©”ë‰´ ì ‘ê·¼ ì œì–´)
        // =========================================================================

        function updateUIAccess() {
            const dbManagementButton = document.getElementById('dbManagementButton');
            const isAdminOrManager = currentAdmin.type === ADMIN_ROLES.SUPER_USER || currentAdmin.type === ADMIN_ROLES.SHOP_MANAGER;

            if (dbManagementButton) {
                dbManagementButton.style.display = isAdminOrManager ? 'block' : 'none';
            }
            
            const superAdminButtons = document.getElementById('superAdminButtons');
            if (superAdminButtons) {
                superAdminButtons.style.display = currentAdmin.type === ADMIN_ROLES.SUPER_USER ? 'block' : 'none';
            }
        }

        // ... (ë‚˜ë¨¸ì§€ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜: hideAllSections, showDashboard, showReservation ë“±) ...
        function hideAllSections() {
            const sections = ['dashboardSection', 'orderSection', 'reservationSection', 'statisticsSection', 'dbManagementSection'];
            sections.forEach(section => {
                document.getElementById(section).style.display = 'none';
            });
        }
        function showDashboard() { hideAllSections(); document.getElementById('dashboardSection').style.display = 'block'; loadDashboard(); }
        function showReservation() { hideAllSections(); document.getElementById('reservationSection').style.display = 'block'; loadReservationData(); }

        // =========================================================================
        // 6. ì˜ˆì•½ ë° ëŒ€ì‹œë³´ë“œ ë¡œì§ (ë””ë²„ê·¸ ë¡œê·¸ ì‚½ì…)
        // =========================================================================

        async function loadStaffSelection() {
            const staff = await getStaffData(); 
            
            console.log('[DEBUG-STAFF] Staff Data Fetched:', staff); 
            if (staff.length === 0) {
                 console.warn('[DEBUG-STAFF] Staff data is EMPTY. Check your "staff" table in Supabase.');
            }

            const currentDate = document.getElementById('currentDate').value;
            const staffOrder = JSON.parse(localStorage.getItem(getDailyStaffOrderKey(currentDate)) || '{}'); 
            const reservations = await getReservationsData(currentDate); 
            
            const activeStaff = staff.filter(s => s.status !== 'í‡´ì‚¬');
            // ... (ì´í•˜ ì§ì› ëª©ë¡ UI ë Œë”ë§ ë¡œì§ì€ V6.0 êµ¬í˜„ë¶€ë¥¼ ì‚¬ìš©) ...
            
            activeStaff.sort((a, b) => {
                const orderA = staffOrder[a.id] !== undefined ? staffOrder[a.id] : 999;
                const orderB = staffOrder[b.id] !== undefined ? staffOrder[b.id] : 999;
                if (orderA === 0 && orderB !== 0) return 1;
                if (orderA !== 0 && orderB === 0) return -1;
                return orderA - orderB;
            });
            
            const container = document.getElementById('staffSelection');
            container.innerHTML = '';

            activeStaff.forEach(s => {
                const order = staffOrder[s.id] !== undefined ? staffOrder[s.id] : 1;
                const isOnVacation = order === 0;
                const hasReservation = reservations.some(r => r.staffId === s.id && !r.paid && r.startTime);
                
                const div = document.createElement('div');
                div.className = 'selection-item';
                div.setAttribute('data-staff-id', s.id);
                
                let bgColor = 'transparent';
                let cursor = 'pointer';
                if (hasReservation) {
                    bgColor = '#9ca3af';
                    cursor = 'not-allowed';
                } else if (isOnVacation) {
                    bgColor = '#9ca3af';
                    cursor = 'not-allowed';
                }
                
                if (bgColor !== 'transparent') {
                    div.style.backgroundColor = bgColor;
                    div.style.color = 'white';
                    div.style.cursor = cursor;
                }

                const vacationText = translations[currentLanguage].vacationStatus || 'íœ´ê°€';
                div.textContent = `${s.name} (${order === 0 ? vacationText : order})`;
                
                if (!hasReservation && !isOnVacation) {
                    div.onclick = () => selectStaff(s.id, s.name, order, div);
                }
                
                container.appendChild(div);
            });
        }
        
        async function loadDashboard() {
            const currentDate = document.getElementById('currentDate').value;
            
            const todayReservations = await getReservationsData(currentDate);
            
            console.log('[DEBUG-DASHBOARD] Reservations Fetched:', todayReservations);
            if (todayReservations.length === 0) {
                 console.warn('[DEBUG-DASHBOARD] Reservation data is EMPTY for today. Check your "reservations" table.');
            }

            const staffOrder = JSON.parse(localStorage.getItem(getDailyStaffOrderKey(currentDate)) || '{}');
            const staffList = await getStaffData(); 
            const menuList = await getMenusData();
            const roomList = await getRoomsData();

            todayReservations.sort((a, b) => {
                const orderA = staffOrder[a.staffId] || 999;
                const orderB = staffOrder[b.staffId] || 999;
                return orderA - orderB;
            });
            
            const tableBody = document.getElementById('dashboardTable');
            tableBody.innerHTML = '';
            
            // ... (ì´í•˜ ëŒ€ì‹œë³´ë“œ UI ë Œë”ë§ ë¡œì§ì€ V6.0 êµ¬í˜„ë¶€ë¥¼ ì‚¬ìš©) ...

            todayReservations.forEach(reservation => {
                const staffId = reservation.staffId;
                const startTime = reservation.startTime;
                const duration = reservation.duration;
                const paid = reservation.paid;
                const price = reservation.price;
                const commission = reservation.commission;
                const roomId = reservation.roomId;
                const menuOrder = reservation.menuOrder;
                const isMultiMenu = reservation.isMultiMenu;

                const staffInfo = staffList.find(s => s.id === staffId) || { name: 'ì•Œ ìˆ˜ ì—†ìŒ' };
                const menuInfo = menuList.find(m => m.id === reservation.menuId) || { name: 'ì•Œ ìˆ˜ ì—†ìŒ' };
                const roomInfo = roomList.find(r => r.id == roomId) || { roomNumber: '-' };


                const row = document.createElement('tr');
                const endTime = calculateEndTime(startTime, duration);
                const remainingMinutes = calculateRemainingTime(startTime, duration, reservation.date);
                
                if (paid) {
                    row.className = 'bg-green-50';
                }
                
                const currentCurrency = currency;
                
                const staffOrderNum = staffOrder[staffId] !== undefined ? staffOrder[staffId] : 1;
                const vacationText = translations[currentLanguage].vacationStatus || 'íœ´ê°€';
                const staffDisplayName = staffOrderNum === 0 ? `${staffInfo.name} (${vacationText})` : `${staffOrderNum}. ${staffInfo.name}`;
                
                const menuDisplayName = isMultiMenu ? 
                    `${menuInfo.name} (${menuOrder})` : 
                    menuInfo.name;
                
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${staffDisplayName}</td>
                    <td class="border border-gray-300 p-2">${menuDisplayName}</td>
                    <td class="border border-gray-300 p-2">${duration}min</td>
                    <td class="border border-gray-300 p-2">${startTime || '-'}</td>
                    <td class="border border-gray-300 p-2">${startTime ? endTime : '-'}</td>
                    <td class="border border-gray-300 p-2 remaining-time">${paid ? '-' : (startTime ? (remainingMinutes === -1 ? '-' : remainingMinutes + 'min') : '-')}</td>
                    <td class="border border-gray-300 p-2">${price.toLocaleString()}${currentCurrency.symbol}</td>
                    <td class="border border-gray-300 p-2">${commission.toLocaleString()}${currentCurrency.symbol}</td>
                    <td class="border border-gray-300 p-2">${roomInfo.roomNumber || '-'}</td>
                    <td class="border border-gray-300 p-2">
                        ${paid ? 
                            `<span class="bg-green-500 text-white px-3 py-1 rounded text-sm font-bold">${translations[currentLanguage].paymentCompleteStatus || 'ì…ê¸ˆ ì™„ë£Œ'}</span>` :
                            `<button onclick="editReservation(${reservation.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].edit || 'ìˆ˜ì •'}</button>
                             <button onclick="showPaymentModal(${reservation.id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].payment || 'ì…ê¸ˆ'}</button>
                             <button onclick="deleteReservation(${reservation.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].delete || 'ì‚­ì œ'}</button>`
                        }
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // ... (ë‚˜ë¨¸ì§€ í•„ìˆ˜ ìœ í‹¸ë¦¬í‹°, DB ê´€ë¦¬, í†µê³„ í•¨ìˆ˜ êµ¬í˜„ë¶€ë¥¼ V6.0ì—ì„œ ê°€ì ¸ì™€ ì±„ì›Œì•¼ í•¨) ...
        
        function calculateEndTime(startTime, duration) { /* ... */ }
        function calculateRemainingTime(startTime, duration, reservationDate) { /* ... */ }
        function getDailyStaffOrderKey(date) { return `temp_staffOrder_${date}_${currentAdmin.shopId}`; }
        function loadReservationData() { loadStaffSelection(); loadRoomSelection(); }
        function loadRoomSelection() { /* ... */ }
        function updateCurrentTime() { /* ... */ }
        function showStatistics() { /* ... */ }
        function showOrder() { /* ... */ }
        function showDBManagement() { /* ... */ }
        function manageMenus() { /* ... */ } // ì´ í•¨ìˆ˜ë“¤ì—ëŠ” alert ëŒ€ì‹  ì‹¤ì œ ë¡œì§ì´ í•„ìš”
        // ... (etc.) ...
        
        // ì•± ì´ˆê¸°í™”
        initializeApp();
    </script>
 </body>
</html>
