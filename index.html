<!doctype html>
<html lang="ko">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>마사지샵 관리 시스템</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&amp;family=Noto+Sans+Thai:wght@300;400;500;700&amp;family=Noto+Sans+Vietnamese:wght@300;400;500;700&amp;family=Roboto:wght@300;400;500;700&amp;family=Nanum+Gothic:wght@400;700;800&amp;display=swap" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        .remaining-time {
            font-size: 2rem;
            font-weight: bold;
            color: #ef4444;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80%;
            overflow-y: auto;
        }
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        .menu-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .duration-selection-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        .selection-item {
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .selection-item:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .selection-item.selected {
            border-color: #3b82f6;
            background-color: #3b82f6;
            color: white;
        }
        .edit-row {
            background-color: #f3f4f6;
        }
        .selected-staff-info {
            background-color: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .menu-row {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .required-label::after {
            content: " *";
            color: red;
            font-weight: bold;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gray-100 min-h-full"><!-- 로그인 화면 -->
  <div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600">
   <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md">
    <div class="text-center mb-8">
     <h1 class="text-3xl font-bold text-gray-800 mb-2" data-translate="title">마사지샵 관리 시스템</h1>
     <div class="w-20 h-1 bg-blue-500 mx-auto"></div>
    </div><!-- 언어 선택 -->
    <div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-2">언어 선택 / Language / ภาษา / Ngôn ngữ</label>
     <div class="grid grid-cols-4 gap-2"><button onclick="setLanguage('ko')" class="bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600" id="langKo">한국어</button> <button onclick="setLanguage('en')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langEn">English</button> <button onclick="setLanguage('th')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langTh">ไทย</button> <button onclick="setLanguage('vi')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langVi">Tiếng Việt</button>
     </div>
    </div>
    <div class="space-y-4">
     <div><label class="block text-sm font-medium text-gray-700 mb-2" data-translate="username">아이디</label> <input type="text" id="loginUsername" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" data-translate-placeholder="usernameInput">
     </div>
     <div><label class="block text-sm font-medium text-gray-700 mb-2" data-translate="password">비밀번호</label> <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" data-translate-placeholder="passwordInput">
     </div><button onclick="processLogin()" class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition duration-200" data-translate="login">로그인</button>
    </div>
   </div>
  </div><!-- 메인 화면 -->
  <div id="mainScreen" class="container mx-auto p-6" style="display: none;"><!-- 헤더 -->
   <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
     <div>
      <h1 class="text-3xl font-bold text-gray-800" data-translate="title">마사지 관리 프로그램</h1>
      <p id="shopName" class="text-lg text-gray-600 mt-1"></p>
     </div>
     <div class="flex gap-2"><button onclick="showLanguageModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="changeLanguage">언어 변경</button> <button onclick="showFontModal()" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600" data-translate="changeFont">폰트 변경</button> <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600" data-translate="logout">로그아웃</button>
     </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
     <div class="text-center"><label class="block text-sm font-medium mb-2" data-translate="todayDate">오늘 날짜</label>
      <div class="flex gap-2"><input type="date" id="currentDate" class="border rounded px-3 py-2 flex-1"> <button onclick="confirmDateChange()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="confirmDate">확인</button>
      </div>
     </div>
     <div class="text-center"><label class="block text-sm font-medium mb-2" data-translate="currentTime">현재 시간</label>
      <div id="currentTime" class="text-xl font-bold text-blue-600"></div>
     </div>
    </div>
   </div><!-- 메뉴 버튼들 -->
   <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6"><button onclick="showDashboard()" class="bg-blue-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-blue-600" data-translate="dashboard">현황판</button> <button onclick="showOrder()" class="bg-indigo-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-indigo-600" data-translate="order">순번</button> <button onclick="showReservation()" class="bg-green-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-green-600" data-translate="reservation">예약</button> <button onclick="showStatistics()" class="bg-purple-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-purple-600" data-translate="statistics">통계</button> <button onclick="showDBManagement()" class="bg-orange-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-orange-600" data-translate="dbManagement">DB 관리</button>
   </div><!-- 순번 섹션 -->
   <div id="orderSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="orderManagement">순번 관리</h2>
    <div class="mb-4"><button onclick="saveStaffOrder()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="saveOrder">순번 저장</button>
    </div>
    <div class="overflow-x-auto">
     <table class="w-full border-collapse border border-gray-300">
      <thead>
       <tr class="bg-gray-100">
        <th class="border border-gray-300 p-2" data-translate="staffName">직원명</th>
        <th class="border border-gray-300 p-2" data-translate="status">상태</th>
        <th class="border border-gray-300 p-2" data-translate="orderNumber">순번</th>
       </tr>
      </thead>
      <tbody id="orderTable">
      </tbody>
     </table>
    </div>
    <div class="mt-4 text-sm text-gray-600" data-translate="orderZeroVacationNote">
     * 순번 0은 휴가로 처리됩니다.
    </div>
   </div><!-- 현황판 -->
   <div id="dashboardSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="dashboard">현황판</h2>
    <div class="overflow-x-auto">
     <table class="w-full border-collapse border border-gray-300">
      <thead>
       <tr class="bg-gray-100">
        <th class="border border-gray-300 p-2" data-translate="staff">직원명</th>
        <th class="border border-gray-300 p-2" data-translate="menu">메뉴</th>
        <th class="border border-gray-300 p-2" data-translate="duration">시간</th>
        <th class="border border-gray-300 p-2" data-translate="startTime">시작시간</th>
        <th class="border border-gray-300 p-2" data-translate="endTime">끝시간</th>
        <th class="border border-gray-300 p-2" data-translate="remainingTime">남은시간</th>
        <th class="border border-gray-300 p-2" data-translate="price">가격</th>
        <th class="border border-gray-300 p-2" data-translate="commission">커미션</th>
        <th class="border border-gray-300 p-2" data-translate="roomNumber">방번호</th>
        <th class="border border-gray-300 p-2" data-translate="actions">작업</th>
       </tr>
      </thead>
      <tbody id="dashboardTable">
      </tbody>
     </table>
    </div>
   </div><!-- 예약 섹션 -->
   <div id="reservationSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="reservation">예약</h2><!-- 직원 선택 (필수) -->
    <div class="mb-6"><label class="block text-sm font-medium mb-2 required-label" data-translate="selectStaff">직원 선택</label>
     <div id="staffSelectionContainer">
      <div id="staffSelection" class="selection-grid"></div>
      <div id="selectedStaffInfo" class="selected-staff-info" style="display: none;">
       <div class="flex justify-between items-center">
        <div>
         <h4 class="font-bold text-lg">선택된 직원: <span id="selectedStaffName"></span></h4>
         <p class="text-sm text-gray-600">순번: <span id="selectedStaffOrder"></span></p>
        </div><button onclick="changeStaff()" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">직원 변경</button>
       </div>
      </div>
     </div>
    </div><!-- 메뉴 목록 -->
    <div id="menuListContainer" style="display: none;">
     <div class="flex justify-between items-center mb-4"><label class="block text-sm font-medium required-label">메뉴 목록</label> <button onclick="addMenuRow()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 flex items-center gap-2"> <span class="text-lg">+</span> 메뉴 추가 </button>
     </div>
     <div id="menuRows"></div><!-- 총 가격 정보 -->
     <div class="mt-6 p-4 bg-gray-100 rounded">
      <div class="grid grid-cols-2 gap-4">
       <div>
        <strong data-translate="totalPrice">총 가격:</strong> <span id="totalPrice">0</span><span id="totalPriceCurrency"></span>
       </div>
       <div>
        <strong data-translate="totalCommission">총 커미션:</strong> <span id="totalCommission">0</span><span id="totalCommissionCurrency"></span>
       </div>
      </div>
     </div><!-- 추가 옵션들 -->
     <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
      <div><label class="block text-sm font-medium mb-2" data-translate="startTime">시작 시간 (선택사항)</label> <input type="time" id="reservationStartTime" class="w-full border rounded px-3 py-2" onchange="updateAllMenuTimes()">
      </div>
      <div><label class="block text-sm font-medium mb-2" data-translate="roomNumber">방번호 (선택사항)</label> <select id="reservationRoom" class="w-full border rounded px-3 py-2"> <option value="" data-translate="selectRoom">방 선택</option> </select>
      </div>
      <div><label class="block text-sm font-medium mb-2" data-translate="customerName">고객명 (선택사항)</label> <input type="text" id="reservationCustomer" class="w-full border rounded px-3 py-2" data-translate-placeholder="enterCustomerName">
      </div>
     </div><!-- 메뉴별 시간 설정 -->
     <div id="menuTimeSettings" class="mt-6" style="display: none;">
      <h4 class="font-bold mb-3">메뉴별 시간 설정</h4>
      <div id="menuTimeList" class="space-y-3">
      </div>
     </div><button onclick="addReservation()" class="mt-6 bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600" data-translate="addReservation">예약 추가</button>
    </div>
   </div><!-- 통계 섹션 -->
   <div id="statisticsSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="statistics">통계</h2>
    <div class="mb-4 flex gap-4 flex-wrap"><button onclick="showDailyStats()" id="dailyStatsBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="daily">일간</button> <button onclick="showWeeklyStats()" id="weeklyStatsBtn" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" data-translate="weekly">주간</button> <button onclick="showMonthlyStats()" id="monthlyStatsBtn" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" data-translate="monthly">월간</button> <button onclick="showMenuSales()" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600" data-translate="monthlyMenuSales">월간 메뉴 매출</button> <button onclick="showMonthlySalesChart()" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600" data-translate="monthlySalesChart">월간 매출 그래프</button> <button onclick="downloadExcel()" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700" data-translate="download">다운로드</button>
    </div><!-- 날짜 선택 영역 -->
    <div class="mb-6 p-4 bg-gray-50 rounded"><!-- 일간 선택 -->
     <div id="dailyDateSelection" class="mb-4"><label class="block text-sm font-medium mb-2" data-translate="selectDate">날짜 선택</label> <input type="date" id="statsDate" class="border rounded px-3 py-2" onchange="updateStats()">
     </div><!-- 주간/월간 선택 -->
     <div id="rangeDateSelection" class="grid grid-cols-1 md:grid-cols-2 gap-4" style="display: none;">
      <div><label class="block text-sm font-medium mb-2" data-translate="startDate">시작 날짜</label> <input type="date" id="statsStartDate" class="w-full border rounded px-3 py-2" onchange="autoSetEndDate()">
      </div>
      <div><label class="block text-sm font-medium mb-2" data-translate="endDate">끝 날짜</label> <input type="date" id="statsEndDate" class="w-full border rounded px-3 py-2" onchange="updateStats()">
      </div>
     </div><!-- 빠른 선택 버튼들 (주간/월간용) -->
     <div id="quickDateSelection" class="mt-3 flex gap-2 flex-wrap" style="display: none;"><button onclick="setThisWeek()" class="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm hover:bg-blue-200" data-translate="thisWeek">이번 주</button> <button onclick="setLastWeek()" class="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm hover:bg-blue-200" data-translate="lastWeek">지난 주</button> <button onclick="setThisMonth()" class="bg-green-100 text-green-700 px-3 py-1 rounded text-sm hover:bg-green-200" data-translate="thisMonth">이번 달</button> <button onclick="setLastMonth()" class="bg-green-100 text-green-700 px-3 py-1 rounded text-sm hover:bg-green-200" data-translate="lastMonth">지난 달</button>
     </div>
    </div><!-- 차트 영역 -->
    <div id="chartContainer" class="mb-6" style="display: none;">
     <canvas id="statsChart" width="800" height="400"></canvas>
    </div><!-- 직원별 통계 -->
    <div class="mb-6">
     <h3 class="text-lg font-bold mb-2" data-translate="staffStatisticsTitle">직원별 통계</h3>
     <div class="overflow-x-auto">
      <table class="w-full border-collapse border border-gray-300">
       <thead>
        <tr class="bg-gray-100">
         <th class="border border-gray-300 p-2" data-translate="staff">마사지사</th>
         <th class="border border-gray-300 p-2" data-translate="totalPrice">총 가격</th>
         <th class="border border-gray-300 p-2" data-translate="totalCommission">총 커미션</th>
        </tr>
       </thead>
       <tbody id="statsTable">
       </tbody>
      </table>
     </div>
    </div><!-- 입금방식별 통계 -->
    <div class="mb-6">
     <h3 class="text-lg font-bold mb-2" data-translate="paymentMethodStatisticsTitle">입금방식별 통계</h3>
     <div class="overflow-x-auto">
      <table class="w-full border-collapse border border-gray-300">
       <thead>
        <tr class="bg-gray-100">
         <th class="border border-gray-300 p-2" data-translate="paymentMethodColumn">입금방식</th>
         <th class="border border-gray-300 p-2" data-translate="amountColumn">금액</th>
        </tr>
       </thead>
       <tbody id="paymentStatsTable">
       </tbody>
      </table>
     </div>
    </div>
    <div class="p-4 bg-gray-100 rounded">
     <div class="grid grid-cols-3 gap-4">
      <div>
       <strong data-translate="grandTotal">총 금액(QR팁 제외):</strong> <span id="grandTotalPrice">0</span><span id="grandTotalCurrency"></span>
      </div>
      <div>
       <strong data-translate="grandTotalCommission">총 커미션:</strong> <span id="grandTotalCommission">0</span><span id="grandTotalCommissionCurrency"></span>
      </div>
      <div>
       <strong data-translate="profit">수익:</strong> <span id="totalProfit">0</span><span id="totalProfitCurrency"></span>
      </div>
     </div>
    </div>
   </div><!-- DB 관리 섹션 -->
   <div id="dbManagementSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="dbManagement">DB 관리</h2><!-- 데이터 백업/복원 -->
    <div class="mb-6 p-4 bg-gray-100 rounded">
     <h3 class="text-lg font-bold mb-2" data-translate="dataBackupRestoreTitle">데이터 백업 및 복원</h3>
     <div class="grid grid-cols-2 gap-4">
      <div>
       <h4 class="font-semibold mb-2" data-translate="backupButton">백업</h4>
       <div class="flex gap-2 flex-wrap"><button onclick="showLocalBackupDialog()" class="bg-green-600 text-white px-3 py-2 rounded hover:bg-green-700 text-sm" data-translate="localBackupButton">로컬 백업</button> <button onclick="showGoogleBackupDialog()" class="bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 text-sm" data-translate="googleBackupButton">구글 백업</button>
       </div>
      </div>
      <div>
       <h4 class="font-semibold mb-2" data-translate="restoreButton">복원</h4>
       <div class="flex gap-2 flex-wrap"><input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreData(event)"> <button onclick="showLocalRestoreDialog()" class="bg-orange-600 text-white px-3 py-2 rounded hover:bg-orange-700 text-sm" data-translate="localRestoreButton">로컬 복원</button> <button onclick="showGoogleRestoreDialog()" class="bg-indigo-600 text-white px-3 py-2 rounded hover:bg-indigo-700 text-sm" data-translate="googleRestoreButton">구글 복원</button>
       </div>
      </div>
     </div>
     <div class="mt-4"><button onclick="exportAllDataExcel()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700" data-translate="exportAllDataButton">전체 데이터 엑셀 내보내기</button>
     </div>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4"><button onclick="manageMenus()" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600" data-translate="menuManagement">메뉴 관리</button> <button onclick="manageStaff()" class="bg-green-500 text-white py-3 px-4 rounded hover:bg-green-600" data-translate="staffManagement">직원 관리</button> <button onclick="manageRooms()" class="bg-purple-500 text-white py-3 px-4 rounded hover:bg-purple-600" data-translate="roomManagement">방 관리</button> <button onclick="manageCustomers()" class="bg-orange-500 text-white py-3 px-4 rounded hover:bg-orange-600" data-translate="customerManagement">고객 관리</button> <button onclick="manageCurrency()" class="bg-pink-500 text-white py-3 px-4 rounded hover:bg-pink-600" data-translate="currencyManagement">화폐 단위</button> <button onclick="managePaymentMethods()" class="bg-yellow-500 text-white py-3 px-4 rounded hover:bg-yellow-600" data-translate="paymentMethodManagement">입금방식 관리</button> <button onclick="manageGuarantee()" class="bg-teal-500 text-white py-3 px-4 rounded hover:bg-teal-600">Guarantee 관리</button>
     <div id="superAdminButtons" style="display: none;"><button onclick="manageAdmins()" class="bg-red-500 text-white py-3 px-4 rounded hover:bg-red-600" data-translate="adminManagement">관리자 관리</button>
     </div>
    </div>
   </div>
  </div><!-- 입금 모달 -->
  <div id="paymentModal" class="modal">
   <div class="modal-content">
    <h3 class="text-xl font-bold mb-4" data-translate="payment">입금 처리</h3>
    <div id="paymentMethods" class="space-y-4 mb-4">
    </div>
    <div class="mb-4"><strong data-translate="totalAmount">총 금액:</strong> <span id="paymentTotalAmount">0</span><span id="paymentCurrency"></span>
    </div>
    <div class="mb-4"><strong data-translate="enteredAmount">입력된 금액:</strong> <span id="paymentEnteredAmount">0</span><span id="paymentEnteredCurrency"></span>
    </div>
    <div class="flex gap-2"><button onclick="processPayment()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-translate="confirm">확인</button> <button onclick="closePaymentModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="cancel">취소</button>
    </div>
   </div>
  </div><!-- 범용 관리 모달 -->
  <div id="managementModal" class="modal">
   <div class="modal-content">
    <h3 id="managementTitle" class="text-xl font-bold mb-4"></h3>
    <div id="managementContent"></div><button onclick="closeManagementModal()" class="mt-4 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="close">닫기</button>
   </div>
  </div><!-- 언어 변경 모달 -->
  <div id="languageModal" class="modal">
   <div class="modal-content">
    <h3 class="text-xl font-bold mb-4">언어 선택 / Language / ภาษา / Ngôn ngữ</h3>
    <div class="grid grid-cols-2 gap-4"><button onclick="setLanguageAndClose('ko')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">한국어</button> <button onclick="setLanguageAndClose('en')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">English</button> <button onclick="setLanguageAndClose('th')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">ไทย</button> <button onclick="setLanguageAndClose('vi')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">Tiếng Việt</button>
    </div><button onclick="closeLanguageModal()" class="mt-4 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">닫기</button>
   </div>
  </div><!-- 폰트 변경 모달 -->
  <div id="fontModal" class="modal">
   <div class="modal-content">
    <h3 class="text-xl font-bold mb-4" data-translate="fontSelection">폰트 선택</h3><!-- 폰트 사이즈 선택 -->
    <div class="mb-6 p-4 bg-gray-50 rounded">
     <h4 class="font-bold mb-3" data-translate="fontSize">폰트 크기</h4>
     <div class="grid grid-cols-5 gap-2"><button onclick="setFontSize('small')" id="fontSizeSmall" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeSmall">작게</button> <button onclick="setFontSize('normal')" id="fontSizeNormal" class="bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600" data-translate="fontSizeNormal">보통</button> <button onclick="setFontSize('large')" id="fontSizeLarge" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeLarge">크게</button> <button onclick="setFontSize('xlarge')" id="fontSizeXLarge" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeXLarge">매우 크게</button> <button onclick="setFontSize('xxlarge')" id="fontSizeXXLarge" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeXXLarge">최대</button>
     </div>
     <div class="mt-2 text-sm text-gray-600" data-translate="fontSizePreview"><span id="fontSizePreview">미리보기 텍스트 - Preview Text - ตัวอย่างข้อความ - Văn bản xem trước</span>
     </div>
    </div><!-- 폰트 종류 선택 -->
    <div class="mb-4">
     <h4 class="font-bold mb-3" data-translate="fontFamily">폰트 종류</h4>
     <div class="grid grid-cols-1 gap-3"><button onclick="setFontFamily('Arial')" id="fontFamilyArial" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600" style="font-family: Arial;">Arial (기본)</button> <button onclick="setFontFamily('Noto Sans KR')" id="fontFamilyNotoKR" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Noto Sans KR', sans-serif;">Noto Sans KR (한글 최적화)</button> <button onclick="setFontFamily('Malgun Gothic')" id="fontFamilyMalgun" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Malgun Gothic', sans-serif;">맑은 고딕</button> <button onclick="setFontFamily('Nanum Gothic')" id="fontFamilyNanum" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Nanum Gothic', sans-serif;">나눔고딕</button> <button onclick="setFontFamily('Roboto')" id="fontFamilyRoboto" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Roboto', sans-serif;">Roboto (영문 최적화)</button> <button onclick="setFontFamily('Noto Sans Thai')" id="fontFamilyThai" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Noto Sans Thai', sans-serif;">Noto Sans Thai (태국어)</button> <button onclick="setFontFamily('Noto Sans Vietnamese')" id="fontFamilyVietnamese" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Noto Sans Vietnamese', sans-serif;">Noto Sans Vietnamese (베트남어)</button>
     </div>
    </div>
    <div class="flex gap-2"><button onclick="applyFontSettings()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-translate="apply">적용</button> <button onclick="closeFontModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="close">닫기</button>
    </div>
   </div>
  </div><!-- 구글 로그인 모달 -->
  <div id="googleLoginModal" class="modal">
   <div class="modal-content">
    <h3 class="text-xl font-bold mb-4">구글 계정 로그인</h3>
    <div class="space-y-4">
     <div><label class="block text-sm font-medium mb-2">구글 이메일:</label> <input type="email" id="googleEmail" class="w-full border rounded px-3 py-2" placeholder="example@gmail.com">
     </div>
     <div><label class="block text-sm font-medium mb-2">구글 비밀번호:</label> <input type="password" id="googlePassword" class="w-full border rounded px-3 py-2" placeholder="비밀번호 입력">
     </div>
     <div class="text-sm text-gray-600">
      * 실제 구글 계정 정보를 입력하세요. 백업/복원을 위해 구글 드라이브에 접근합니다.
     </div>
    </div>
    <div class="flex gap-2 mt-4"><button id="googleLoginConfirm" onclick="processGoogleLogin()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">로그인</button> <button onclick="closeGoogleLoginModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
    </div>
   </div>
  </div>
  <script>
        // 전역 변수
        let currentLanguage = 'ko';
        let currentFont = 'Arial';
        let currentFontSize = 'normal';
        let selectedFontFamily = 'Arial';
        let selectedFontSize = 'normal';
        let currentAdmin = null;
        let currentPaymentReservationId = null;
        let selectedStaff = null;
        let menuRowCounter = 0;
        let menuRows = [];

        // 번역 데이터
        const translations = {
            ko: {
                title: '마사지 관리 프로그램',
                changeLanguage: '언어 변경',
                changeFont: '폰트 변경',
                fontSelection: '폰트 선택',
                fontSize: '폰트 크기',
                fontFamily: '폰트 종류',
                fontSizeSmall: '작게',
                fontSizeNormal: '보통',
                fontSizeLarge: '크게',
                fontSizeXLarge: '매우 크게',
                fontSizeXXLarge: '최대',
                fontSizePreview: '미리보기 텍스트',
                apply: '적용',
                logout: '로그아웃',
                todayDate: '오늘 날짜',
                currentTime: '현재 시간',
                dashboard: '현황판',
                order: '순번',
                reservation: '예약',
                statistics: '통계',
                dbManagement: 'DB 관리',
                staff: '직원명',
                menu: '메뉴',
                duration: '시간',
                startTime: '시작시간',
                endTime: '끝시간',
                remainingTime: '남은시간',
                price: '가격',
                commission: '커미션',
                roomNumber: '방번호',
                actions: '작업',
                selectStaff: '직원 선택',
                selectMenu: '메뉴 선택',
                customerName: '고객명',
                addReservation: '예약 추가',
                daily: '일간',
                weekly: '주간',
                monthly: '월간',
                totalPrice: '총 가격',
                totalCommission: '총 커미션',
                grandTotal: '총 금액(QR팁 제외)',
                grandTotalCommission: '총 커미션',
                profit: '수익',
                menuManagement: '메뉴 관리',
                staffManagement: '직원 관리',
                roomManagement: '방 관리',
                customerManagement: '고객 관리',
                adminManagement: '관리자 관리',
                currencyManagement: '화폐 단위',
                paymentMethodManagement: '입금방식 관리',
                payment: '입금 처리',
                totalAmount: '총 금액',
                enteredAmount: '입력된 금액',
                confirm: '확인',
                cancel: '취소',
                login: '로그인',
                close: '닫기',
                edit: '수정',
                delete: '삭제',
                add: '추가',
                save: '저장',
                username: '아이디',
                password: '비밀번호',
                usernameInput: '아이디를 입력하세요',
                passwordInput: '비밀번호를 입력하세요',
                staffName: '직원명',
                phoneNumber: '전화번호',
                bankName: '은행명',
                accountNumber: '계좌번호',
                status: '상태',
                roomNum: '방번호',
                customerNum: '고객번호',
                paymentMethodName: '입금방식명',
                shopName: '가게명',
                adminType: '타입',
                orderManagement: '순번 관리',
                saveOrder: '순번 저장',
                orderNumber: '순번',
                paymentComplete: '입금 완료',
                complete: '완료',
                fullTime: '정직원',
                partTime: '단기고용',
                resigned: '퇴사',
                vacation: '휴가',
                minutes30: '30분',
                minutes60: '60분',
                minutes90: '90분',
                minutes120: '120분',
                orderZeroNote: '* 순번 0은 휴가로 처리됩니다',
                selectRoom: '방 선택',
                enterCustomerName: '고객명 입력',
                monthlyMenuSales: '월간 메뉴 매출',
                monthlySalesChart: '월간 매출 그래프',
                download: '다운로드',
                staffStats: '직원별 통계',
                paymentMethodStats: '입금방식별 통계',
                paymentMethod: '입금방식',
                amount: '금액',
                dataBackupRestore: '데이터 백업 및 복원',
                backup: '백업',
                restore: '복원',
                screen: '화면',
                am: '오전',
                pm: '오후',
                localBackup: '로컬 백업',
                localRestore: '로컬 복원',
                googleBackup: '구글 백업',
                googleRestore: '구글 복원',
                exportAllData: '전체 데이터 엑셀 내보내기',
                management: '관리',
                confirmDate: '확인',
                paymentCompleteStatus: '입금 완료',
                completeStatus: '완료',
                fullTimeEmployee: '정직원',
                partTimeEmployee: '단기직원',
                resignedEmployee: '퇴사',
                vacationStatus: '휴가',
                duration30: '30분',
                duration60: '60분',
                duration90: '90분',
                duration120: '120분',
                orderZeroVacationNote: '* 순번 0은 휴가로 처리됩니다',
                selectRoomOption: '방선택',
                enterCustomerNamePlaceholder: '고객명 입력',
                menuGraphTitle: '메뉴 그래프',
                monthlyGraphTitle: '월간 그래프',
                downloadButton: '다운로드',
                staffStatisticsTitle: '직원별 통계',
                paymentMethodStatisticsTitle: '입금 방식별 통계',
                paymentMethodColumn: '입금 방식',
                amountColumn: '금액',
                dataBackupRestoreTitle: '데이터 백업 및 복원',
                backupButton: '백업',
                restoreButton: '복원',
                screenLabel: '화면',
                morningLabel: '오전',
                afternoonLabel: '오후',
                localBackupButton: '로컬 백업',
                localRestoreButton: '로컬 복원',
                googleBackupButton: '구글 백업',
                googleRestoreButton: '구글 복원',
                exportAllDataButton: '전체 데이터 엑셀 내보내기',
                managementLabel: '관리',
                selectDate: '날짜 선택',
                startDate: '시작 날짜',
                endDate: '끝 날짜',
                thisWeek: '이번 주',
                lastWeek: '지난 주',
                thisMonth: '이번 달',
                lastMonth: '지난 달'
            },
            en: {
                title: 'Massage Management System',
                changeLanguage: 'Change Language',
                changeFont: 'Change Font',
                fontSelection: 'Font Selection',
                fontSize: 'Font Size',
                fontFamily: 'Font Family',
                fontSizeSmall: 'Small',
                fontSizeNormal: 'Normal',
                fontSizeLarge: 'Large',
                fontSizeXLarge: 'X-Large',
                fontSizeXXLarge: 'XX-Large',
                fontSizePreview: 'Preview Text',
                apply: 'Apply',
                logout: 'Logout',
                todayDate: 'Today\'s Date',
                currentTime: 'Current Time',
                dashboard: 'Dashboard',
                order: 'Order',
                reservation: 'Reservation',
                statistics: 'Statistics',
                dbManagement: 'DB Management',
                staff: 'Staff',
                menu: 'Menu',
                duration: 'Duration',
                startTime: 'Start Time',
                endTime: 'End Time',
                remainingTime: 'Remaining Time',
                price: 'Price',
                commission: 'Commission',
                roomNumber: 'Room Number',
                actions: 'Actions',
                selectStaff: 'Select Staff',
                selectMenu: 'Select Menu',
                customerName: 'Customer Name',
                addReservation: 'Add Reservation',
                daily: 'Daily',
                weekly: 'Weekly',
                monthly: 'Monthly',
                totalPrice: 'Total Price',
                totalCommission: 'Total Commission',
                grandTotal: 'Grand Total (Excl. QR Tip)',
                grandTotalCommission: 'Total Commission',
                profit: 'Profit',
                menuManagement: 'Menu Management',
                staffManagement: 'Staff Management',
                roomManagement: 'Room Management',
                customerManagement: 'Customer Management',
                adminManagement: 'Admin Management',
                currencyManagement: 'Currency Management',
                paymentMethodManagement: 'Payment Method Management',
                payment: 'Payment',
                totalAmount: 'Total Amount',
                enteredAmount: 'Entered Amount',
                confirm: 'Confirm',
                cancel: 'Cancel',
                login: 'Login',
                close: 'Close',
                edit: 'Edit',
                delete: 'Delete',
                add: 'Add',
                save: 'Save',
                username: 'Username',
                password: 'Password',
                usernameInput: 'Enter username',
                passwordInput: 'Enter password',
                staffName: 'Staff Name',
                phoneNumber: 'Phone Number',
                bankName: 'Bank Name',
                accountNumber: 'Account Number',
                status: 'Status',
                roomNum: 'Room Number',
                customerNum: 'Customer Number',
                paymentMethodName: 'Payment Method Name',
                shopName: 'Shop Name',
                adminType: 'Type',
                orderManagement: 'Order Management',
                saveOrder: 'Save Order',
                orderNumber: 'Order Number',
                paymentComplete: 'Payment Complete',
                complete: 'Complete',
                fullTime: 'Full Time',
                partTime: 'Part Time',
                resigned: 'Resigned',
                vacation: 'Vacation',
                minutes30: '30 min',
                minutes60: '60 min',
                minutes90: '90 min',
                minutes120: '120 min',
                orderZeroNote: '* Order 0 is treated as vacation',
                selectRoom: 'Select Room',
                enterCustomerName: 'Enter customer name',
                monthlyMenuSales: 'Monthly Menu Sales',
                monthlySalesChart: 'Monthly Sales Chart',
                download: 'Download',
                staffStats: 'Staff Statistics',
                paymentMethodStats: 'Payment Method Statistics',
                paymentMethod: 'Payment Method',
                amount: 'Amount',
                dataBackupRestore: 'Data Backup & Restore',
                backup: 'Backup',
                restore: 'Restore',
                screen: 'Screen',
                am: 'AM',
                pm: 'PM',
                localBackup: 'Local Backup',
                localRestore: 'Local Restore',
                googleBackup: 'Google Backup',
                googleRestore: 'Google Restore',
                exportAllData: 'Export All Data to Excel',
                management: 'Management',
                confirmDate: 'Confirm',
                paymentCompleteStatus: 'Payment Complete',
                completeStatus: 'Complete',
                fullTimeEmployee: 'Full Time',
                partTimeEmployee: 'Part Time',
                resignedEmployee: 'Resigned',
                vacationStatus: 'Vacation',
                duration30: '30 min',
                duration60: '60 min',
                duration90: '90 min',
                duration120: '120 min',
                orderZeroVacationNote: '* Order 0 is treated as vacation',
                selectRoomOption: 'Select Room',
                enterCustomerNamePlaceholder: 'Enter customer name',
                menuGraphTitle: 'Menu Graph',
                monthlyGraphTitle: 'Monthly Graph',
                downloadButton: 'Download',
                staffStatisticsTitle: 'Staff Statistics',
                paymentMethodStatisticsTitle: 'Payment Method Statistics',
                paymentMethodColumn: 'Payment Method',
                amountColumn: 'Amount',
                dataBackupRestoreTitle: 'Data Backup & Restore',
                backupButton: 'Backup',
                restoreButton: 'Restore',
                screenLabel: 'Screen',
                morningLabel: 'Morning',
                afternoonLabel: 'Afternoon',
                localBackupButton: 'Local Backup',
                localRestoreButton: 'Local Restore',
                googleBackupButton: 'Google Backup',
                googleRestoreButton: 'Google Restore',
                exportAllDataButton: 'Export All Data to Excel',
                managementLabel: 'Management',
                selectDate: 'Select Date',
                startDate: 'Start Date',
                endDate: 'End Date',
                thisWeek: 'This Week',
                lastWeek: 'Last Week',
                thisMonth: 'This Month',
                lastMonth: 'Last Month'
            },
            th: {
                title: 'ระบบจัดการนวดแผนไทย',
                changeLanguage: 'เปลี่ยนภาษา',
                changeFont: 'เปลี่ยนฟอนต์',
                fontSelection: 'เลือกฟอนต์',
                fontSize: 'ขนาดฟอนต์',
                fontFamily: 'ประเภทฟอนต์',
                fontSizeSmall: 'เล็ก',
                fontSizeNormal: 'ปกติ',
                fontSizeLarge: 'ใหญ่',
                fontSizeXLarge: 'ใหญ่มาก',
                fontSizeXXLarge: 'ใหญ่ที่สุด',
                fontSizePreview: 'ข้อความตัวอย่าง',
                apply: 'ใช้งาน',
                logout: 'ออกจากระบบ',
                todayDate: 'วันที่วันนี้',
                currentTime: 'เวลาปัจจุบัน',
                dashboard: 'แดชบอร์ด',
                order: 'ลำดับ',
                reservation: 'การจอง',
                statistics: 'สถิติ',
                dbManagement: 'จัดการฐานข้อมูล',
                staff: 'พนักงาน',
                menu: 'เมนู',
                duration: 'ระยะเวลา',
                startTime: 'เวลาเริ่ม',
                endTime: 'เวลาสิ้นสุด',
                remainingTime: 'เวลาที่เหลือ',
                price: 'ราคา',
                commission: 'คอมมิชชั่น',
                roomNumber: 'หมายเลขห้อง',
                actions: 'การดำเนินการ',
                selectStaff: 'เลือกพนักงาน',
                selectMenu: 'เลือกเมนู',
                customerName: 'ชื่อลูกค้า',
                addReservation: 'เพิ่มการจอง',
                daily: 'รายวัน',
                weekly: 'รายสัปดาห์',
                monthly: 'รายเดือน',
                totalPrice: 'ราคารวม',
                totalCommission: 'คอมมิชชั่นรวม',
                grandTotal: 'ยอดรวมทั้งหมด (ไม่รวม QR Tip)',
                grandTotalCommission: 'คอมมิชชั่นรวม',
                profit: 'กำไร',
                menuManagement: 'จัดการเมนู',
                staffManagement: 'จัดการพนักงาน',
                roomManagement: 'จัดการห้อง',
                customerManagement: 'จัดการลูกค้า',
                adminManagement: 'จัดการผู้ดูแลระบบ',
                currencyManagement: 'จัดการสกุลเงิน',
                paymentMethodManagement: 'จัดการวิธีการชำระเงิน',
                payment: 'การชำระเงิน',
                totalAmount: 'จำนวนเงินรวม',
                enteredAmount: 'จำนวนเงินที่ป้อน',
                confirm: 'ยืนยัน',
                cancel: 'ยกเลิก',
                login: 'เข้าสู่ระบบ',
                close: 'ปิด',
                edit: 'แก้ไข',
                delete: 'ลบ',
                add: 'เพิ่ม',
                save: 'บันทึก',
                username: 'ชื่อผู้ใช้',
                password: 'รหัสผ่าน',
                usernameInput: 'กรอกชื่อผู้ใช้',
                passwordInput: 'กรอกรหัสผ่าน',
                staffName: 'ชื่อพนักงาน',
                phoneNumber: 'หมายเลขโทรศัพท์',
                bankName: 'ชื่อธนาคาร',
                accountNumber: 'หมายเลขบัญชี',
                status: 'สถานะ',
                roomNum: 'หมายเลขห้อง',
                customerNum: 'หมายเลขลูกค้า',
                paymentMethodName: 'ชื่อวิธีการชำระเงิน',
                shopName: 'ชื่อร้าน',
                adminType: 'ประเภท',
                orderManagement: 'จัดการลำดับ',
                saveOrder: 'บันทึกลำดับ',
                orderNumber: 'หมายเลขลำดับ',
                paymentComplete: 'ชำระเงินเสร็จสิ้น',
                complete: 'เสร็จสิ้น',
                fullTime: 'พนักงานประจำ',
                partTime: 'พนักงานชั่วคราว',
                resigned: 'ลาออก',
                vacation: 'วันหยุด',
                minutes30: '30 นาที',
                minutes60: '60 นาที',
                minutes90: '90 นาที',
                minutes120: '120 นาที',
                orderZeroNote: '* ลำดับ 0 จะถือเป็นวันหยุด',
                selectRoom: 'เลือกห้อง',
                enterCustomerName: 'กรอกชื่อลูกค้า',
                monthlyMenuSales: 'ยอดขายเมนูรายเดือน',
                monthlySalesChart: 'กราฟยอดขายรายเดือน',
                download: 'ดาวน์โหลด',
                staffStats: 'สถิติพนักงาน',
                paymentMethodStats: 'สถิติวิธีการชำระเงิน',
                paymentMethod: 'วิธีการชำระเงิน',
                amount: 'จำนวนเงิน',
                dataBackupRestore: 'สำรองและกู้คืนข้อมูล',
                backup: 'สำรองข้อมูล',
                restore: 'กู้คืนข้อมูล',
                screen: 'หน้าจอ',
                am: 'ก่อนเที่ยง',
                pm: 'หลังเที่ยง',
                localBackup: 'สำรองข้อมูลในเครื่อง',
                localRestore: 'กู้คืนข้อมูลในเครื่อง',
                googleBackup: 'สำรองข้อมูล Google',
                googleRestore: 'กู้คืนข้อมูล Google',
                exportAllData: 'ส่งออกข้อมูลทั้งหมดเป็น Excel',
                management: 'จัดการ',
                confirmDate: 'ยืนยัน',
                paymentCompleteStatus: 'ชำระเงินเสร็จสิ้น',
                completeStatus: 'เสร็จสิ้น',
                fullTimeEmployee: 'พนักงานประจำ',
                partTimeEmployee: 'พนักงานชั่วคราว',
                resignedEmployee: 'ลาออก',
                vacationStatus: 'วันหยุด',
                duration30: '30 นาที',
                duration60: '60 นาที',
                duration90: '90 นาที',
                duration120: '120 นาที',
                orderZeroVacationNote: '* ลำดับ 0 จะถือเป็นวันหยุด',
                selectRoomOption: 'เลือกห้อง',
                enterCustomerNamePlaceholder: 'กรอกชื่อลูกค้า',
                menuGraphTitle: 'กราฟเมนู',
                monthlyGraphTitle: 'กราฟรายเดือน',
                downloadButton: 'ดาวน์โหลด',
                staffStatisticsTitle: 'สถิติพนักงาน',
                paymentMethodStatisticsTitle: 'สถิติวิธีการชำระเงิน',
                paymentMethodColumn: 'วิธีการชำระเงิน',
                amountColumn: 'จำนวนเงิน',
                dataBackupRestoreTitle: 'สำรองและกู้คืนข้อมูล',
                backupButton: 'สำรองข้อมูล',
                restoreButton: 'กู้คืนข้อมูล',
                screenLabel: 'หน้าจอ',
                morningLabel: 'ตอนเช้า',
                afternoonLabel: 'ตอนบ่าย',
                localBackupButton: 'สำรองข้อมูลในเครื่อง',
                localRestoreButton: 'กู้คืนข้อมูลในเครื่อง',
                googleBackupButton: 'สำรองข้อมูล Google',
                googleRestoreButton: 'กู้คืนข้อมูล Google',
                exportAllDataButton: 'ส่งออกข้อมูลทั้งหมดเป็น Excel',
                managementLabel: 'จัดการ',
                selectDate: 'เลือกวันที่',
                startDate: 'วันที่เริ่มต้น',
                endDate: 'วันที่สิ้นสุด',
                thisWeek: 'สัปดาห์นี้',
                lastWeek: 'สัปดาห์ที่แล้ว',
                thisMonth: 'เดือนนี้',
                lastMonth: 'เดือนที่แล้ว'
            },
            vi: {
                title: 'Hệ thống quản lý massage',
                changeLanguage: 'Đổi ngôn ngữ',
                changeFont: 'Đổi phông chữ',
                fontSelection: 'Chọn phông chữ',
                fontSize: 'Kích thước phông chữ',
                fontFamily: 'Loại phông chữ',
                fontSizeSmall: 'Nhỏ',
                fontSizeNormal: 'Bình thường',
                fontSizeLarge: 'Lớn',
                fontSizeXLarge: 'Rất lớn',
                fontSizeXXLarge: 'Lớn nhất',
                fontSizePreview: 'Văn bản xem trước',
                apply: 'Áp dụng',
                logout: 'Đăng xuất',
                todayDate: 'Ngày hôm nay',
                currentTime: 'Thời gian hiện tại',
                dashboard: 'Bảng điều khiển',
                order: 'Thứ tự',
                reservation: 'Đặt chỗ',
                statistics: 'Thống kê',
                dbManagement: 'Quản lý cơ sở dữ liệu',
                staff: 'Nhân viên',
                menu: 'Menu',
                duration: 'Thời lượng',
                startTime: 'Thời gian bắt đầu',
                endTime: 'Thời gian kết thúc',
                remainingTime: 'Thời gian còn lại',
                price: 'Giá',
                commission: 'Hoa hồng',
                roomNumber: 'Số phòng',
                actions: 'Hành động',
                selectStaff: 'Chọn nhân viên',
                selectMenu: 'Chọn menu',
                customerName: 'Tên khách hàng',
                addReservation: 'Thêm đặt chỗ',
                daily: 'Hàng ngày',
                weekly: 'Hàng tuần',
                monthly: 'Hàng tháng',
                totalPrice: 'Tổng giá',
                totalCommission: 'Tổng hoa hồng',
                grandTotal: 'Tổng cộng (Không bao gồm QR Tip)',
                grandTotalCommission: 'Tổng hoa hồng',
                profit: 'Lợi nhuận',
                menuManagement: 'Quản lý menu',
                staffManagement: 'Quản lý nhân viên',
                roomManagement: 'Quản lý phòng',
                customerManagement: 'Quản lý khách hàng',
                adminManagement: 'Quản lý quản trị viên',
                currencyManagement: 'Quản lý tiền tệ',
                paymentMethodManagement: 'Quản lý phương thức thanh toán',
                payment: 'Thanh toán',
                totalAmount: 'Tổng số tiền',
                enteredAmount: 'Số tiền đã nhập',
                confirm: 'Xác nhận',
                cancel: 'Hủy',
                login: 'Đăng nhập',
                close: 'Đóng',
                edit: 'Chỉnh sửa',
                delete: 'Xóa',
                add: 'Thêm',
                save: 'Lưu',
                username: 'Tên đăng nhập',
                password: 'Mật khẩu',
                usernameInput: 'Nhập tên đăng nhập',
                passwordInput: 'Nhập mật khẩu',
                staffName: 'Tên nhân viên',
                phoneNumber: 'Số điện thoại',
                bankName: 'Tên ngân hàng',
                accountNumber: 'Số tài khoản',
                status: 'Trạng thái',
                roomNum: 'Số phòng',
                customerNum: 'Số khách hàng',
                paymentMethodName: 'Tên phương thức thanh toán',
                shopName: 'Tên cửa hàng',
                adminType: 'Loại',
                orderManagement: 'Quản lý thứ tự',
                saveOrder: 'Lưu thứ tự',
                orderNumber: 'Số thứ tự',
                paymentComplete: 'Thanh toán hoàn tất',
                complete: 'Hoàn thành',
                fullTime: 'Toàn thời gian',
                partTime: 'Bán thời gian',
                resigned: 'Đã nghỉ việc',
                vacation: 'Nghỉ phép',
                minutes30: '30 phút',
                minutes60: '60 phút',
                minutes90: '90 phút',
                minutes120: '120 phút',
                orderZeroNote: '* Thứ tự 0 được coi là nghỉ phép',
                selectRoom: 'Chọn phòng',
                enterCustomerName: 'Nhập tên khách hàng',
                monthlyMenuSales: 'Doanh số menu hàng tháng',
                monthlySalesChart: 'Biểu đồ doanh số hàng tháng',
                download: 'Tải xuống',
                staffStats: 'Thống kê nhân viên',
                paymentMethodStats: 'Thống kê phương thức thanh toán',
                paymentMethod: 'Phương thức thanh toán',
                amount: 'Số tiền',
                dataBackupRestore: 'Sao lưu và khôi phục dữ liệu',
                backup: 'Sao lưu',
                restore: 'Khôi phục',
                screen: 'Màn hình',
                am: 'Sáng',
                pm: 'Chiều',
                localBackup: 'Sao lưu cục bộ',
                localRestore: 'Khôi phục cục bộ',
                googleBackup: 'Sao lưu Google',
                googleRestore: 'Khôi phục Google',
                exportAllData: 'Xuất tất cả dữ liệu ra Excel',
                management: 'Quản lý',
                confirmDate: 'Xác nhận',
                paymentCompleteStatus: 'Thanh toán hoàn tất',
                completeStatus: 'Hoàn thành',
                fullTimeEmployee: 'Toàn thời gian',
                partTimeEmployee: 'Bán thời gian',
                resignedEmployee: 'Đã nghỉ việc',
                vacationStatus: 'Nghỉ phép',
                duration30: '30 phút',
                duration60: '60 phút',
                duration90: '90 phút',
                duration120: '120 phút',
                orderZeroVacationNote: '* Thứ tự 0 được coi là nghỉ phép',
                selectRoomOption: 'Chọn phòng',
                enterCustomerNamePlaceholder: 'Nhập tên khách hàng',
                menuGraphTitle: 'Biểu đồ menu',
                monthlyGraphTitle: 'Biểu đồ hàng tháng',
                downloadButton: 'Tải xuống',
                staffStatisticsTitle: 'Thống kê nhân viên',
                paymentMethodStatisticsTitle: 'Thống kê phương thức thanh toán',
                paymentMethodColumn: 'Phương thức thanh toán',
                amountColumn: 'Số tiền',
                dataBackupRestoreTitle: 'Sao lưu và khôi phục dữ liệu',
                backupButton: 'Sao lưu',
                restoreButton: 'Khôi phục',
                screenLabel: 'Màn hình',
                morningLabel: 'Buổi sáng',
                afternoonLabel: 'Buổi chiều',
                localBackupButton: 'Sao lưu cục bộ',
                localRestoreButton: 'Khôi phục cục bộ',
                googleBackupButton: 'Sao lưu Google',
                googleRestoreButton: 'Khôi phục Google',
                exportAllDataButton: 'Xuất tất cả dữ liệu ra Excel',
                managementLabel: 'Quản lý',
                selectDate: 'Chọn ngày',
                startDate: 'Ngày bắt đầu',
                endDate: 'Ngày kết thúc',
                thisWeek: 'Tuần này',
                lastWeek: 'Tuần trước',
                thisMonth: 'Tháng này',
                lastMonth: 'Tháng trước'
            }
        };

        // 초기화
        function initializeApp() {
            initializeGlobalData();
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            document.getElementById('currentDate').value = new Date().toISOString().split('T')[0];
            
            // 저장된 폰트 설정 복원
            const savedFont = localStorage.getItem('selectedFont');
            const savedFontSize = localStorage.getItem('selectedFontSize');
            if (savedFont) {
                currentFont = savedFont;
                selectedFontFamily = savedFont;
            }
            if (savedFontSize) {
                currentFontSize = savedFontSize;
                selectedFontSize = savedFontSize;
            }
            applyFontSettings();
            
            // 새로고침시 로그인 상태 복원
            const savedAdmin = localStorage.getItem('currentAdmin');
            if (savedAdmin) {
                currentAdmin = JSON.parse(savedAdmin);
                initializeAdminData();
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainScreen').style.display = 'block';
                
                // 상점명 설정
                const shopNameElement = document.getElementById('shopName');
                if (currentAdmin.type === 'super') {
                    shopNameElement.textContent = '최고 관리자 화면';
                    document.getElementById('superAdminButtons').style.display = 'block';
                } else {
                    shopNameElement.textContent = currentAdmin.shopName;
                    document.getElementById('superAdminButtons').style.display = 'none';
                }
                
                loadReservationData();
                showDashboard();
            }
        }

        // 전역 데이터 초기화 (관리자 계정만)
        function initializeGlobalData() {
            if (!localStorage.getItem('globalAdmins')) {
                localStorage.setItem('globalAdmins', JSON.stringify([
                    {id: 1, username: 'admin', password: '12345678', type: 'super', shopName: '', phone: ''},
                    {id: 2, username: 'shop1', password: '12345678', type: 'normal', shopName: '힐링 마사지', phone: '02-1234-5678'},
                    {id: 3, username: 'Test', password: '1111', type: 'normal', shopName: '테스트 마사지', phone: '02-0000-0000'}
                ]));
            }

            if (!localStorage.getItem('globalCurrency')) {
                localStorage.setItem('globalCurrency', JSON.stringify({
                    symbol: '',
                    name: '원'
                }));
            }
        }

        // 관리자별 데이터베이스 키 생성
        function getAdminKey(dataType) {
            return `${currentAdmin.username}_${dataType}`;
        }

        // 일별 순번 키 생성
        function getDailyStaffOrderKey(date) {
            return `${currentAdmin.username}_staffOrder_${date}`;
        }

        // 관리자별 데이터 초기화
        function initializeAdminData() {
            const adminPrefix = currentAdmin.username;

            // 기본 데이터 설정
            if (!localStorage.getItem(getAdminKey('menus'))) {
                localStorage.setItem(getAdminKey('menus'), JSON.stringify([
                    {
                        id: 1, 
                        name: '타이 마사지',
                        prices: {
                            30: {price: 30000, commission: 15000},
                            60: {price: 50000, commission: 25000},
                            90: {price: 70000, commission: 35000},
                            120: {price: 90000, commission: 45000}
                        }
                    },
                    {
                        id: 2, 
                        name: '오일 마사지',
                        prices: {
                            60: {price: 80000, commission: 40000},
                            90: {price: 110000, commission: 55000},
                            120: {price: 140000, commission: 70000}
                        }
                    }
                ]));
            }

            if (!localStorage.getItem(getAdminKey('staff'))) {
                localStorage.setItem(getAdminKey('staff'), JSON.stringify([
                    {id: 1, name: '김미영', phone: '010-1234-5678', bank: '국민은행', account: '123-456-789', status: '정직원'},
                    {id: 2, name: '이수진', phone: '010-9876-5432', bank: '신한은행', account: '987-654-321', status: '정직원'}
                ]));
            }

            if (!localStorage.getItem(getAdminKey('staffOrder'))) {
                localStorage.setItem(getAdminKey('staffOrder'), JSON.stringify({}));
            }

            if (!localStorage.getItem(getAdminKey('rooms'))) {
                localStorage.setItem(getAdminKey('rooms'), JSON.stringify([
                    {id: 1, roomNumber: '101', capacity: 1},
                    {id: 2, roomNumber: '102', capacity: 2},
                    {id: 3, roomNumber: '103', capacity: 1}
                ]));
            }

            if (!localStorage.getItem(getAdminKey('customers'))) {
                localStorage.setItem(getAdminKey('customers'), JSON.stringify([
                    {id: 1, name: '홍길동', phone: '010-1111-2222', customerNumber: '100001'},
                    {id: 2, name: '김철수', phone: '010-3333-4444', customerNumber: '100002'}
                ]));
            }

            if (!localStorage.getItem(getAdminKey('paymentMethods'))) {
                localStorage.setItem(getAdminKey('paymentMethods'), JSON.stringify([
                    {id: 1, name: '현금'},
                    {id: 2, name: 'QR'},
                    {id: 3, name: '쿠폰'},
                    {id: 4, name: 'QR TIP'},
                    {id: 5, name: '기타'}
                ]));
            }

            if (!localStorage.getItem(getAdminKey('reservations'))) {
                localStorage.setItem(getAdminKey('reservations'), JSON.stringify([]));
            }

            if (!localStorage.getItem(getAdminKey('currency'))) {
                const globalCurrency = JSON.parse(localStorage.getItem('globalCurrency'));
                localStorage.setItem(getAdminKey('currency'), JSON.stringify(globalCurrency));
            }

            if (!localStorage.getItem(getAdminKey('guarantees'))) {
                localStorage.setItem(getAdminKey('guarantees'), JSON.stringify([]));
            }
        }

        // 로그인 처리
        function processLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                alert('아이디와 비밀번호를 입력해주세요.');
                return;
            }

            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            const admin = admins.find(a => a.username === username && a.password === password);
            
            if (admin) {
                currentAdmin = admin;
                localStorage.setItem('currentAdmin', JSON.stringify(admin));
                initializeAdminData();
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainScreen').style.display = 'block';
                
                // 상점명 설정
                const shopNameElement = document.getElementById('shopName');
                if (admin.type === 'super') {
                    shopNameElement.textContent = '최고 관리자 화면';
                    document.getElementById('superAdminButtons').style.display = 'block';
                } else {
                    shopNameElement.textContent = admin.shopName;
                    document.getElementById('superAdminButtons').style.display = 'none';
                }
                
                loadReservationData();
                showDashboard();
            } else {
                alert('아이디 또는 비밀번호가 잘못되었습니다.');
            }
        }

        // 로그아웃
        function logout() {
            if (confirm('로그아웃 하시겠습니까?')) {
                currentAdmin = null;
                localStorage.removeItem('currentAdmin');
                selectedStaff = null;
                menuRows = [];
                menuRowCounter = 0;
                document.getElementById('mainScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                
                // 모든 섹션 숨기기
                hideAllSections();
                
                // 언어를 한국어로 초기화
                setLanguage('ko');
            }
        }

        // 언어 설정
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // 언어 버튼 스타일 업데이트
            document.getElementById('langKo').className = lang === 'ko' ? 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600' : 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
            document.getElementById('langEn').className = lang === 'en' ? 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600' : 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
            document.getElementById('langTh').className = lang === 'th' ? 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600' : 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
            document.getElementById('langVi').className = lang === 'vi' ? 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600' : 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
            
            updateTranslations();
            
            // 메인 화면이 표시된 경우에만 데이터 로드
            if (document.getElementById('mainScreen').style.display === 'block') {
                loadReservationData();
                showDashboard();
            }
        }

        function updateTranslations() {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    if (element.tagName === 'INPUT' && (element.type === 'text' || element.type === 'password')) {
                        element.placeholder = translations[currentLanguage][key];
                    } else {
                        element.textContent = translations[currentLanguage][key];
                    }
                }
            });
            
            // placeholder 전용 번역 처리
            const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.placeholder = translations[currentLanguage][key];
                }
            });
            
            updateCurrencyDisplay();
        }

        // 화폐 단위 표시 업데이트
        function updateCurrencyDisplay() {
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            const currencyElements = document.querySelectorAll('[id$="Currency"]');
            currencyElements.forEach(element => {
                element.textContent = currency.symbol;
            });
        }

        // 시간 업데이트
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString();
            updateDashboardRemainingTime();
        }

        function updateCurrentDate() {
            loadReservationData();
        }

        function confirmDateChange() {
            loadReservationData();
            if (document.getElementById('dashboardSection').style.display === 'block') {
                loadDashboard();
            }
            if (document.getElementById('orderSection').style.display === 'block') {
                loadStaffOrder();
            }
            if (document.getElementById('statisticsSection').style.display === 'block') {
                document.getElementById('statsDate').value = document.getElementById('currentDate').value;
                showDailyStats();
            }
        }

        // 섹션 표시/숨김
        function hideAllSections() {
            const sections = ['dashboardSection', 'orderSection', 'reservationSection', 'statisticsSection', 'dbManagementSection'];
            sections.forEach(section => {
                document.getElementById(section).style.display = 'none';
            });
        }

        function showDashboard() {
            hideAllSections();
            document.getElementById('dashboardSection').style.display = 'block';
            loadDashboard();
        }

        function showReservation() {
            hideAllSections();
            document.getElementById('reservationSection').style.display = 'block';
            resetReservationForm();
            loadReservationData();
        }

        function showStatistics() {
            hideAllSections();
            document.getElementById('statisticsSection').style.display = 'block';
            document.getElementById('statsDate').value = document.getElementById('currentDate').value;
            showDailyStats();
        }

        function showOrder() {
            hideAllSections();
            document.getElementById('orderSection').style.display = 'block';
            loadStaffOrder();
        }

        function showDBManagement() {
            hideAllSections();
            document.getElementById('dbManagementSection').style.display = 'block';
        }

        // 예약 폼 초기화
        function resetReservationForm() {
            selectedStaff = null;
            menuRows = [];
            menuRowCounter = 0;
            
            // UI 초기화
            document.getElementById('staffSelection').style.display = 'block';
            document.getElementById('selectedStaffInfo').style.display = 'none';
            document.getElementById('menuListContainer').style.display = 'none';
            document.getElementById('menuRows').innerHTML = '';
            document.getElementById('reservationStartTime').value = '';
            document.getElementById('reservationRoom').value = '';
            document.getElementById('reservationCustomer').value = '';
            
            // 직원 선택 초기화
            const staffItems = document.querySelectorAll('#staffSelection .selection-item');
            staffItems.forEach(item => {
                item.classList.remove('selected');
            });
            
            updateTotalPrices();
        }

        // 예약 관련 함수
        function loadReservationData() {
            loadStaffSelection();
            loadRoomSelection();
        }

        function loadStaffSelection() {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const currentDate = document.getElementById('currentDate').value;
            const staffOrder = JSON.parse(localStorage.getItem(getDailyStaffOrderKey(currentDate)) || '{}');
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            
            // 퇴사자 제외하고 정직원과 단기고용만 표시
            const activeStaff = staff.filter(s => {
                const status = s.status || '정직원';
                return status !== '퇴사';
            });
            
            // 순번으로 정렬
            activeStaff.sort((a, b) => {
                const orderA = staffOrder[a.id] !== undefined ? staffOrder[a.id] : 1;
                const orderB = staffOrder[b.id] !== undefined ? staffOrder[b.id] : 1;
                if (orderA === 0 && orderB !== 0) return 1;
                if (orderA !== 0 && orderB === 0) return -1;
                if (orderA === 0 && orderB === 0) return 0;
                return orderA - orderB;
            });
            
            const container = document.getElementById('staffSelection');
            container.innerHTML = '';

            activeStaff.forEach(s => {
                const order = staffOrder[s.id] !== undefined ? staffOrder[s.id] : 1;
                const isOnVacation = order === 0;
                const hasReservation = reservations.some(r => 
                    r.date === currentDate && 
                    r.staffId === s.id && 
                    !r.paid && 
                    r.startTime
                );
                
                const div = document.createElement('div');
                div.className = 'selection-item';
                div.setAttribute('data-staff-id', s.id);
                
                // 상태에 따른 색상 설정
                if (hasReservation) {
                    div.style.backgroundColor = '#9ca3af';
                    div.style.color = 'white';
                    div.style.cursor = 'not-allowed';
                } else if (isOnVacation) {
                    div.style.backgroundColor = '#9ca3af';
                    div.style.color = 'white';
                    div.style.cursor = 'not-allowed';
                } else {
                    div.style.backgroundColor = 'transparent';
                    div.style.color = '#374151';
                    div.style.border = '2px solid #e5e7eb';
                }
                
                const vacationText = translations[currentLanguage].vacationStatus || '휴가';
                div.textContent = `${s.name} (${order === 0 ? vacationText : order})`;
                
                if (!hasReservation && !isOnVacation) {
                    div.onclick = () => selectStaff(s.id, s.name, order, div);
                }
                
                container.appendChild(div);
            });
        }

        function selectStaff(id, name, order, element) {
            selectedStaff = {id, name, order};
            
            // 선택된 직원 정보 표시
            document.getElementById('selectedStaffName').textContent = name;
            document.getElementById('selectedStaffOrder').textContent = order === 0 ? '휴가' : order;
            document.getElementById('selectedStaffInfo').style.display = 'block';
            document.getElementById('staffSelection').style.display = 'none';
            
            // 메뉴 목록 컨테이너 표시 및 첫 번째 메뉴 행 추가
            document.getElementById('menuListContainer').style.display = 'block';
            menuRows = [];
            menuRowCounter = 0;
            document.getElementById('menuRows').innerHTML = '';
            addMenuRow();
        }

        function changeStaff() {
            selectedStaff = null;
            menuRows = [];
            menuRowCounter = 0;
            
            document.getElementById('selectedStaffInfo').style.display = 'none';
            document.getElementById('staffSelection').style.display = 'block';
            document.getElementById('menuListContainer').style.display = 'none';
            document.getElementById('menuRows').innerHTML = '';
            
            updateTotalPrices();
        }

        function addMenuRow() {
            const menuRowId = ++menuRowCounter;
            const menuRow = {
                id: menuRowId,
                menuId: null,
                menuName: '',
                duration: null,
                price: 0,
                commission: 0,
                startTime: ''
            };
            
            menuRows.push(menuRow);
            
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            
            const menuRowDiv = document.createElement('div');
            menuRowDiv.className = 'menu-row';
            menuRowDiv.id = `menuRow_${menuRowId}`;
            
            menuRowDiv.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-bold">메뉴 ${menuRows.length}</h4>
                    ${menuRows.length > 1 ? `<button onclick="removeMenuRow(${menuRowId})" class="bg-red-500 text-white px-2 py-1 rounded text-sm hover:bg-red-600">× 삭제</button>` : ''}
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">메뉴 선택</label>
                        <div id="menuSelection_${menuRowId}" class="menu-selection-grid">
                            ${menus.map(m => `
                                <div class="selection-item" data-menu-id="${m.id}" onclick="selectMenuForRow(${menuRowId}, ${m.id}, '${m.name}')">
                                    ${m.name}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div id="durationContainer_${menuRowId}" style="display: none;">
                        <label class="block text-sm font-medium mb-2">시간 선택</label>
                        <div id="durationSelection_${menuRowId}" class="duration-selection-grid">
                        </div>
                    </div>
                    
                    <div id="priceInfo_${menuRowId}" class="p-3 bg-gray-50 rounded" style="display: none;">
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>가격: <span id="menuPrice_${menuRowId}" class="font-bold">0</span><span class="currency-symbol"></span></div>
                            <div>커미션: <span id="menuCommission_${menuRowId}" class="font-bold">0</span><span class="currency-symbol"></span></div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('menuRows').appendChild(menuRowDiv);
            updateCurrencyDisplay();
            updateMenuTimeSettings();
        }

        function removeMenuRow(menuRowId) {
            // 메뉴 행 제거
            const menuRowElement = document.getElementById(`menuRow_${menuRowId}`);
            if (menuRowElement) {
                menuRowElement.remove();
            }
            
            // 배열에서 제거
            menuRows = menuRows.filter(row => row.id !== menuRowId);
            
            // 메뉴 번호 재정렬
            menuRows.forEach((row, index) => {
                const rowElement = document.getElementById(`menuRow_${row.id}`);
                if (rowElement) {
                    const titleElement = rowElement.querySelector('h4');
                    if (titleElement) {
                        titleElement.textContent = `메뉴 ${index + 1}`;
                    }
                }
            });
            
            updateTotalPrices();
            updateMenuTimeSettings();
        }

        function selectMenuForRow(menuRowId, menuId, menuName) {
            const menuRow = menuRows.find(row => row.id === menuRowId);
            if (!menuRow) return;
            
            // 이전 선택 해제
            const menuSelection = document.getElementById(`menuSelection_${menuRowId}`);
            menuSelection.querySelectorAll('.selection-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // 현재 선택 표시
            const selectedItem = menuSelection.querySelector(`[data-menu-id="${menuId}"]`);
            if (selectedItem) {
                selectedItem.classList.add('selected');
            }
            
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menu = menus.find(m => m.id === menuId);
            
            if (menu) {
                menuRow.menuId = menuId;
                menuRow.menuName = menuName;
                
                // 시간 선택 영역 표시 및 업데이트
                const durationContainer = document.getElementById(`durationContainer_${menuRowId}`);
                const durationSelection = document.getElementById(`durationSelection_${menuRowId}`);
                
                durationContainer.style.display = 'block';
                durationSelection.innerHTML = '';
                
                Object.keys(menu.prices).forEach(duration => {
                    const durationKey = `duration${duration}`;
                    const durationText = translations[currentLanguage][durationKey] || `${duration}분`;
                    
                    const durationDiv = document.createElement('div');
                    durationDiv.className = 'selection-item';
                    durationDiv.setAttribute('data-duration', duration);
                    durationDiv.textContent = durationText;
                    durationDiv.onclick = () => selectDurationForRow(menuRowId, parseInt(duration));
                    
                    durationSelection.appendChild(durationDiv);
                });
                
                // 이전 시간 선택 초기화
                menuRow.duration = null;
                menuRow.price = 0;
                menuRow.commission = 0;
                
                document.getElementById(`menuPrice_${menuRowId}`).textContent = '0';
                document.getElementById(`menuCommission_${menuRowId}`).textContent = '0';
                document.getElementById(`priceInfo_${menuRowId}`).style.display = 'none';
            }
            
            updateTotalPrices();
        }

        function selectDurationForRow(menuRowId, duration) {
            const menuRow = menuRows.find(row => row.id === menuRowId);
            if (!menuRow || !menuRow.menuId) return;
            
            // 이전 선택 해제
            const durationSelection = document.getElementById(`durationSelection_${menuRowId}`);
            durationSelection.querySelectorAll('.selection-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // 현재 선택 표시
            const selectedItem = durationSelection.querySelector(`[data-duration="${duration}"]`);
            if (selectedItem) {
                selectedItem.classList.add('selected');
            }
            
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menu = menus.find(m => m.id === menuRow.menuId);
            
            if (menu && menu.prices[duration]) {
                menuRow.duration = duration;
                menuRow.price = menu.prices[duration].price;
                menuRow.commission = menu.prices[duration].commission;
                
                document.getElementById(`menuPrice_${menuRowId}`).textContent = menuRow.price.toLocaleString();
                document.getElementById(`menuCommission_${menuRowId}`).textContent = menuRow.commission.toLocaleString();
                
                // 가격 정보 표시
                document.getElementById(`priceInfo_${menuRowId}`).style.display = 'block';
            }
            
            updateTotalPrices();
            updateMenuTimeSettings();
        }

        function updateTotalPrices() {
            const totalPrice = menuRows.reduce((sum, row) => sum + row.price, 0);
            const totalCommission = menuRows.reduce((sum, row) => sum + row.commission, 0);
            
            document.getElementById('totalPrice').textContent = totalPrice.toLocaleString();
            document.getElementById('totalCommission').textContent = totalCommission.toLocaleString();
            
            updateCurrencyDisplay();
        }

        // 메뉴별 시간 설정 업데이트
        function updateMenuTimeSettings() {
            const menuTimeSettings = document.getElementById('menuTimeSettings');
            const menuTimeList = document.getElementById('menuTimeList');
            
            if (menuRows.length === 0) {
                menuTimeSettings.style.display = 'none';
                return;
            }
            
            // 완성된 메뉴만 필터링 (메뉴와 시간이 모두 선택된 것)
            const completedMenus = menuRows.filter(row => row.menuId && row.duration);
            
            if (completedMenus.length === 0) {
                menuTimeSettings.style.display = 'none';
                return;
            }
            
            menuTimeSettings.style.display = 'block';
            menuTimeList.innerHTML = '';
            
            completedMenus.forEach((row, index) => {
                const menuTimeDiv = document.createElement('div');
                menuTimeDiv.className = 'flex items-center gap-4 p-3 bg-gray-50 rounded';
                
                // 이전 메뉴의 종료 시간을 기본값으로 계산
                let suggestedTime = '';
                if (index === 0) {
                    // 첫 번째 메뉴는 전체 시작 시간 사용
                    const globalStartTime = document.getElementById('reservationStartTime').value;
                    suggestedTime = globalStartTime || '';
                } else {
                    // 이전 메뉴의 종료 시간 계산
                    const prevMenu = completedMenus[index - 1];
                    if (prevMenu.startTime) {
                        suggestedTime = calculateEndTime(prevMenu.startTime, prevMenu.duration);
                    }
                }
                
                // 현재 저장된 시간이 있으면 그것을 사용, 없으면 제안된 시간 사용
                const currentTime = row.startTime || suggestedTime;
                
                menuTimeDiv.innerHTML = `
                    <div class="flex-1">
                        <span class="font-medium">${row.menuName} (${row.duration}분)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <label class="text-sm">시작 시간:</label>
                        <input type="time" id="menuTime_${row.id}" value="${currentTime}" 
                               class="border rounded px-2 py-1" 
                               onchange="updateMenuStartTime(${row.id})">
                    </div>
                    <div class="text-sm text-gray-600">
                        종료: <span id="menuEndTime_${row.id}">${currentTime ? calculateEndTime(currentTime, row.duration) : '-'}</span>
                    </div>
                `;
                
                menuTimeList.appendChild(menuTimeDiv);
                
                // 메뉴 행 데이터 업데이트
                row.startTime = currentTime;
            });
        }

        // 개별 메뉴 시작 시간 업데이트
        function updateMenuStartTime(menuRowId) {
            const timeInput = document.getElementById(`menuTime_${menuRowId}`);
            const menuRow = menuRows.find(row => row.id === menuRowId);
            
            if (menuRow && timeInput) {
                menuRow.startTime = timeInput.value;
                
                // 종료 시간 업데이트
                const endTimeSpan = document.getElementById(`menuEndTime_${menuRowId}`);
                if (endTimeSpan) {
                    endTimeSpan.textContent = timeInput.value ? calculateEndTime(timeInput.value, menuRow.duration) : '-';
                }
                
                // 다음 메뉴들의 시간도 자동 업데이트
                updateSubsequentMenuTimes(menuRowId);
            }
        }

        // 후속 메뉴들의 시간 자동 업데이트
        function updateSubsequentMenuTimes(changedMenuRowId) {
            const completedMenus = menuRows.filter(row => row.menuId && row.duration);
            const changedIndex = completedMenus.findIndex(row => row.id === changedMenuRowId);
            
            if (changedIndex === -1) return;
            
            // 변경된 메뉴 이후의 메뉴들 업데이트
            for (let i = changedIndex + 1; i < completedMenus.length; i++) {
                const prevMenu = completedMenus[i - 1];
                const currentMenu = completedMenus[i];
                
                if (prevMenu.startTime) {
                    const newStartTime = calculateEndTime(prevMenu.startTime, prevMenu.duration);
                    currentMenu.startTime = newStartTime;
                    
                    // UI 업데이트
                    const timeInput = document.getElementById(`menuTime_${currentMenu.id}`);
                    const endTimeSpan = document.getElementById(`menuEndTime_${currentMenu.id}`);
                    
                    if (timeInput) {
                        timeInput.value = newStartTime;
                    }
                    if (endTimeSpan) {
                        endTimeSpan.textContent = calculateEndTime(newStartTime, currentMenu.duration);
                    }
                }
            }
        }

        // 전체 시작 시간 변경시 모든 메뉴 시간 업데이트
        function updateAllMenuTimes() {
            const globalStartTime = document.getElementById('reservationStartTime').value;
            const completedMenus = menuRows.filter(row => row.menuId && row.duration);
            
            if (!globalStartTime || completedMenus.length === 0) return;
            
            // 첫 번째 메뉴의 시작 시간을 전체 시작 시간으로 설정
            if (completedMenus.length > 0) {
                completedMenus[0].startTime = globalStartTime;
                
                // 나머지 메뉴들은 순차적으로 계산
                for (let i = 1; i < completedMenus.length; i++) {
                    const prevMenu = completedMenus[i - 1];
                    completedMenus[i].startTime = calculateEndTime(prevMenu.startTime, prevMenu.duration);
                }
                
                // UI 업데이트
                updateMenuTimeSettings();
            }
        }

        function loadRoomSelection() {
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const roomSelect = document.getElementById('reservationRoom');
            const selectRoomText = translations[currentLanguage].selectRoomOption || '방 선택';
            roomSelect.innerHTML = `<option value="">${selectRoomText}</option>`;
            rooms.forEach(r => {
                roomSelect.innerHTML += `<option value="${r.id}">${r.roomNumber}</option>`;
            });
        }

        function addReservation() {
            if (!selectedStaff) {
                alert('직원을 선택해주세요.');
                return;
            }

            // 모든 메뉴가 완성되었는지 확인
            const incompleteMenus = menuRows.filter(row => !row.menuId || !row.duration);
            if (incompleteMenus.length > 0) {
                alert('모든 메뉴의 선택을 완료해주세요.');
                return;
            }

            const startTime = document.getElementById('reservationStartTime').value;
            const roomId = document.getElementById('reservationRoom').value;
            const customerName = document.getElementById('reservationCustomer').value;

            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const selectedRoom = rooms.find(r => r.id == roomId);

            // 각 메뉴에 대해 개별 예약 생성
            menuRows.forEach((menuRow, index) => {
                // 개별 메뉴의 시작 시간이 있으면 사용, 없으면 전체 시작 시간 사용
                const menuStartTime = menuRow.startTime || startTime;
                
                const newReservation = {
                    id: Date.now() + index, // 고유 ID 보장
                    date: document.getElementById('currentDate').value,
                    staffId: selectedStaff.id,
                    staffName: selectedStaff.name,
                    menuId: menuRow.menuId,
                    menuName: menuRow.menuName,
                    duration: menuRow.duration,
                    startTime: menuStartTime,
                    roomId: roomId,
                    roomNumber: selectedRoom ? selectedRoom.roomNumber : '',
                    customerName: customerName,
                    price: menuRow.price,
                    commission: menuRow.commission,
                    paid: false,
                    paymentDetails: {},
                    menuOrder: index + 1, // 메뉴 순서
                    isMultiMenu: menuRows.length > 1 // 다중 메뉴 여부
                };

                reservations.push(newReservation);
            });

            localStorage.setItem(getAdminKey('reservations'), JSON.stringify(reservations));

            const menuCount = menuRows.length;
            alert(`${menuCount}개의 메뉴로 예약이 추가되었습니다.`);
            
            // 폼 초기화
            resetReservationForm();
            loadReservationData();
        }

        // 현황판 관련 함수
        function loadDashboard() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const currentDate = document.getElementById('currentDate').value;
            const staffOrder = JSON.parse(localStorage.getItem(getDailyStaffOrderKey(currentDate)) || '{}');
            const todayReservations = reservations.filter(r => r.date === currentDate);
            
            // 순번 순서로 정렬
            todayReservations.sort((a, b) => {
                const orderA = staffOrder[a.staffId] || 999;
                const orderB = staffOrder[b.staffId] || 999;
                return orderA - orderB;
            });
            
            const tableBody = document.getElementById('dashboardTable');
            tableBody.innerHTML = '';

            todayReservations.forEach(reservation => {
                const row = document.createElement('tr');
                const endTime = calculateEndTime(reservation.startTime, reservation.duration);
                const remainingMinutes = calculateRemainingTime(reservation.startTime, reservation.duration, reservation.date);
                
                if (reservation.paid) {
                    row.className = 'bg-green-50';
                }
                
                const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
                
                const staffOrderNum = staffOrder[reservation.staffId] !== undefined ? staffOrder[reservation.staffId] : 1;
                const vacationText = translations[currentLanguage].vacationStatus || '휴가';
                const staffDisplayName = staffOrderNum === 0 ? `${reservation.staffName} (${vacationText})` : `${staffOrderNum}. ${reservation.staffName}`;
                
                // 다중 메뉴인 경우 메뉴명에 순서 표시
                const menuDisplayName = reservation.isMultiMenu ? 
                    `${reservation.menuName} (${reservation.menuOrder})` : 
                    reservation.menuName;
                
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${staffDisplayName}</td>
                    <td class="border border-gray-300 p-2">${menuDisplayName}</td>
                    <td class="border border-gray-300 p-2">${reservation.duration}min</td>
                    <td class="border border-gray-300 p-2">${reservation.startTime || '-'}</td>
                    <td class="border border-gray-300 p-2">${reservation.startTime ? endTime : '-'}</td>
                    <td class="border border-gray-300 p-2 remaining-time">${reservation.paid ? '-' : (reservation.startTime ? (remainingMinutes === -1 ? '-' : remainingMinutes + 'min') : '-')}</td>
                    <td class="border border-gray-300 p-2">${reservation.price.toLocaleString()}${currency.symbol}</td>
                    <td class="border border-gray-300 p-2">${reservation.commission.toLocaleString()}${currency.symbol}</td>
                    <td class="border border-gray-300 p-2">${reservation.roomNumber || '-'}</td>
                    <td class="border border-gray-300 p-2">
                        ${reservation.paid ? 
                            `<span class="bg-green-500 text-white px-3 py-1 rounded text-sm font-bold">${translations[currentLanguage].paymentCompleteStatus || '입금 완료'}</span>` :
                            `<button onclick="editReservation(${reservation.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].edit || '수정'}</button>
                             <button onclick="showPaymentModal(${reservation.id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">${translations[currentLanguage].payment || '입금'}</button>
                             <button onclick="deleteReservation(${reservation.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">${translations[currentLanguage].delete || '삭제'}</button>`
                        }
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function calculateEndTime(startTime, duration) {
            if (!startTime) return '-';
            const [hours, minutes] = startTime.split(':').map(Number);
            const startMinutes = hours * 60 + minutes;
            const endMinutes = startMinutes + duration;
            const endHours = Math.floor(endMinutes / 60);
            const endMins = endMinutes % 60;
            return `${endHours.toString().padStart(2, '0')}:${endMins.toString().padStart(2, '0')}`;
        }

        function calculateRemainingTime(startTime, duration, reservationDate) {
            if (!startTime) return 0;
            
            const now = new Date();
            const currentDate = now.toISOString().split('T')[0];
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            
            // 예약 날짜가 오늘이 아닌 경우
            if (reservationDate && reservationDate !== currentDate) {
                const reservationDateObj = new Date(reservationDate);
                const currentDateObj = new Date(currentDate);
                
                // 예약 날짜가 과거인 경우 시간이 지났음을 의미
                if (reservationDateObj < currentDateObj) {
                    return -1;
                }
                // 예약 날짜가 미래인 경우 아직 시작되지 않음
                if (reservationDateObj > currentDateObj) {
                    return 0;
                }
            }
            
            const [hours, minutes] = startTime.split(':').map(Number);
            const startMinutes = hours * 60 + minutes;
            const endMinutes = startMinutes + duration;
            
            const remaining = endMinutes - currentMinutes;
            return remaining <= 0 ? -1 : remaining; // -1은 시간이 지났음을 의미
        }

        function updateDashboardRemainingTime() {
            const remainingCells = document.querySelectorAll('.remaining-time');
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const currentDate = document.getElementById('currentDate').value;
            const staffOrder = JSON.parse(localStorage.getItem(getDailyStaffOrderKey(currentDate)) || '{}');
            const todayReservations = reservations.filter(r => r.date === currentDate);
            
            // 순번 순서로 정렬
            todayReservations.sort((a, b) => {
                const orderA = staffOrder[a.staffId] || 999;
                const orderB = staffOrder[b.staffId] || 999;
                return orderA - orderB;
            });
            
            remainingCells.forEach((cell, index) => {
                if (todayReservations[index]) {
                    const reservation = todayReservations[index];
                    
                    if (reservation.paid) {
                        cell.textContent = '-';
                        cell.style.color = '#10b981';
                        cell.style.fontWeight = 'bold';
                    } else if (reservation.startTime) {
                        const remaining = calculateRemainingTime(reservation.startTime, reservation.duration, reservation.date);
                        
                        if (remaining === -1) {
                            cell.textContent = '-';
                            cell.style.color = '#6b7280';
                        } else if (remaining === 0) {
                            // 미래 날짜이거나 아직 시작되지 않은 경우
                            cell.textContent = '-';
                            cell.style.color = '#6b7280';
                        } else {
                            cell.textContent = `${remaining}min`;
                            
                            if (remaining <= 10) {
                                cell.style.color = '#ef4444';
                            } else if (remaining <= 30) {
                                cell.style.color = '#f59e0b';
                            } else {
                                cell.style.color = '#10b981';
                            }
                        }
                    } else {
                        cell.textContent = '-';
                        cell.style.color = '#6b7280';
                    }
                }
            });
        }

        // 입금 관련 함수
        function showPaymentModal(reservationId) {
            currentPaymentReservationId = reservationId;
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const reservation = reservations.find(r => r.id === reservationId);
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');

            document.getElementById('paymentTotalAmount').textContent = reservation.price.toLocaleString();
            document.getElementById('paymentCurrency').textContent = currency.symbol;
            document.getElementById('paymentEnteredCurrency').textContent = currency.symbol;
            
            const methodsContainer = document.getElementById('paymentMethods');
            methodsContainer.innerHTML = '';

            paymentMethods.forEach(method => {
                const defaultValue = method.name === '현금' ? reservation.price : '';
                methodsContainer.innerHTML += `
                    <div class="flex items-center gap-2">
                        <label class="w-20">${method.name}:</label>
                        <input type="number" id="payment_${method.id}" class="border rounded px-2 py-1 flex-1" value="${defaultValue}" onchange="updatePaymentTotal()" inputmode="numeric" pattern="[0-9]*">
                        <span>${currency.symbol}</span>
                    </div>
                `;
            });

            document.getElementById('paymentModal').style.display = 'block';
            updatePaymentTotal();
        }

        function updatePaymentTotal() {
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            let total = 0;

            paymentMethods.forEach(method => {
                const input = document.getElementById(`payment_${method.id}`);
                if (input) {
                    total += parseInt(input.value) || 0;
                }
            });

            document.getElementById('paymentEnteredAmount').textContent = total.toLocaleString();
        }

        function processPayment() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const reservation = reservations.find(r => r.id === currentPaymentReservationId);
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            const enteredAmount = parseInt(document.getElementById('paymentEnteredAmount').textContent.replace(/,/g, ''));

            // QR TIP 금액 계산
            let qrTipAmount = 0;
            paymentMethods.forEach(method => {
                if (method.name === 'QR TIP') {
                    const input = document.getElementById(`payment_${method.id}`);
                    if (input) {
                        qrTipAmount += parseInt(input.value) || 0;
                    }
                }
            });

            // QR TIP을 제외한 금액이 예약 가격과 일치하는지 확인
            const amountExcludingTip = enteredAmount - qrTipAmount;
            if (amountExcludingTip !== reservation.price) {
                alert('QR TIP을 제외한 입력된 금액이 총 금액과 일치하지 않습니다.');
                return;
            }

            // 입금 방식별 상세 정보 저장
            const paymentDetails = {};
            paymentMethods.forEach(method => {
                const input = document.getElementById(`payment_${method.id}`);
                if (input && parseInt(input.value) > 0) {
                    paymentDetails[method.name] = parseInt(input.value);
                }
            });

            reservation.paid = true;
            reservation.paymentDetails = paymentDetails;
            localStorage.setItem(getAdminKey('reservations'), JSON.stringify(reservations));

            alert('입금이 완료되었습니다.');
            closePaymentModal();
            loadDashboard();
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').style.display = 'none';
            currentPaymentReservationId = null;
        }

        function deleteReservation(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
                const filteredReservations = reservations.filter(r => r.id !== id);
                localStorage.setItem(getAdminKey('reservations'), JSON.stringify(filteredReservations));
                loadDashboard();
            }
        }

        function editReservation(id) { 
            alert('예약 수정 기능은 추후 구현 예정입니다.'); 
        }

        // 폰트 관련 함수들
        function showFontModal() {
            updateFontModalSelection();
            updateFontPreview();
            document.getElementById('fontModal').style.display = 'block';
        }

        function closeFontModal() {
            document.getElementById('fontModal').style.display = 'none';
        }

        function updateFontModalSelection() {
            // 폰트 크기 버튼 업데이트
            const fontSizeButtons = ['fontSizeSmall', 'fontSizeNormal', 'fontSizeLarge', 'fontSizeXLarge', 'fontSizeXXLarge'];
            fontSizeButtons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                const size = buttonId.replace('fontSize', '').toLowerCase();
                if (size === selectedFontSize) {
                    button.className = 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600';
                } else {
                    button.className = 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
                }
            });

            // 폰트 종류 버튼 업데이트
            const fontFamilyButtons = ['fontFamilyArial', 'fontFamilyNotoKR', 'fontFamilyMalgun', 'fontFamilyNanum', 'fontFamilyRoboto', 'fontFamilyThai', 'fontFamilyVietnamese'];
            fontFamilyButtons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                const fontName = getFontNameFromButtonId(buttonId);
                if (fontName === selectedFontFamily) {
                    button.className = 'bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600';
                } else {
                    button.className = 'bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400';
                }
            });
        }

        function getFontNameFromButtonId(buttonId) {
            const fontMap = {
                'fontFamilyArial': 'Arial',
                'fontFamilyNotoKR': 'Noto Sans KR',
                'fontFamilyMalgun': 'Malgun Gothic',
                'fontFamilyNanum': 'Nanum Gothic',
                'fontFamilyRoboto': 'Roboto',
                'fontFamilyThai': 'Noto Sans Thai',
                'fontFamilyVietnamese': 'Noto Sans Vietnamese'
            };
            return fontMap[buttonId] || 'Arial';
        }

        function setFontSize(size) {
            selectedFontSize = size;
            updateFontModalSelection();
            updateFontPreview();
        }

        function setFontFamily(font) {
            selectedFontFamily = font;
            updateFontModalSelection();
            updateFontPreview();
        }

        function updateFontPreview() {
            const preview = document.getElementById('fontSizePreview');
            if (preview) {
                const fontFamily = getFontFamilyCSS(selectedFontFamily);
                const fontSize = getFontSizeCSS(selectedFontSize);
                
                preview.style.fontFamily = fontFamily;
                preview.style.fontSize = fontSize;
            }
        }

        function getFontFamilyCSS(font) {
            switch(font) {
                case 'Noto Sans KR':
                    return "'Noto Sans KR', sans-serif";
                case 'Malgun Gothic':
                    return "'Malgun Gothic', sans-serif";
                case 'Nanum Gothic':
                    return "'Nanum Gothic', sans-serif";
                case 'Roboto':
                    return "'Roboto', sans-serif";
                case 'Noto Sans Thai':
                    return "'Noto Sans Thai', sans-serif";
                case 'Noto Sans Vietnamese':
                    return "'Noto Sans Vietnamese', sans-serif";
                default:
                    return "Arial, sans-serif";
            }
        }

        function getFontSizeCSS(size) {
            switch(size) {
                case 'small':
                    return '12px';
                case 'normal':
                    return '14px';
                case 'large':
                    return '16px';
                case 'xlarge':
                    return '18px';
                case 'xxlarge':
                    return '20px';
                default:
                    return '14px';
            }
        }

        function applyFontSettings() {
            currentFont = selectedFontFamily;
            currentFontSize = selectedFontSize;
            
            // 로컬 스토리지에 저장
            localStorage.setItem('selectedFont', selectedFontFamily);
            localStorage.setItem('selectedFontSize', selectedFontSize);
            
            const fontFamily = getFontFamilyCSS(selectedFontFamily);
            const fontSize = getFontSizeCSS(selectedFontSize);
            
            // body에 기본 폰트 설정
            document.body.style.fontFamily = fontFamily;
            document.body.style.fontSize = fontSize;
            
            // 모든 요소에 폰트 적용
            const allElements = document.querySelectorAll('*');
            allElements.forEach(element => {
                element.style.fontFamily = fontFamily;
                element.style.fontSize = fontSize;
            });
            
            closeFontModal();
        }

        // 언어 모달 관련 함수들
        function showLanguageModal() {
            document.getElementById('languageModal').style.display = 'block';
        }

        function closeLanguageModal() {
            document.getElementById('languageModal').style.display = 'none';
        }

        function setLanguageAndClose(lang) {
            setLanguage(lang);
            closeLanguageModal();
        }

        // 관리 모달 관련 함수들
        function closeManagementModal() {
            document.getElementById('managementModal').style.display = 'none';
        }

        // DB 관리 함수들
        function manageMenus() {
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="addNewMenu()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">새 메뉴 추가</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 p-2">메뉴명</th>
                                <th class="border border-gray-300 p-2">30분</th>
                                <th class="border border-gray-300 p-2">60분</th>
                                <th class="border border-gray-300 p-2">90분</th>
                                <th class="border border-gray-300 p-2">120분</th>
                                <th class="border border-gray-300 p-2">작업</th>
                            </tr>
                        </thead>
                        <tbody id="menuManagementTable">
            `;
            
            menus.forEach(menu => {
                content += `
                    <tr>
                        <td class="border border-gray-300 p-2">${menu.name}</td>
                        <td class="border border-gray-300 p-2">${menu.prices[30] ? `${menu.prices[30].price}/${menu.prices[30].commission}` : '-'}</td>
                        <td class="border border-gray-300 p-2">${menu.prices[60] ? `${menu.prices[60].price}/${menu.prices[60].commission}` : '-'}</td>
                        <td class="border border-gray-300 p-2">${menu.prices[90] ? `${menu.prices[90].price}/${menu.prices[90].commission}` : '-'}</td>
                        <td class="border border-gray-300 p-2">${menu.prices[120] ? `${menu.prices[120].price}/${menu.prices[120].commission}` : '-'}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editMenu(${menu.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                            <button onclick="deleteMenu(${menu.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>
                        </td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '메뉴 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function manageStaff() {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="addNewStaff()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">새 직원 추가</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 p-2">직원명</th>
                                <th class="border border-gray-300 p-2">전화번호</th>
                                <th class="border border-gray-300 p-2">은행</th>
                                <th class="border border-gray-300 p-2">계좌번호</th>
                                <th class="border border-gray-300 p-2">상태</th>
                                <th class="border border-gray-300 p-2">작업</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            staff.forEach(member => {
                content += `
                    <tr>
                        <td class="border border-gray-300 p-2">${member.name}</td>
                        <td class="border border-gray-300 p-2">${member.phone}</td>
                        <td class="border border-gray-300 p-2">${member.bank}</td>
                        <td class="border border-gray-300 p-2">${member.account}</td>
                        <td class="border border-gray-300 p-2">${member.status || '정직원'}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editStaff(${member.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                            <button onclick="deleteStaff(${member.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>
                        </td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '직원 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function manageRooms() {
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="addNewRoom()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">새 방 추가</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 p-2">방번호</th>
                                <th class="border border-gray-300 p-2">수용인원</th>
                                <th class="border border-gray-300 p-2">작업</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            rooms.forEach(room => {
                content += `
                    <tr>
                        <td class="border border-gray-300 p-2">${room.roomNumber}</td>
                        <td class="border border-gray-300 p-2">${room.capacity}명</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editRoom(${room.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                            <button onclick="deleteRoom(${room.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>
                        </td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '방 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function manageCustomers() {
            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="addNewCustomer()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">새 고객 추가</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 p-2">고객명</th>
                                <th class="border border-gray-300 p-2">전화번호</th>
                                <th class="border border-gray-300 p-2">고객번호</th>
                                <th class="border border-gray-300 p-2">작업</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            customers.forEach(customer => {
                content += `
                    <tr>
                        <td class="border border-gray-300 p-2">${customer.name}</td>
                        <td class="border border-gray-300 p-2">${customer.phone}</td>
                        <td class="border border-gray-300 p-2">${customer.customerNumber}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editCustomer(${customer.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                            <button onclick="deleteCustomer(${customer.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>
                        </td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '고객 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function manageAdmins() {
            if (currentAdmin.type !== 'super') {
                alert('최고 관리자만 접근할 수 있습니다.');
                return;
            }
            
            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="addNewAdmin()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">새 관리자 추가</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 p-2">아이디</th>
                                <th class="border border-gray-300 p-2">타입</th>
                                <th class="border border-gray-300 p-2">상점명</th>
                                <th class="border border-gray-300 p-2">전화번호</th>
                                <th class="border border-gray-300 p-2">작업</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            admins.forEach(admin => {
                content += `
                    <tr>
                        <td class="border border-gray-300 p-2">${admin.username}</td>
                        <td class="border border-gray-300 p-2">${admin.type === 'super' ? '최고관리자' : '일반관리자'}</td>
                        <td class="border border-gray-300 p-2">${admin.shopName || '-'}</td>
                        <td class="border border-gray-300 p-2">${admin.phone || '-'}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editAdmin(${admin.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                            ${admin.id !== 1 ? `<button onclick="deleteAdmin(${admin.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>` : ''}
                        </td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '관리자 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function manageCurrency() {
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            let content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">화폐 기호:</label>
                        <input type="text" id="currencySymbol" value="${currency.symbol}" class="w-full border rounded px-3 py-2" placeholder="예: ₩, $, €">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">화폐 이름:</label>
                        <input type="text" id="currencyName" value="${currency.name}" class="w-full border rounded px-3 py-2" placeholder="예: 원, 달러, 유로">
                    </div>
                    <button onclick="saveCurrency()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">저장</button>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '화폐 단위 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function managePaymentMethods() {
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="addNewPaymentMethod()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">새 입금방식 추가</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 p-2">입금방식명</th>
                                <th class="border border-gray-300 p-2">작업</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            paymentMethods.forEach(method => {
                content += `
                    <tr>
                        <td class="border border-gray-300 p-2">${method.name}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editPaymentMethod(${method.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                            <button onclick="deletePaymentMethod(${method.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>
                        </td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '입금방식 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function manageGuarantee() {
            const guarantees = JSON.parse(localStorage.getItem(getAdminKey('guarantees')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="addNewGuarantee()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">새 Guarantee 추가</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 p-2">날짜</th>
                                <th class="border border-gray-300 p-2">직원명</th>
                                <th class="border border-gray-300 p-2">금액</th>
                                <th class="border border-gray-300 p-2">메모</th>
                                <th class="border border-gray-300 p-2">작업</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            guarantees.forEach(guarantee => {
                content += `
                    <tr>
                        <td class="border border-gray-300 p-2">${guarantee.date}</td>
                        <td class="border border-gray-300 p-2">${guarantee.staffName}</td>
                        <td class="border border-gray-300 p-2">${guarantee.amount.toLocaleString()}</td>
                        <td class="border border-gray-300 p-2">${guarantee.memo || '-'}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editGuarantee(${guarantee.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                            <button onclick="deleteGuarantee(${guarantee.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>
                        </td>
                    </tr>
                `;
            });
            
            content += `
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = 'Guarantee 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        // 통계 관련 함수들
        let currentStatsType = 'daily';

        function showDailyStats() {
            currentStatsType = 'daily';
            updateStatsButtonStyles();
            showDateSelection('daily');
            loadStatistics();
        }

        function showWeeklyStats() {
            currentStatsType = 'weekly';
            updateStatsButtonStyles();
            showDateSelection('range');
            setThisWeek(); // 기본값으로 이번 주 설정
            loadStatistics();
        }

        function showMonthlyStats() {
            currentStatsType = 'monthly';
            updateStatsButtonStyles();
            showDateSelection('range');
            setThisMonth(); // 기본값으로 이번 달 설정
            loadStatistics();
        }

        function updateStatsButtonStyles() {
            // 모든 버튼을 기본 스타일로 초기화
            document.getElementById('dailyStatsBtn').className = 'bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400';
            document.getElementById('weeklyStatsBtn').className = 'bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400';
            document.getElementById('monthlyStatsBtn').className = 'bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400';
            
            // 선택된 버튼만 활성화 스타일 적용
            if (currentStatsType === 'daily') {
                document.getElementById('dailyStatsBtn').className = 'bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600';
            } else if (currentStatsType === 'weekly') {
                document.getElementById('weeklyStatsBtn').className = 'bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600';
            } else if (currentStatsType === 'monthly') {
                document.getElementById('monthlyStatsBtn').className = 'bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600';
            } else if (currentStatsType === 'menuSales') {
                // 월간 메뉴 매출 버튼 활성화 (오렌지색 유지)
            } else if (currentStatsType === 'monthlySalesChart') {
                // 월간 매출 그래프 버튼 활성화 (핑크색 유지)
            }
        }

        function showDateSelection(type) {
            const dailySelection = document.getElementById('dailyDateSelection');
            const rangeSelection = document.getElementById('rangeDateSelection');
            const quickSelection = document.getElementById('quickDateSelection');
            
            if (type === 'daily') {
                dailySelection.style.display = 'block';
                rangeSelection.style.display = 'none';
                quickSelection.style.display = 'none';
            } else if (type === 'range') {
                dailySelection.style.display = 'none';
                rangeSelection.style.display = 'grid';
                quickSelection.style.display = 'flex';
            }
        }

        // 빠른 날짜 선택 함수들
        function setThisWeek() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0: 일요일, 1: 월요일, ...
            const mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // 월요일을 주의 시작으로
            
            const monday = new Date(today);
            monday.setDate(today.getDate() + mondayOffset);
            
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);
            
            document.getElementById('statsStartDate').value = monday.toISOString().split('T')[0];
            document.getElementById('statsEndDate').value = sunday.toISOString().split('T')[0];
            updateStats();
        }

        function setLastWeek() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const lastMondayOffset = dayOfWeek === 0 ? -13 : -6 - dayOfWeek;
            
            const lastMonday = new Date(today);
            lastMonday.setDate(today.getDate() + lastMondayOffset);
            
            const lastSunday = new Date(lastMonday);
            lastSunday.setDate(lastMonday.getDate() + 6);
            
            document.getElementById('statsStartDate').value = lastMonday.toISOString().split('T')[0];
            document.getElementById('statsEndDate').value = lastSunday.toISOString().split('T')[0];
            updateStats();
        }

        function setThisMonth() {
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            document.getElementById('statsStartDate').value = firstDay.toISOString().split('T')[0];
            document.getElementById('statsEndDate').value = lastDay.toISOString().split('T')[0];
            updateStats();
        }

        function setLastMonth() {
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth() - 1, 1);
            const lastDay = new Date(today.getFullYear(), today.getMonth(), 0);
            
            document.getElementById('statsStartDate').value = firstDay.toISOString().split('T')[0];
            document.getElementById('statsEndDate').value = lastDay.toISOString().split('T')[0];
            updateStats();
        }

        function showMenuSales() {
            currentStatsType = 'menuSales';
            updateStatsButtonStyles();
            showDateSelection('range');
            setThisMonth(); // 기본값으로 이번 달 설정
            loadMenuSalesStatistics();
        }

        function showMonthlySalesChart() {
            currentStatsType = 'monthlySalesChart';
            updateStatsButtonStyles();
            showDateSelection('range');
            setThisMonth(); // 기본값으로 이번 달 설정
            loadMonthlySalesChart();
        }

        function downloadExcel() {
            exportStatisticsToExcel();
        }

        function updateStats() {
            loadStatistics();
        }

        // 통계 데이터 로딩 함수
        function loadStatistics() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            let startDate, endDate;
            
            if (currentStatsType === 'daily') {
                startDate = endDate = document.getElementById('statsDate').value;
            } else {
                startDate = document.getElementById('statsStartDate').value;
                endDate = document.getElementById('statsEndDate').value;
            }
            
            if (!startDate || (!endDate && currentStatsType !== 'daily')) {
                return;
            }
            
            // 날짜 범위에 해당하는 입금 완료된 예약만 필터링
            const filteredReservations = reservations.filter(r => {
                if (!r.paid) return false;
                const reservationDate = r.date;
                return reservationDate >= startDate && reservationDate <= endDate;
            });
            
            // 직원별 통계 계산
            const staffStats = calculateStaffStatistics(filteredReservations);
            displayStaffStatistics(staffStats);
            
            // 입금방식별 통계 계산
            const paymentStats = calculatePaymentStatistics(filteredReservations);
            displayPaymentStatistics(paymentStats);
            
            // 총계 계산 및 표시
            displayTotalStatistics(filteredReservations);
        }

        // 직원별 통계 계산
        function calculateStaffStatistics(reservations) {
            const staffStats = {};
            
            reservations.forEach(r => {
                if (!staffStats[r.staffName]) {
                    staffStats[r.staffName] = {
                        totalPrice: 0,
                        totalCommission: 0
                    };
                }
                
                staffStats[r.staffName].totalPrice += r.price;
                staffStats[r.staffName].totalCommission += r.commission;
            });
            
            return staffStats;
        }

        // 입금방식별 통계 계산
        function calculatePaymentStatistics(reservations) {
            const paymentStats = {};
            
            reservations.forEach(r => {
                if (r.paymentDetails) {
                    Object.entries(r.paymentDetails).forEach(([method, amount]) => {
                        if (!paymentStats[method]) {
                            paymentStats[method] = 0;
                        }
                        paymentStats[method] += amount;
                    });
                }
            });
            
            return paymentStats;
        }

        // 직원별 통계 표시
        function displayStaffStatistics(staffStats) {
            const tableBody = document.getElementById('statsTable');
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            
            tableBody.innerHTML = '';
            
            // 기본 테이블 헤더로 복원
            const headerRow = tableBody.parentElement.querySelector('thead tr');
            headerRow.innerHTML = `
                <th class="border border-gray-300 p-2" data-translate="staff">마사지사</th>
                <th class="border border-gray-300 p-2" data-translate="totalPrice">총 가격</th>
                <th class="border border-gray-300 p-2" data-translate="totalCommission">총 커미션</th>
            `;
            
            Object.entries(staffStats).forEach(([staffName, stats]) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${staffName}</td>
                    <td class="border border-gray-300 p-2">${stats.totalPrice.toLocaleString()}${currency.symbol}</td>
                    <td class="border border-gray-300 p-2">${stats.totalCommission.toLocaleString()}${currency.symbol}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // 입금방식별 통계 표시
        function displayPaymentStatistics(paymentStats) {
            const tableBody = document.getElementById('paymentStatsTable');
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            
            tableBody.innerHTML = '';
            
            Object.entries(paymentStats).forEach(([method, amount]) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${method}</td>
                    <td class="border border-gray-300 p-2">${amount.toLocaleString()}${currency.symbol}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // 총계 표시
        function displayTotalStatistics(reservations) {
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            
            // QR TIP을 제외한 총 금액 계산
            let grandTotalPrice = 0;
            let grandTotalCommission = 0;
            let qrTipTotal = 0;
            
            reservations.forEach(r => {
                grandTotalPrice += r.price;
                grandTotalCommission += r.commission;
                
                // QR TIP 금액 계산
                if (r.paymentDetails && r.paymentDetails['QR TIP']) {
                    qrTipTotal += r.paymentDetails['QR TIP'];
                }
            });
            
            const profit = grandTotalPrice - grandTotalCommission;
            
            document.getElementById('grandTotalPrice').textContent = grandTotalPrice.toLocaleString();
            document.getElementById('grandTotalCommission').textContent = grandTotalCommission.toLocaleString();
            document.getElementById('totalProfit').textContent = profit.toLocaleString();
            
            // 화폐 단위 업데이트
            document.getElementById('grandTotalCurrency').textContent = currency.symbol;
            document.getElementById('grandTotalCommissionCurrency').textContent = currency.symbol;
            document.getElementById('totalProfitCurrency').textContent = currency.symbol;
        }

        // 메뉴별 매출 통계 로딩
        function loadMenuSalesStatistics() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const startDate = document.getElementById('statsStartDate').value;
            const endDate = document.getElementById('statsEndDate').value;
            
            if (!startDate || !endDate) {
                return;
            }
            
            // 날짜 범위에 해당하는 입금 완료된 예약만 필터링
            const filteredReservations = reservations.filter(r => {
                if (!r.paid) return false;
                const reservationDate = r.date;
                return reservationDate >= startDate && reservationDate <= endDate;
            });
            
            // 메뉴별 매출 계산
            const menuSales = {};
            filteredReservations.forEach(r => {
                if (!menuSales[r.menuName]) {
                    menuSales[r.menuName] = {
                        count: 0,
                        totalPrice: 0,
                        totalCommission: 0
                    };
                }
                menuSales[r.menuName].count++;
                menuSales[r.menuName].totalPrice += r.price;
                menuSales[r.menuName].totalCommission += r.commission;
            });
            
            // 메뉴별 매출 표시
            displayMenuSalesStatistics(menuSales);
            
            // 입금방식별 통계도 함께 표시
            const paymentStats = calculatePaymentStatistics(filteredReservations);
            displayPaymentStatistics(paymentStats);
            
            // 총계 표시
            displayTotalStatistics(filteredReservations);
        }

        // 메뉴별 매출 통계 표시
        function displayMenuSalesStatistics(menuSales) {
            const tableBody = document.getElementById('statsTable');
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            
            tableBody.innerHTML = '';
            
            // 테이블 헤더 변경
            const headerRow = tableBody.parentElement.querySelector('thead tr');
            headerRow.innerHTML = `
                <th class="border border-gray-300 p-2">메뉴명</th>
                <th class="border border-gray-300 p-2">판매 횟수</th>
                <th class="border border-gray-300 p-2">총 매출</th>
                <th class="border border-gray-300 p-2">총 커미션</th>
            `;
            
            Object.entries(menuSales).forEach(([menuName, stats]) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${menuName}</td>
                    <td class="border border-gray-300 p-2">${stats.count}회</td>
                    <td class="border border-gray-300 p-2">${stats.totalPrice.toLocaleString()}${currency.symbol}</td>
                    <td class="border border-gray-300 p-2">${stats.totalCommission.toLocaleString()}${currency.symbol}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // 월간 매출 차트 로딩
        function loadMonthlySalesChart() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const startDate = document.getElementById('statsStartDate').value;
            const endDate = document.getElementById('statsEndDate').value;
            
            if (!startDate || !endDate) {
                return;
            }
            
            // 날짜 범위에 해당하는 입금 완료된 예약만 필터링
            const filteredReservations = reservations.filter(r => {
                if (!r.paid) return false;
                const reservationDate = r.date;
                return reservationDate >= startDate && reservationDate <= endDate;
            });
            
            // 일별 매출 계산
            const dailySales = {};
            filteredReservations.forEach(r => {
                if (!dailySales[r.date]) {
                    dailySales[r.date] = 0;
                }
                dailySales[r.date] += r.price;
            });
            
            // 차트 데이터 표시 (간단한 텍스트 형태)
            displayMonthlySalesChart(dailySales);
            
            // 입금방식별 통계도 함께 표시
            const paymentStats = calculatePaymentStatistics(filteredReservations);
            displayPaymentStatistics(paymentStats);
            
            // 총계 표시
            displayTotalStatistics(filteredReservations);
        }

        // 월간 매출 차트 표시 (간단한 텍스트 형태)
        function displayMonthlySalesChart(dailySales) {
            const tableBody = document.getElementById('statsTable');
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            
            tableBody.innerHTML = '';
            
            // 테이블 헤더 변경
            const headerRow = tableBody.parentElement.querySelector('thead tr');
            headerRow.innerHTML = `
                <th class="border border-gray-300 p-2">날짜</th>
                <th class="border border-gray-300 p-2">일일 매출</th>
                <th class="border border-gray-300 p-2">매출 그래프</th>
            `;
            
            // 최대 매출 계산 (그래프 스케일용)
            const maxSales = Math.max(...Object.values(dailySales));
            
            Object.entries(dailySales).sort().forEach(([date, sales]) => {
                const percentage = maxSales > 0 ? (sales / maxSales) * 100 : 0;
                const barWidth = Math.max(percentage, 5); // 최소 5% 너비
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${date}</td>
                    <td class="border border-gray-300 p-2">${sales.toLocaleString()}${currency.symbol}</td>
                    <td class="border border-gray-300 p-2">
                        <div class="w-full bg-gray-200 rounded-full h-6">
                            <div class="bg-blue-500 h-6 rounded-full flex items-center justify-center text-white text-xs" 
                                 style="width: ${barWidth}%">
                                ${percentage.toFixed(1)}%
                            </div>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // 엑셀 내보내기 함수
        function exportStatisticsToExcel() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            let startDate, endDate;
            
            if (currentStatsType === 'daily') {
                startDate = endDate = document.getElementById('statsDate').value;
            } else {
                startDate = document.getElementById('statsStartDate').value;
                endDate = document.getElementById('statsEndDate').value;
            }
            
            if (!startDate || (!endDate && currentStatsType !== 'daily')) {
                alert('날짜를 선택해주세요.');
                return;
            }
            
            // 날짜 범위에 해당하는 입금 완료된 예약만 필터링
            const filteredReservations = reservations.filter(r => {
                if (!r.paid) return false;
                const reservationDate = r.date;
                return reservationDate >= startDate && reservationDate <= endDate;
            });
            
            if (filteredReservations.length === 0) {
                alert('해당 기간에 데이터가 없습니다.');
                return;
            }
            
            showExportDialog(filteredReservations, startDate, endDate, 'statistics');
        }

        function showExportDialog(data, startDate, endDate, exportType) {
            const defaultFileName = exportType === 'statistics' ? 
                `통계_${startDate}_${endDate}` : 
                `전체데이터_${currentAdmin.username}_${new Date().toISOString().split('T')[0]}`;
                
            const content = `
                <div class="space-y-4">
                    <div class="text-center">
                        <h3 class="text-lg font-bold mb-4">엑셀 내보내기</h3>
                        <p class="text-gray-600 mb-4">데이터를 CSV 파일로 내보냅니다.</p>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded p-3">
                        <div class="text-sm text-blue-800">
                            <div><strong>데이터 개수:</strong> ${data.length}개</div>
                            <div><strong>기간:</strong> ${startDate}${endDate !== startDate ? ` ~ ${endDate}` : ''}</div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">파일명:</label>
                        <input type="text" id="exportFileName" 
                               value="${defaultFileName}" 
                               class="w-full border rounded px-3 py-2" 
                               placeholder="내보낼 파일명을 입력하세요">
                        <div class="text-xs text-gray-500 mt-1">* .csv 확장자는 자동으로 추가됩니다</div>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded p-3">
                        <div class="text-sm text-yellow-800">
                            <strong>참고:</strong> 브라우저 보안상 저장 경로는 기본 다운로드 폴더로 설정됩니다.<br>
                            다운로드 후 원하는 위치로 파일을 이동하실 수 있습니다.
                        </div>
                    </div>
                    
                    <div class="flex gap-2 justify-center">
                        <button onclick="executeExport('${exportType}')" class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">내보내기 실행</button>
                        <button onclick="closeManagementModal()" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '엑셀 내보내기';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
            
            // 전역 변수에 데이터 저장 (executeExport에서 사용)
            window.exportData = { data, startDate, endDate };
        }

        function executeExport(exportType) {
            const fileName = document.getElementById('exportFileName').value.trim();
            if (!fileName) {
                alert('파일명을 입력해주세요.');
                return;
            }

            const { data, startDate, endDate } = window.exportData;
            
            try {
                // CSV 형태로 데이터 생성
                let csvContent = '\uFEFF'; // UTF-8 BOM
                
                if (exportType === 'statistics') {
                    csvContent += '날짜,직원명,메뉴,시간,가격,커미션,방번호,고객명\n';
                    data.forEach(r => {
                        csvContent += `${r.date},${r.staffName},${r.menuName},${r.duration}분,${r.price},${r.commission},${r.roomNumber || ''},${r.customerName || ''}\n`;
                    });
                } else {
                    csvContent += '날짜,직원명,메뉴,시간(분),시작시간,끝시간,가격,커미션,방번호,고객명,입금상태\n';
                    data.forEach(r => {
                        const endTime = calculateEndTime(r.startTime, r.duration);
                        const paymentStatus = r.paid ? '입금완료' : '미입금';
                        csvContent += `${r.date},${r.staffName},${r.menuName},${r.duration},${r.startTime || ''},${r.startTime ? endTime : ''},${r.price},${r.commission},${r.roomNumber || ''},${r.customerName || ''},${paymentStatus}\n`;
                    });
                }
                
                // 파일 다운로드
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', fileName.endsWith('.csv') ? fileName : `${fileName}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert(`내보내기가 완료되었습니다.\n파일명: ${link.download}\n위치: 기본 다운로드 폴더`);
                closeManagementModal();
            } catch (error) {
                alert('내보내기 중 오류가 발생했습니다: ' + error.message);
            }
        }

        // 시작 날짜 입력시 자동으로 끝 날짜 설정
        function autoSetEndDate() {
            const startDateInput = document.getElementById('statsStartDate');
            const endDateInput = document.getElementById('statsEndDate');
            
            if (!startDateInput.value) return;
            
            const startDate = new Date(startDateInput.value);
            let endDate = new Date(startDate);
            
            // 현재 통계 타입에 따라 끝 날짜 자동 설정
            if (currentStatsType === 'weekly') {
                // 주간: 시작일로부터 6일 후 (일주일)
                endDate.setDate(startDate.getDate() + 6);
            } else if (currentStatsType === 'monthly' || currentStatsType === 'menuChart' || currentStatsType === 'monthlyChart') {
                // 월간: 시작일이 속한 달의 마지막 날
                endDate = new Date(startDate.getFullYear(), startDate.getMonth() + 1, 0);
            }
            
            endDateInput.value = endDate.toISOString().split('T')[0];
            updateStats();
        }

        // 백업/복원 관련 함수들
        function showLocalBackupDialog() {
            const content = `
                <div class="space-y-4">
                    <div class="text-center">
                        <h3 class="text-lg font-bold mb-4">로컬 백업</h3>
                        <p class="text-gray-600 mb-4">현재 데이터를 JSON 파일로 백업합니다.</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">파일명:</label>
                        <input type="text" id="backupFileName" 
                               value="massage_backup_${currentAdmin.username}_${new Date().toISOString().split('T')[0]}" 
                               class="w-full border rounded px-3 py-2" 
                               placeholder="백업 파일명을 입력하세요">
                        <div class="text-xs text-gray-500 mt-1">* .json 확장자는 자동으로 추가됩니다</div>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded p-3">
                        <div class="text-sm text-yellow-800">
                            <strong>참고:</strong> 브라우저 보안상 저장 경로는 기본 다운로드 폴더로 설정됩니다.<br>
                            다운로드 후 원하는 위치로 파일을 이동하실 수 있습니다.
                        </div>
                    </div>
                    
                    <div class="flex gap-2 justify-center">
                        <button onclick="performLocalBackup()" class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">백업 실행</button>
                        <button onclick="closeManagementModal()" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '로컬 백업';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function performLocalBackup() {
            try {
                const fileName = document.getElementById('backupFileName').value.trim();
                if (!fileName) {
                    alert('파일명을 입력해주세요.');
                    return;
                }

                const backupData = {
                    timestamp: new Date().toISOString(),
                    adminUsername: currentAdmin.username,
                    data: {
                        menus: localStorage.getItem(getAdminKey('menus')),
                        staff: localStorage.getItem(getAdminKey('staff')),
                        rooms: localStorage.getItem(getAdminKey('rooms')),
                        customers: localStorage.getItem(getAdminKey('customers')),
                        paymentMethods: localStorage.getItem(getAdminKey('paymentMethods')),
                        reservations: localStorage.getItem(getAdminKey('reservations')),
                        currency: localStorage.getItem(getAdminKey('currency')),
                        guarantees: localStorage.getItem(getAdminKey('guarantees')),
                        staffOrders: {}
                    }
                };

                // 모든 날짜별 순번 데이터 백업
                for (let key in localStorage) {
                    if (key.startsWith(`${currentAdmin.username}_staffOrder_`)) {
                        const date = key.replace(`${currentAdmin.username}_staffOrder_`, '');
                        backupData.data.staffOrders[date] = localStorage.getItem(key);
                    }
                }

                const jsonString = JSON.stringify(backupData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = fileName.endsWith('.json') ? fileName : `${fileName}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                alert(`백업이 완료되었습니다.\n파일명: ${link.download}\n위치: 기본 다운로드 폴더`);
                closeManagementModal();
            } catch (error) {
                alert('백업 중 오류가 발생했습니다: ' + error.message);
            }
        }

        function showLocalRestoreDialog() {
            const content = `
                <div class="space-y-4">
                    <div class="text-center">
                        <h3 class="text-lg font-bold mb-4">로컬 복원</h3>
                        <p class="text-gray-600 mb-4">백업 파일을 선택하여 데이터를 복원합니다.</p>
                    </div>
                    
                    <div class="bg-red-50 border border-red-200 rounded p-3">
                        <div class="text-sm text-red-800">
                            <strong>⚠️ 주의:</strong> 현재 데이터가 모두 삭제되고 백업 데이터로 대체됩니다.<br>
                            복원 전에 현재 데이터를 백업하는 것을 권장합니다.
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">백업 파일 선택:</label>
                        <input type="file" id="restoreFileInput" accept=".json"
                               class="w-full border rounded px-3 py-2 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        <div class="text-xs text-gray-500 mt-1">* JSON 형식의 백업 파일만 선택 가능합니다</div>
                    </div>
                    
                    <div id="fileInfo" class="hidden bg-blue-50 border border-blue-200 rounded p-3">
                        <div class="text-sm text-blue-800">
                            <div><strong>파일명:</strong> <span id="selectedFileName"></span></div>
                            <div><strong>파일 크기:</strong> <span id="selectedFileSize"></span></div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2 justify-center">
                        <button onclick="executeRestore()" class="bg-orange-500 text-white px-6 py-2 rounded hover:bg-orange-600">복원 실행</button>
                        <button onclick="closeManagementModal()" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '로컬 복원';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
            
            // 파일 선택 이벤트 리스너 추가
            document.getElementById('restoreFileInput').addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    document.getElementById('selectedFileName').textContent = file.name;
                    document.getElementById('selectedFileSize').textContent = formatFileSize(file.size);
                    document.getElementById('fileInfo').classList.remove('hidden');
                } else {
                    document.getElementById('fileInfo').classList.add('hidden');
                }
            });
        }

        function executeRestore() {
            const fileInput = document.getElementById('restoreFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('복원할 파일을 선택해주세요.');
                return;
            }

            if (!confirm('현재 데이터가 모두 삭제되고 백업 데이터로 복원됩니다. 계속하시겠습니까?')) {
                return;
            }

            restoreData({ target: { files: [file] } });
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (!confirm('현재 데이터가 모두 삭제되고 백업 데이터로 복원됩니다. 계속하시겠습니까?')) {
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (!backupData.data || !backupData.adminUsername) {
                        alert('올바르지 않은 백업 파일입니다.');
                        return;
                    }

                    if (backupData.adminUsername !== currentAdmin.username) {
                        if (!confirm(`이 백업은 다른 관리자(${backupData.adminUsername})의 데이터입니다. 계속하시겠습니까?`)) {
                            return;
                        }
                    }

                    // 기존 데이터 삭제
                    const keysToRemove = [];
                    for (let key in localStorage) {
                        if (key.startsWith(currentAdmin.username + '_')) {
                            keysToRemove.push(key);
                        }
                    }
                    keysToRemove.forEach(key => localStorage.removeItem(key));

                    // 백업 데이터 복원
                    if (backupData.data.menus) localStorage.setItem(getAdminKey('menus'), backupData.data.menus);
                    if (backupData.data.staff) localStorage.setItem(getAdminKey('staff'), backupData.data.staff);
                    if (backupData.data.rooms) localStorage.setItem(getAdminKey('rooms'), backupData.data.rooms);
                    if (backupData.data.customers) localStorage.setItem(getAdminKey('customers'), backupData.data.customers);
                    if (backupData.data.paymentMethods) localStorage.setItem(getAdminKey('paymentMethods'), backupData.data.paymentMethods);
                    if (backupData.data.reservations) localStorage.setItem(getAdminKey('reservations'), backupData.data.reservations);
                    if (backupData.data.currency) localStorage.setItem(getAdminKey('currency'), backupData.data.currency);
                    if (backupData.data.guarantees) localStorage.setItem(getAdminKey('guarantees'), backupData.data.guarantees);

                    // 순번 데이터 복원
                    if (backupData.data.staffOrders) {
                        for (let date in backupData.data.staffOrders) {
                            localStorage.setItem(getDailyStaffOrderKey(date), backupData.data.staffOrders[date]);
                        }
                    }

                    alert(`데이터 복원이 완료되었습니다. (백업 날짜: ${new Date(backupData.timestamp).toLocaleString()})`);
                    
                    // 화면 새로고침
                    location.reload();
                } catch (error) {
                    alert('복원 중 오류가 발생했습니다: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function showGoogleBackupDialog() {
            const content = `
                <div class="space-y-4">
                    <div class="text-center">
                        <h3 class="text-lg font-bold mb-4">구글 드라이브 백업</h3>
                        <p class="text-gray-600 mb-4">구글 드라이브에 데이터를 백업합니다.</p>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded p-3">
                        <div class="text-sm text-blue-800">
                            <strong>참고:</strong> 구글 계정에 로그인하여 드라이브에 백업 파일을 저장합니다.<br>
                            백업 파일은 "massage_backup_[날짜].json" 형식으로 저장됩니다.
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">파일명:</label>
                        <input type="text" id="googleBackupFileName" 
                               value="massage_backup_${currentAdmin.username}_${new Date().toISOString().split('T')[0]}" 
                               class="w-full border rounded px-3 py-2" 
                               placeholder="백업 파일명을 입력하세요">
                        <div class="text-xs text-gray-500 mt-1">* .json 확장자는 자동으로 추가됩니다</div>
                    </div>
                    
                    <div class="flex gap-2 justify-center">
                        <button onclick="performGoogleBackup()" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">구글 로그인 후 백업</button>
                        <button onclick="closeManagementModal()" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '구글 드라이브 백업';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function showGoogleRestoreDialog() {
            const content = `
                <div class="space-y-4">
                    <div class="text-center">
                        <h3 class="text-lg font-bold mb-4">구글 드라이브 복원</h3>
                        <p class="text-gray-600 mb-4">구글 드라이브에서 백업 파일을 선택하여 복원합니다.</p>
                    </div>
                    
                    <div class="bg-red-50 border border-red-200 rounded p-3">
                        <div class="text-sm text-red-800">
                            <strong>⚠️ 주의:</strong> 현재 데이터가 모두 삭제되고 백업 데이터로 대체됩니다.<br>
                            복원 전에 현재 데이터를 백업하는 것을 권장합니다.
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded p-3">
                        <div class="text-sm text-blue-800">
                            <strong>참고:</strong> 구글 계정에 로그인하여 드라이브에서 백업 파일을 선택합니다.<br>
                            JSON 형식의 백업 파일만 복원 가능합니다.
                        </div>
                    </div>
                    
                    <div class="flex gap-2 justify-center">
                        <button onclick="performGoogleRestore()" class="bg-orange-500 text-white px-6 py-2 rounded hover:bg-orange-600">구글 로그인 후 복원</button>
                        <button onclick="closeManagementModal()" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '구글 드라이브 복원';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function closeGoogleLoginModal() {
            document.getElementById('googleLoginModal').style.display = 'none';
        }

        function processGoogleLogin() {
            const email = document.getElementById('googleEmail').value;
            const password = document.getElementById('googlePassword').value;
            
            if (!email || !password) {
                alert('이메일과 비밀번호를 입력해주세요.');
                return;
            }
            
            // 간단한 이메일 형식 검증
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('올바른 이메일 형식을 입력해주세요.');
                return;
            }
            
            // 구글 로그인 시뮬레이션 (실제로는 OAuth를 사용해야 함)
            const loginButton = document.getElementById('googleLoginConfirm');
            loginButton.textContent = '로그인 중...';
            loginButton.disabled = true;
            
            setTimeout(() => {
                // 로그인 성공 시뮬레이션
                localStorage.setItem('googleAuth', JSON.stringify({
                    email: email,
                    authenticated: true,
                    timestamp: new Date().toISOString()
                }));
                
                alert(`구글 계정 로그인 성공!\n계정: ${email}`);
                closeGoogleLoginModal();
                
                // 백업 또는 복원 작업 실행
                if (window.googleAction === 'backup') {
                    executeGoogleBackup();
                } else if (window.googleAction === 'restore') {
                    executeGoogleRestore();
                }
                
                loginButton.textContent = '로그인';
                loginButton.disabled = false;
            }, 2000);
        }

        function performGoogleBackup() {
            const fileName = document.getElementById('googleBackupFileName').value.trim();
            if (!fileName) {
                alert('파일명을 입력해주세요.');
                return;
            }
            
            window.googleAction = 'backup';
            window.googleBackupFileName = fileName;
            showGoogleLoginModal();
        }

        function performGoogleRestore() {
            window.googleAction = 'restore';
            showGoogleLoginModal();
        }

        function showGoogleLoginModal() {
            document.getElementById('googleEmail').value = '';
            document.getElementById('googlePassword').value = '';
            document.getElementById('googleLoginModal').style.display = 'block';
        }

        function executeGoogleBackup() {
            try {
                const fileName = window.googleBackupFileName;
                const backupData = {
                    timestamp: new Date().toISOString(),
                    adminUsername: currentAdmin.username,
                    data: {
                        menus: localStorage.getItem(getAdminKey('menus')),
                        staff: localStorage.getItem(getAdminKey('staff')),
                        rooms: localStorage.getItem(getAdminKey('rooms')),
                        customers: localStorage.getItem(getAdminKey('customers')),
                        paymentMethods: localStorage.getItem(getAdminKey('paymentMethods')),
                        reservations: localStorage.getItem(getAdminKey('reservations')),
                        currency: localStorage.getItem(getAdminKey('currency')),
                        guarantees: localStorage.getItem(getAdminKey('guarantees')),
                        staffOrders: {}
                    }
                };

                // 모든 날짜별 순번 데이터 백업
                for (let key in localStorage) {
                    if (key.startsWith(`${currentAdmin.username}_staffOrder_`)) {
                        const date = key.replace(`${currentAdmin.username}_staffOrder_`, '');
                        backupData.data.staffOrders[date] = localStorage.getItem(key);
                    }
                }

                // 구글 드라이브 업로드 시뮬레이션
                const jsonString = JSON.stringify(backupData, null, 2);
                
                // 실제로는 Google Drive API를 사용해야 하지만, 여기서는 로컬 다운로드로 대체
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = fileName.endsWith('.json') ? fileName : `${fileName}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                alert(`구글 드라이브 백업이 완료되었습니다!\n파일명: ${link.download}\n\n* 현재는 로컬 다운로드로 제공됩니다.\n실제 구글 드라이브 연동은 추후 업데이트 예정입니다.`);
                closeManagementModal();
            } catch (error) {
                alert('구글 백업 중 오류가 발생했습니다: ' + error.message);
            }
        }

        function executeGoogleRestore() {
            // 구글 드라이브에서 파일 선택 시뮬레이션
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;

                if (!confirm('구글 드라이브에서 선택한 파일로 현재 데이터를 복원하시겠습니까?\n현재 데이터가 모두 삭제됩니다.')) {
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        
                        if (!backupData.data || !backupData.adminUsername) {
                            alert('올바르지 않은 백업 파일입니다.');
                            return;
                        }

                        if (backupData.adminUsername !== currentAdmin.username) {
                            if (!confirm(`이 백업은 다른 관리자(${backupData.adminUsername})의 데이터입니다. 계속하시겠습니까?`)) {
                                return;
                            }
                        }

                        // 기존 데이터 삭제
                        const keysToRemove = [];
                        for (let key in localStorage) {
                            if (key.startsWith(currentAdmin.username + '_')) {
                                keysToRemove.push(key);
                            }
                        }
                        keysToRemove.forEach(key => localStorage.removeItem(key));

                        // 백업 데이터 복원
                        if (backupData.data.menus) localStorage.setItem(getAdminKey('menus'), backupData.data.menus);
                        if (backupData.data.staff) localStorage.setItem(getAdminKey('staff'), backupData.data.staff);
                        if (backupData.data.rooms) localStorage.setItem(getAdminKey('rooms'), backupData.data.rooms);
                        if (backupData.data.customers) localStorage.setItem(getAdminKey('customers'), backupData.data.customers);
                        if (backupData.data.paymentMethods) localStorage.setItem(getAdminKey('paymentMethods'), backupData.data.paymentMethods);
                        if (backupData.data.reservations) localStorage.setItem(getAdminKey('reservations'), backupData.data.reservations);
                        if (backupData.data.currency) localStorage.setItem(getAdminKey('currency'), backupData.data.currency);
                        if (backupData.data.guarantees) localStorage.setItem(getAdminKey('guarantees'), backupData.data.guarantees);

                        // 순번 데이터 복원
                        if (backupData.data.staffOrders) {
                            for (let date in backupData.data.staffOrders) {
                                localStorage.setItem(getDailyStaffOrderKey(date), backupData.data.staffOrders[date]);
                            }
                        }

                        alert(`구글 드라이브 복원이 완료되었습니다!\n백업 날짜: ${new Date(backupData.timestamp).toLocaleString()}\n\n* 현재는 로컬 파일 선택으로 제공됩니다.\n실제 구글 드라이브 연동은 추후 업데이트 예정입니다.`);
                        
                        // 화면 새로고침
                        location.reload();
                    } catch (error) {
                        alert('구글 복원 중 오류가 발생했습니다: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
            closeManagementModal();
        }

        function exportAllDataExcel() {
            try {
                const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
                
                if (reservations.length === 0) {
                    alert('내보낼 데이터가 없습니다.');
                    return;
                }
                
                // 날짜 범위 계산
                const dates = reservations.map(r => r.date).sort();
                const startDate = dates[0];
                const endDate = dates[dates.length - 1];
                
                showExportDialog(reservations, startDate, endDate, 'allData');
            } catch (error) {
                alert('데이터 내보내기 중 오류가 발생했습니다: ' + error.message);
            }
        }

        // 순번 관리 관련 함수들
        function loadStaffOrder() {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const currentDate = document.getElementById('currentDate').value;
            const staffOrder = JSON.parse(localStorage.getItem(getDailyStaffOrderKey(currentDate)) || '{}');
            
            // 정직원과 단기고용 직원만 필터링
            const activeStaff = staff.filter(s => {
                const status = s.status || '정직원';
                return status === '정직원' || status === '단기고용';
            });
            
            const tableBody = document.getElementById('orderTable');
            tableBody.innerHTML = '';

            activeStaff.forEach(member => {
                const currentOrder = staffOrder[member.id] !== undefined ? staffOrder[member.id] : 1;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${member.name}</td>
                    <td class="border border-gray-300 p-2">${member.status || '정직원'}</td>
                    <td class="border border-gray-300 p-2">
                        <select id="order_${member.id}" class="w-full border rounded px-2 py-1">
                            ${generateOrderOptions(currentOrder)}
                        </select>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function generateOrderOptions(selectedOrder) {
            let options = '';
            for (let i = 0; i <= 99; i++) {
                const selected = i === selectedOrder ? 'selected' : '';
                const label = i === 0 ? `${i} (휴가)` : i;
                options += `<option value="${i}" ${selected}>${label}</option>`;
            }
            return options;
        }

        function saveStaffOrder() {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const activeStaff = staff.filter(s => {
                const status = s.status || '정직원';
                return status === '정직원' || status === '단기고용';
            });
            const currentDate = document.getElementById('currentDate').value;
            const staffOrder = {};

            activeStaff.forEach(member => {
                const orderSelect = document.getElementById(`order_${member.id}`);
                if (orderSelect) {
                    staffOrder[member.id] = parseInt(orderSelect.value);
                }
            });

            localStorage.setItem(getDailyStaffOrderKey(currentDate), JSON.stringify(staffOrder));
            alert(`${currentDate} 날짜의 순번이 저장되었습니다.`);
            loadReservationData(); // 예약 화면 업데이트
            loadStaffOrder(); // 순번 화면 새로고침
        }

        // DB 관리 세부 기능들
        
        // 메뉴 관리 함수들
        function addNewMenu() {
            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">메뉴명:</label>
                        <input type="text" id="newMenuName" class="w-full border rounded px-3 py-2" placeholder="메뉴명을 입력하세요">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">30분 가격/커미션:</label>
                            <div class="flex gap-2">
                                <input type="number" id="menu30Price" class="flex-1 border rounded px-2 py-1" placeholder="가격">
                                <input type="number" id="menu30Commission" class="flex-1 border rounded px-2 py-1" placeholder="커미션">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">60분 가격/커미션:</label>
                            <div class="flex gap-2">
                                <input type="number" id="menu60Price" class="flex-1 border rounded px-2 py-1" placeholder="가격">
                                <input type="number" id="menu60Commission" class="flex-1 border rounded px-2 py-1" placeholder="커미션">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">90분 가격/커미션:</label>
                            <div class="flex gap-2">
                                <input type="number" id="menu90Price" class="flex-1 border rounded px-2 py-1" placeholder="가격">
                                <input type="number" id="menu90Commission" class="flex-1 border rounded px-2 py-1" placeholder="커미션">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">120분 가격/커미션:</label>
                            <div class="flex gap-2">
                                <input type="number" id="menu120Price" class="flex-1 border rounded px-2 py-1" placeholder="가격">
                                <input type="number" id="menu120Commission" class="flex-1 border rounded px-2 py-1" placeholder="커미션">
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="saveNewMenu()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">저장</button>
                        <button onclick="manageMenus()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '새 메뉴 추가';
            document.getElementById('managementContent').innerHTML = content;
        }

        function saveNewMenu() {
            const name = document.getElementById('newMenuName').value;
            if (!name) {
                alert('메뉴명을 입력해주세요.');
                return;
            }

            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const newId = Math.max(...menus.map(m => m.id), 0) + 1;
            
            const prices = {};
            const durations = [30, 60, 90, 120];
            
            durations.forEach(duration => {
                const price = parseInt(document.getElementById(`menu${duration}Price`).value);
                const commission = parseInt(document.getElementById(`menu${duration}Commission`).value);
                
                if (price && commission) {
                    prices[duration] = { price, commission };
                }
            });

            if (Object.keys(prices).length === 0) {
                alert('최소 하나의 시간대에 대한 가격과 커미션을 입력해주세요.');
                return;
            }

            menus.push({
                id: newId,
                name: name,
                prices: prices
            });

            localStorage.setItem(getAdminKey('menus'), JSON.stringify(menus));
            alert('메뉴가 추가되었습니다.');
            manageMenus();
        }

        function editMenu(id) {
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menu = menus.find(m => m.id === id);
            
            if (!menu) return;

            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">메뉴명:</label>
                        <input type="text" id="editMenuName" value="${menu.name}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">30분 가격/커미션:</label>
                            <div class="flex gap-2">
                                <input type="number" id="editMenu30Price" value="${menu.prices[30]?.price || ''}" class="flex-1 border rounded px-2 py-1" placeholder="가격">
                                <input type="number" id="editMenu30Commission" value="${menu.prices[30]?.commission || ''}" class="flex-1 border rounded px-2 py-1" placeholder="커미션">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">60분 가격/커미션:</label>
                            <div class="flex gap-2">
                                <input type="number" id="editMenu60Price" value="${menu.prices[60]?.price || ''}" class="flex-1 border rounded px-2 py-1" placeholder="가격">
                                <input type="number" id="editMenu60Commission" value="${menu.prices[60]?.commission || ''}" class="flex-1 border rounded px-2 py-1" placeholder="커미션">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">90분 가격/커미션:</label>
                            <div class="flex gap-2">
                                <input type="number" id="editMenu90Price" value="${menu.prices[90]?.price || ''}" class="flex-1 border rounded px-2 py-1" placeholder="가격">
                                <input type="number" id="editMenu90Commission" value="${menu.prices[90]?.commission || ''}" class="flex-1 border rounded px-2 py-1" placeholder="커미션">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">120분 가격/커미션:</label>
                            <div class="flex gap-2">
                                <input type="number" id="editMenu120Price" value="${menu.prices[120]?.price || ''}" class="flex-1 border rounded px-2 py-1" placeholder="가격">
                                <input type="number" id="editMenu120Commission" value="${menu.prices[120]?.commission || ''}" class="flex-1 border rounded px-2 py-1" placeholder="커미션">
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="updateMenu(${id})" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">수정</button>
                        <button onclick="manageMenus()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '메뉴 수정';
            document.getElementById('managementContent').innerHTML = content;
        }

        function updateMenu(id) {
            const name = document.getElementById('editMenuName').value;
            if (!name) {
                alert('메뉴명을 입력해주세요.');
                return;
            }

            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menuIndex = menus.findIndex(m => m.id === id);
            
            if (menuIndex === -1) return;

            const prices = {};
            const durations = [30, 60, 90, 120];
            
            durations.forEach(duration => {
                const price = parseInt(document.getElementById(`editMenu${duration}Price`).value);
                const commission = parseInt(document.getElementById(`editMenu${duration}Commission`).value);
                
                if (price && commission) {
                    prices[duration] = { price, commission };
                }
            });

            menus[menuIndex] = {
                id: id,
                name: name,
                prices: prices
            };

            localStorage.setItem(getAdminKey('menus'), JSON.stringify(menus));
            alert('메뉴가 수정되었습니다.');
            manageMenus();
        }

        function deleteMenu(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
                const filteredMenus = menus.filter(m => m.id !== id);
                localStorage.setItem(getAdminKey('menus'), JSON.stringify(filteredMenus));
                alert('메뉴가 삭제되었습니다.');
                manageMenus();
            }
        }

        // 직원 관리 함수들
        function addNewStaff() {
            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">직원명:</label>
                        <input type="text" id="newStaffName" class="w-full border rounded px-3 py-2" placeholder="직원명을 입력하세요">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">전화번호:</label>
                        <input type="text" id="newStaffPhone" class="w-full border rounded px-3 py-2" placeholder="전화번호를 입력하세요">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">은행명:</label>
                        <input type="text" id="newStaffBank" class="w-full border rounded px-3 py-2" placeholder="은행명을 입력하세요">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">계좌번호:</label>
                        <input type="text" id="newStaffAccount" class="w-full border rounded px-3 py-2" placeholder="계좌번호를 입력하세요">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">상태:</label>
                        <select id="newStaffStatus" class="w-full border rounded px-3 py-2">
                            <option value="정직원">정직원</option>
                            <option value="단기고용">단기고용</option>
                            <option value="퇴사">퇴사</option>
                        </select>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="saveNewStaff()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">저장</button>
                        <button onclick="manageStaff()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '새 직원 추가';
            document.getElementById('managementContent').innerHTML = content;
        }

        function saveNewStaff() {
            const name = document.getElementById('newStaffName').value;
            const phone = document.getElementById('newStaffPhone').value;
            const bank = document.getElementById('newStaffBank').value;
            const account = document.getElementById('newStaffAccount').value;
            const status = document.getElementById('newStaffStatus').value;

            if (!name) {
                alert('직원명을 입력해주세요.');
                return;
            }

            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const newId = Math.max(...staff.map(s => s.id), 0) + 1;

            staff.push({
                id: newId,
                name: name,
                phone: phone,
                bank: bank,
                account: account,
                status: status
            });

            localStorage.setItem(getAdminKey('staff'), JSON.stringify(staff));
            alert('직원이 추가되었습니다.');
            manageStaff();
        }

        function editStaff(id) {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const member = staff.find(s => s.id === id);
            
            if (!member) return;

            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">직원명:</label>
                        <input type="text" id="editStaffName" value="${member.name}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">전화번호:</label>
                        <input type="text" id="editStaffPhone" value="${member.phone}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">은행명:</label>
                        <input type="text" id="editStaffBank" value="${member.bank}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">계좌번호:</label>
                        <input type="text" id="editStaffAccount" value="${member.account}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">상태:</label>
                        <select id="editStaffStatus" class="w-full border rounded px-3 py-2">
                            <option value="정직원" ${member.status === '정직원' ? 'selected' : ''}>정직원</option>
                            <option value="단기고용" ${member.status === '단기고용' ? 'selected' : ''}>단기고용</option>
                            <option value="퇴사" ${member.status === '퇴사' ? 'selected' : ''}>퇴사</option>
                        </select>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="updateStaff(${id})" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">수정</button>
                        <button onclick="manageStaff()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '직원 수정';
            document.getElementById('managementContent').innerHTML = content;
        }

        function updateStaff(id) {
            const name = document.getElementById('editStaffName').value;
            if (!name) {
                alert('직원명을 입력해주세요.');
                return;
            }

            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const staffIndex = staff.findIndex(s => s.id === id);
            
            if (staffIndex === -1) return;

            staff[staffIndex] = {
                id: id,
                name: name,
                phone: document.getElementById('editStaffPhone').value,
                bank: document.getElementById('editStaffBank').value,
                account: document.getElementById('editStaffAccount').value,
                status: document.getElementById('editStaffStatus').value
            };

            localStorage.setItem(getAdminKey('staff'), JSON.stringify(staff));
            alert('직원 정보가 수정되었습니다.');
            manageStaff();
        }

        function deleteStaff(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
                const filteredStaff = staff.filter(s => s.id !== id);
                localStorage.setItem(getAdminKey('staff'), JSON.stringify(filteredStaff));
                alert('직원이 삭제되었습니다.');
                manageStaff();
            }
        }

        // 방 관리 함수들
        function addNewRoom() {
            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">방번호:</label>
                        <input type="text" id="newRoomNumber" class="w-full border rounded px-3 py-2" placeholder="방번호를 입력하세요">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">수용인원:</label>
                        <input type="number" id="newRoomCapacity" class="w-full border rounded px-3 py-2" placeholder="수용인원을 입력하세요" min="1">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="saveNewRoom()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">저장</button>
                        <button onclick="manageRooms()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '새 방 추가';
            document.getElementById('managementContent').innerHTML = content;
        }

        function saveNewRoom() {
            const roomNumber = document.getElementById('newRoomNumber').value;
            const capacity = parseInt(document.getElementById('newRoomCapacity').value);

            if (!roomNumber) {
                alert('방번호를 입력해주세요.');
                return;
            }

            if (!capacity || capacity < 1) {
                alert('올바른 수용인원을 입력해주세요.');
                return;
            }

            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const newId = Math.max(...rooms.map(r => r.id), 0) + 1;

            rooms.push({
                id: newId,
                roomNumber: roomNumber,
                capacity: capacity
            });

            localStorage.setItem(getAdminKey('rooms'), JSON.stringify(rooms));
            alert('방이 추가되었습니다.');
            manageRooms();
        }

        function editRoom(id) {
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const room = rooms.find(r => r.id === id);
            
            if (!room) return;

            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">방번호:</label>
                        <input type="text" id="editRoomNumber" value="${room.roomNumber}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">수용인원:</label>
                        <input type="number" id="editRoomCapacity" value="${room.capacity}" class="w-full border rounded px-3 py-2" min="1">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="updateRoom(${id})" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">수정</button>
                        <button onclick="manageRooms()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '방 수정';
            document.getElementById('managementContent').innerHTML = content;
        }

        function updateRoom(id) {
            const roomNumber = document.getElementById('editRoomNumber').value;
            const capacity = parseInt(document.getElementById('editRoomCapacity').value);

            if (!roomNumber) {
                alert('방번호를 입력해주세요.');
                return;
            }

            if (!capacity || capacity < 1) {
                alert('올바른 수용인원을 입력해주세요.');
                return;
            }

            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const roomIndex = rooms.findIndex(r => r.id === id);
            
            if (roomIndex === -1) return;

            rooms[roomIndex] = {
                id: id,
                roomNumber: roomNumber,
                capacity: capacity
            };

            localStorage.setItem(getAdminKey('rooms'), JSON.stringify(rooms));
            alert('방 정보가 수정되었습니다.');
            manageRooms();
        }

        function deleteRoom(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
                const filteredRooms = rooms.filter(r => r.id !== id);
                localStorage.setItem(getAdminKey('rooms'), JSON.stringify(filteredRooms));
                alert('방이 삭제되었습니다.');
                manageRooms();
            }
        }

        // 고객 관리 함수들
        function addNewCustomer() {
            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">고객명:</label>
                        <input type="text" id="newCustomerName" class="w-full border rounded px-3 py-2" placeholder="고객명을 입력하세요">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">전화번호:</label>
                        <input type="text" id="newCustomerPhone" class="w-full border rounded px-3 py-2" placeholder="전화번호를 입력하세요">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">고객번호:</label>
                        <input type="text" id="newCustomerNumber" class="w-full border rounded px-3 py-2" placeholder="고객번호를 입력하세요">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="saveNewCustomer()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">저장</button>
                        <button onclick="manageCustomers()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '새 고객 추가';
            document.getElementById('managementContent').innerHTML = content;
        }

        function saveNewCustomer() {
            const name = document.getElementById('newCustomerName').value;
            const phone = document.getElementById('newCustomerPhone').value;
            const customerNumber = document.getElementById('newCustomerNumber').value;

            if (!name) {
                alert('고객명을 입력해주세요.');
                return;
            }

            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            const newId = Math.max(...customers.map(c => c.id), 0) + 1;

            customers.push({
                id: newId,
                name: name,
                phone: phone,
                customerNumber: customerNumber
            });

            localStorage.setItem(getAdminKey('customers'), JSON.stringify(customers));
            alert('고객이 추가되었습니다.');
            manageCustomers();
        }

        function editCustomer(id) {
            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            const customer = customers.find(c => c.id === id);
            
            if (!customer) return;

            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">고객명:</label>
                        <input type="text" id="editCustomerName" value="${customer.name}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">전화번호:</label>
                        <input type="text" id="editCustomerPhone" value="${customer.phone}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">고객번호:</label>
                        <input type="text" id="editCustomerNumber" value="${customer.customerNumber}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="updateCustomer(${id})" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">수정</button>
                        <button onclick="manageCustomers()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '고객 수정';
            document.getElementById('managementContent').innerHTML = content;
        }

        function updateCustomer(id) {
            const name = document.getElementById('editCustomerName').value;
            if (!name) {
                alert('고객명을 입력해주세요.');
                return;
            }

            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            const customerIndex = customers.findIndex(c => c.id === id);
            
            if (customerIndex === -1) return;

            customers[customerIndex] = {
                id: id,
                name: name,
                phone: document.getElementById('editCustomerPhone').value,
                customerNumber: document.getElementById('editCustomerNumber').value
            };

            localStorage.setItem(getAdminKey('customers'), JSON.stringify(customers));
            alert('고객 정보가 수정되었습니다.');
            manageCustomers();
        }

        function deleteCustomer(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
                const filteredCustomers = customers.filter(c => c.id !== id);
                localStorage.setItem(getAdminKey('customers'), JSON.stringify(filteredCustomers));
                alert('고객이 삭제되었습니다.');
                manageCustomers();
            }
        }

        // 화폐 단위 저장
        function saveCurrency() {
            const symbol = document.getElementById('currencySymbol').value;
            const name = document.getElementById('currencyName').value;

            if (!name) {
                alert('화폐 이름을 입력해주세요.');
                return;
            }

            const currency = { symbol, name };
            localStorage.setItem(getAdminKey('currency'), JSON.stringify(currency));
            
            alert('화폐 단위가 저장되었습니다.');
            updateCurrencyDisplay();
            closeManagementModal();
        }

        // 입금방식 관리 함수들
        function addNewPaymentMethod() {
            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">입금방식명:</label>
                        <input type="text" id="newPaymentMethodName" class="w-full border rounded px-3 py-2" placeholder="입금방식명을 입력하세요">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="saveNewPaymentMethod()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">저장</button>
                        <button onclick="managePaymentMethods()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '새 입금방식 추가';
            document.getElementById('managementContent').innerHTML = content;
        }

        function saveNewPaymentMethod() {
            const name = document.getElementById('newPaymentMethodName').value;

            if (!name) {
                alert('입금방식명을 입력해주세요.');
                return;
            }

            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            const newId = Math.max(...paymentMethods.map(p => p.id), 0) + 1;

            paymentMethods.push({
                id: newId,
                name: name
            });

            localStorage.setItem(getAdminKey('paymentMethods'), JSON.stringify(paymentMethods));
            alert('입금방식이 추가되었습니다.');
            managePaymentMethods();
        }

        function editPaymentMethod(id) {
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            const method = paymentMethods.find(p => p.id === id);
            
            if (!method) return;

            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">입금방식명:</label>
                        <input type="text" id="editPaymentMethodName" value="${method.name}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="updatePaymentMethod(${id})" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">수정</button>
                        <button onclick="managePaymentMethods()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '입금방식 수정';
            document.getElementById('managementContent').innerHTML = content;
        }

        function updatePaymentMethod(id) {
            const name = document.getElementById('editPaymentMethodName').value;
            if (!name) {
                alert('입금방식명을 입력해주세요.');
                return;
            }

            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            const methodIndex = paymentMethods.findIndex(p => p.id === id);
            
            if (methodIndex === -1) return;

            paymentMethods[methodIndex] = {
                id: id,
                name: name
            };

            localStorage.setItem(getAdminKey('paymentMethods'), JSON.stringify(paymentMethods));
            alert('입금방식이 수정되었습니다.');
            managePaymentMethods();
        }

        function deletePaymentMethod(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
                const filteredMethods = paymentMethods.filter(p => p.id !== id);
                localStorage.setItem(getAdminKey('paymentMethods'), JSON.stringify(filteredMethods));
                alert('입금방식이 삭제되었습니다.');
                managePaymentMethods();
            }
        }

        // Guarantee 관리 함수들
        function addNewGuarantee() {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const activeStaff = staff.filter(s => s.status !== '퇴사');
            
            let staffOptions = '';
            activeStaff.forEach(s => {
                staffOptions += `<option value="${s.name}">${s.name}</option>`;
            });

            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">날짜:</label>
                        <input type="date" id="newGuaranteeDate" value="${new Date().toISOString().split('T')[0]}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">직원명:</label>
                        <select id="newGuaranteeStaff" class="w-full border rounded px-3 py-2">
                            <option value="">직원을 선택하세요</option>
                            ${staffOptions}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">금액:</label>
                        <input type="number" id="newGuaranteeAmount" class="w-full border rounded px-3 py-2" placeholder="금액을 입력하세요">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">메모:</label>
                        <textarea id="newGuaranteeMemo" class="w-full border rounded px-3 py-2" rows="3" placeholder="메모를 입력하세요 (선택사항)"></textarea>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="saveNewGuarantee()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">저장</button>
                        <button onclick="manageGuarantee()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '새 Guarantee 추가';
            document.getElementById('managementContent').innerHTML = content;
        }

        function saveNewGuarantee() {
            const date = document.getElementById('newGuaranteeDate').value;
            const staffName = document.getElementById('newGuaranteeStaff').value;
            const amount = parseInt(document.getElementById('newGuaranteeAmount').value);
            const memo = document.getElementById('newGuaranteeMemo').value;

            if (!date || !staffName || !amount) {
                alert('날짜, 직원명, 금액을 모두 입력해주세요.');
                return;
            }

            const guarantees = JSON.parse(localStorage.getItem(getAdminKey('guarantees')) || '[]');
            const newId = Math.max(...guarantees.map(g => g.id), 0) + 1;

            guarantees.push({
                id: newId,
                date: date,
                staffName: staffName,
                amount: amount,
                memo: memo
            });

            localStorage.setItem(getAdminKey('guarantees'), JSON.stringify(guarantees));
            alert('Guarantee가 추가되었습니다.');
            manageGuarantee();
        }

        function editGuarantee(id) {
            const guarantees = JSON.parse(localStorage.getItem(getAdminKey('guarantees')) || '[]');
            const guarantee = guarantees.find(g => g.id === id);
            
            if (!guarantee) return;

            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const activeStaff = staff.filter(s => s.status !== '퇴사');
            
            let staffOptions = '';
            activeStaff.forEach(s => {
                const selected = s.name === guarantee.staffName ? 'selected' : '';
                staffOptions += `<option value="${s.name}" ${selected}>${s.name}</option>`;
            });

            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">날짜:</label>
                        <input type="date" id="editGuaranteeDate" value="${guarantee.date}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">직원명:</label>
                        <select id="editGuaranteeStaff" class="w-full border rounded px-3 py-2">
                            ${staffOptions}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">금액:</label>
                        <input type="number" id="editGuaranteeAmount" value="${guarantee.amount}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">메모:</label>
                        <textarea id="editGuaranteeMemo" class="w-full border rounded px-3 py-2" rows="3">${guarantee.memo || ''}</textarea>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="updateGuarantee(${id})" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">수정</button>
                        <button onclick="manageGuarantee()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = 'Guarantee 수정';
            document.getElementById('managementContent').innerHTML = content;
        }

        function updateGuarantee(id) {
            const date = document.getElementById('editGuaranteeDate').value;
            const staffName = document.getElementById('editGuaranteeStaff').value;
            const amount = parseInt(document.getElementById('editGuaranteeAmount').value);
            const memo = document.getElementById('editGuaranteeMemo').value;

            if (!date || !staffName || !amount) {
                alert('날짜, 직원명, 금액을 모두 입력해주세요.');
                return;
            }

            const guarantees = JSON.parse(localStorage.getItem(getAdminKey('guarantees')) || '[]');
            const guaranteeIndex = guarantees.findIndex(g => g.id === id);
            
            if (guaranteeIndex === -1) return;

            guarantees[guaranteeIndex] = {
                id: id,
                date: date,
                staffName: staffName,
                amount: amount,
                memo: memo
            };

            localStorage.setItem(getAdminKey('guarantees'), JSON.stringify(guarantees));
            alert('Guarantee가 수정되었습니다.');
            manageGuarantee();
        }

        function deleteGuarantee(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const guarantees = JSON.parse(localStorage.getItem(getAdminKey('guarantees')) || '[]');
                const filteredGuarantees = guarantees.filter(g => g.id !== id);
                localStorage.setItem(getAdminKey('guarantees'), JSON.stringify(filteredGuarantees));
                alert('Guarantee가 삭제되었습니다.');
                manageGuarantee();
            }
        }

        // 관리자 관리 함수들 (최고 관리자 전용)
        function addNewAdmin() {
            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">아이디:</label>
                        <input type="text" id="newAdminUsername" class="w-full border rounded px-3 py-2" placeholder="아이디를 입력하세요">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">비밀번호:</label>
                        <input type="password" id="newAdminPassword" class="w-full border rounded px-3 py-2" placeholder="비밀번호를 입력하세요">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">타입:</label>
                        <select id="newAdminType" class="w-full border rounded px-3 py-2">
                            <option value="normal">일반관리자</option>
                            <option value="super">최고관리자</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">상점명:</label>
                        <input type="text" id="newAdminShopName" class="w-full border rounded px-3 py-2" placeholder="상점명을 입력하세요">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">전화번호:</label>
                        <input type="text" id="newAdminPhone" class="w-full border rounded px-3 py-2" placeholder="전화번호를 입력하세요">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="saveNewAdmin()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">저장</button>
                        <button onclick="manageAdmins()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '새 관리자 추가';
            document.getElementById('managementContent').innerHTML = content;
        }

        function saveNewAdmin() {
            const username = document.getElementById('newAdminUsername').value;
            const password = document.getElementById('newAdminPassword').value;
            const type = document.getElementById('newAdminType').value;
            const shopName = document.getElementById('newAdminShopName').value;
            const phone = document.getElementById('newAdminPhone').value;

            if (!username || !password) {
                alert('아이디와 비밀번호를 입력해주세요.');
                return;
            }

            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            
            // 중복 아이디 체크
            if (admins.some(a => a.username === username)) {
                alert('이미 존재하는 아이디입니다.');
                return;
            }

            const newId = Math.max(...admins.map(a => a.id), 0) + 1;

            admins.push({
                id: newId,
                username: username,
                password: password,
                type: type,
                shopName: shopName,
                phone: phone
            });

            localStorage.setItem('globalAdmins', JSON.stringify(admins));
            alert('관리자가 추가되었습니다.');
            manageAdmins();
        }

        function editAdmin(id) {
            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            const admin = admins.find(a => a.id === id);
            
            if (!admin) return;

            const content = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">아이디:</label>
                        <input type="text" id="editAdminUsername" value="${admin.username}" class="w-full border rounded px-3 py-2" ${id === 1 ? 'readonly' : ''}>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">비밀번호:</label>
                        <input type="password" id="editAdminPassword" value="${admin.password}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">타입:</label>
                        <select id="editAdminType" class="w-full border rounded px-3 py-2" ${id === 1 ? 'disabled' : ''}>
                            <option value="normal" ${admin.type === 'normal' ? 'selected' : ''}>일반관리자</option>
                            <option value="super" ${admin.type === 'super' ? 'selected' : ''}>최고관리자</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">상점명:</label>
                        <input type="text" id="editAdminShopName" value="${admin.shopName || ''}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">전화번호:</label>
                        <input type="text" id="editAdminPhone" value="${admin.phone || ''}" class="w-full border rounded px-3 py-2">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="updateAdmin(${id})" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">수정</button>
                        <button onclick="manageAdmins()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
                    </div>
                </div>
            `;
            
            document.getElementById('managementTitle').textContent = '관리자 수정';
            document.getElementById('managementContent').innerHTML = content;
        }

        function updateAdmin(id) {
            const username = document.getElementById('editAdminUsername').value;
            const password = document.getElementById('editAdminPassword').value;
            const type = document.getElementById('editAdminType').value;
            const shopName = document.getElementById('editAdminShopName').value;
            const phone = document.getElementById('editAdminPhone').value;

            if (!username || !password) {
                alert('아이디와 비밀번호를 입력해주세요.');
                return;
            }

            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            const adminIndex = admins.findIndex(a => a.id === id);
            
            if (adminIndex === -1) return;

            admins[adminIndex] = {
                id: id,
                username: username,
                password: password,
                type: type,
                shopName: shopName,
                phone: phone
            };

            localStorage.setItem('globalAdmins', JSON.stringify(admins));
            alert('관리자 정보가 수정되었습니다.');
            manageAdmins();
        }

        function deleteAdmin(id) {
            if (id === 1) {
                alert('기본 관리자는 삭제할 수 없습니다.');
                return;
            }

            if (confirm('정말 삭제하시겠습니까?')) {
                const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
                const filteredAdmins = admins.filter(a => a.id !== id);
                localStorage.setItem('globalAdmins', JSON.stringify(filteredAdmins));
                alert('관리자가 삭제되었습니다.');
                manageAdmins();
            }
        }

        // 앱 초기화
        initializeApp();
        updateTranslations();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'998a9a3405da4ba6',t:'MTc2MjE1OTU5OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
