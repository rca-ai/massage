<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>마사지샵 관리 시스템</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.35.0/dist/supabase.min.js"></script>
  <style>
    /* 모달 공통 */
    .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); align-items:center; justify-content:center; z-index:50; }
    .modal .modal-content { background:#fff; padding:20px; border-radius:8px; width:90%; max-width:720px; max-height:90vh; overflow:auto; }
    .required-label::after { content:" *"; color:#dc2626; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Helvetica Neue", Arial; }
    .selection-grid { display:flex; flex-wrap:wrap; gap:8px; }
    .selected-staff-info { border:1px solid #e5e7eb; padding:8px; border-radius:6px; }
    /* 간단 반응형 수직 여백 */
    .container { max-width:1200px; margin-left:auto; margin-right:auto; }
  </style>
</head>
<body class="bg-gray-50">
  <!-- 로그인 화면 -->
  <div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600">
   <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md">
    <div class="text-center mb-8">
     <h1 class="text-3xl font-bold text-gray-800 mb-2" data-translate="title">마사지샵 관리 시스템</h1>
     <div class="w-20 h-1 bg-blue-500 mx-auto"></div>
    </div>
    <div class="mb-6">
     <label class="block text-sm font-medium text-gray-700 mb-2">언어 선택 / Language / ภาษา / Ngôn ngữ</label>
     <div class="grid grid-cols-4 gap-2">
      <button onclick="setLanguage('ko')" class="bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600" id="langKo">한국어</button>
      <button onclick="setLanguage('en')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langEn">English</button>
      <button onclick="setLanguage('th')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langTh">ไทย</button>
      <button onclick="setLanguage('vi')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langVi">Tiếng Việt</button>
     </div>
    </div>
    <div class="space-y-4">
     <div>
      <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="username">아이디</label>
      <input type="text" id="loginUsername" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="you@example.com">
     </div>
     <div>
      <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="password">비밀번호</label>
      <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="비밀번호">
     </div>
     <button id="btnLogin" class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition duration-200" data-translate="login">로그인</button>

     <div class="text-center text-sm text-gray-600 mt-2">
      <button id="btnShowGoogleModal" class="text-blue-600 underline">구글 로그인</button>
     </div>
    </div>
   </div>
  </div>

  <!-- 메인 화면 -->
  <div id="mainScreen" class="container mx-auto p-6" style="display: none;">
   <!-- 헤더 -->
   <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
     <div>
      <h1 class="text-3xl font-bold text-gray-800" data-translate="title">마사지 관리 프로그램</h1>
      <p id="shopName" class="text-lg text-gray-600 mt-1">My Massage Shop</p>
     </div>
     <div class="flex gap-2">
      <button onclick="showLanguageModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="changeLanguage">언어 변경</button>
      <button onclick="showFontModal()" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600" data-translate="changeFont">폰트 변경</button>
      <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600" data-translate="logout">로그아웃</button>
     </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
     <div class="text-center">
      <label class="block text-sm font-medium mb-2" data-translate="todayDate">오늘 날짜</label>
      <div class="flex gap-2">
       <input type="date" id="currentDate" class="border rounded px-3 py-2 flex-1">
       <button onclick="confirmDateChange()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="confirmDate">확인</button>
      </div>
     </div>
     <div class="text-center">
      <label class="block text-sm font-medium mb-2" data-translate="currentTime">현재 시간</label>
      <div id="currentTime" class="text-xl font-bold text-blue-600"></div>
     </div>
    </div>
   </div>

   <!-- 메뉴 버튼 -->
   <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
    <button onclick="showDashboard()" class="bg-blue-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-blue-600" data-translate="dashboard">현황판</button>
    <button onclick="showOrder()" class="bg-indigo-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-indigo-600" data-translate="order">순번</button>
    <button onclick="showReservation()" class="bg-green-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-green-600" data-translate="reservation">예약</button>
    <button onclick="showStatistics()" class="bg-purple-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-purple-600" data-translate="statistics">통계</button>
    <button onclick="showDBManagement()" class="bg-orange-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-orange-600" data-translate="dbManagement">DB 관리</button>
   </div>

   <!-- 순번 섹션 -->
   <div id="orderSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="orderManagement">순번 관리</h2>
    <div class="mb-4">
     <button onclick="saveStaffOrder()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="saveOrder">순번 저장</button>
    </div>
    <div class="overflow-x-auto">
     <table class="w-full border-collapse border border-gray-300">
      <thead>
       <tr class="bg-gray-100">
        <th class="border border-gray-300 p-2" data-translate="staffName">직원명</th>
        <th class="border border-gray-300 p-2" data-translate="status">상태</th>
        <th class="border border-gray-300 p-2" data-translate="orderNumber">순번</th>
       </tr>
      </thead>
      <tbody id="orderTable"></tbody>
     </table>
    </div>
    <div class="mt-4 text-sm text-gray-600" data-translate="orderZeroVacationNote">* 순번 0은 휴가로 처리됩니다.</div>
   </div>

   <!-- 현황판 -->
   <div id="dashboardSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="dashboard">현황판</h2>
    <div class="overflow-x-auto">
     <table class="w-full border-collapse border border-gray-300">
      <thead>
       <tr class="bg-gray-100">
        <th class="border border-gray-300 p-2" data-translate="staff">직원명</th>
        <th class="border border-gray-300 p-2" data-translate="menu">메뉴</th>
        <th class="border border-gray-300 p-2" data-translate="duration">시간</th>
        <th class="border border-gray-300 p-2" data-translate="startTime">시작시간</th>
        <th class="border border-gray-300 p-2" data-translate="endTime">끝시간</th>
        <th class="border border-gray-300 p-2" data-translate="remainingTime">남은시간</th>
        <th class="border border-gray-300 p-2" data-translate="price">가격</th>
        <th class="border border-gray-300 p-2" data-translate="commission">커미션</th>
        <th class="border border-gray-300 p-2" data-translate="roomNumber">방번호</th>
        <th class="border border-gray-300 p-2" data-translate="actions">작업</th>
       </tr>
      </thead>
      <tbody id="dashboardTable"></tbody>
     </table>
    </div>
   </div>

   <!-- 예약 -->
   <div id="reservationSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="reservation">예약</h2>
    <div class="mb-6">
     <label class="block text-sm font-medium mb-2 required-label" data-translate="selectStaff">직원 선택</label>
     <div id="staffSelectionContainer">
      <div id="staffSelection" class="selection-grid"></div>
      <div id="selectedStaffInfo" class="selected-staff-info" style="display: none;">
       <div class="flex justify-between items-center">
        <div>
         <h4 class="font-bold text-lg">선택된 직원: <span id="selectedStaffName"></span></h4>
         <p class="text-sm text-gray-600">순번: <span id="selectedStaffOrder"></span></p>
        </div>
        <button onclick="changeStaff()" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">직원 변경</button>
       </div>
      </div>
     </div>
    </div>

    <div id="menuListContainer" style="display: none;">
     <div class="flex justify-between items-center mb-4">
      <label class="block text-sm font-medium required-label">메뉴 목록</label>
      <button onclick="addMenuRow()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 flex items-center gap-2"><span class="text-lg">+</span> 메뉴 추가</button>
     </div>
     <div id="menuRows"></div>
     <div class="mt-6 p-4 bg-gray-100 rounded">
      <div class="grid grid-cols-2 gap-4">
       <div><strong data-translate="totalPrice">총 가격:</strong> <span id="totalPrice">0</span><span id="totalPriceCurrency"></span></div>
       <div><strong data-translate="totalCommission">총 커미션:</strong> <span id="totalCommission">0</span><span id="totalCommissionCurrency"></span></div>
      </div>
     </div>

     <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
      <div>
       <label class="block text-sm font-medium mb-2" data-translate="startTime">시작 시간 (선택사항)</label>
       <input type="time" id="reservationStartTime" class="w-full border rounded px-3 py-2" onchange="updateAllMenuTimes()">
      </div>
      <div>
       <label class="block text-sm font-medium mb-2" data-translate="roomNumber">방번호 (선택사항)</label>
       <select id="reservationRoom" class="w-full border rounded px-3 py-2">
        <option value="" data-translate="selectRoom">방 선택</option>
       </select>
      </div>
      <div>
       <label class="block text-sm font-medium mb-2" data-translate="customerName">고객명 (선택사항)</label>
       <input type="text" id="reservationCustomer" class="w-full border rounded px-3 py-2" placeholder="홍길동">
      </div>
     </div>

     <div id="menuTimeSettings" class="mt-6" style="display: none;">
      <h4 class="font-bold mb-3">메뉴별 시간 설정</h4>
      <div id="menuTimeList" class="space-y-3"></div>
     </div>

     <button onclick="addReservation()" class="mt-6 bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600" data-translate="addReservation">예약 추가</button>
    </div>
   </div>

   <!-- 통계 -->
   <div id="statisticsSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="statistics">통계</h2>
    <div class="mb-4 flex gap-4 flex-wrap">
     <button onclick="showDailyStats()" id="dailyStatsBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="daily">일간</button>
     <button onclick="showWeeklyStats()" id="weeklyStatsBtn" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" data-translate="weekly">주간</button>
     <button onclick="showMonthlyStats()" id="monthlyStatsBtn" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" data-translate="monthly">월간</button>
     <button onclick="showMenuSales()" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600" data-translate="monthlyMenuSales">월간 메뉴 매출</button>
     <button onclick="showMonthlySalesChart()" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600" data-translate="monthlySalesChart">월간 매출 그래프</button>
     <button onclick="downloadExcel()" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700" data-translate="download">다운로드</button>
    </div>

    <div class="mb-6 p-4 bg-gray-50 rounded">
     <div id="dailyDateSelection" class="mb-4">
      <label class="block text-sm font-medium mb-2" data-translate="selectDate">날짜 선택</label>
      <input type="date" id="statsDate" class="border rounded px-3 py-2" onchange="updateStats()">
     </div>
     <div id="rangeDateSelection" class="grid grid-cols-1 md:grid-cols-2 gap-4" style="display: none;">
      <div><label class="block text-sm font-medium mb-2" data-translate="startDate">시작 날짜</label><input type="date" id="statsStartDate" class="w-full border rounded px-3 py-2" onchange="autoSetEndDate()"></div>
      <div><label class="block text-sm font-medium mb-2" data-translate="endDate">끝 날짜</label><input type="date" id="statsEndDate" class="w-full border rounded px-3 py-2" onchange="updateStats()"></div>
     </div>
     <div id="quickDateSelection" class="mt-3 flex gap-2 flex-wrap" style="display: none;">
      <button onclick="setThisWeek()" class="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm hover:bg-blue-200" data-translate="thisWeek">이번 주</button>
      <button onclick="setLastWeek()" class="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm hover:bg-blue-200" data-translate="lastWeek">지난 주</button>
      <button onclick="setThisMonth()" class="bg-green-100 text-green-700 px-3 py-1 rounded text-sm hover:bg-green-200" data-translate="thisMonth">이번 달</button>
      <button onclick="setLastMonth()" class="bg-green-100 text-green-700 px-3 py-1 rounded text-sm hover:bg-green-200" data-translate="lastMonth">지난 달</button>
     </div>
    </div>

    <div id="chartContainer" class="mb-6" style="display: none;">
     <canvas id="statsChart" width="800" height="400"></canvas>
    </div>

    <div class="mb-6">
     <h3 class="text-lg font-bold mb-2" data-translate="staffStatisticsTitle">직원별 통계</h3>
     <div class="overflow-x-auto">
      <table class="w-full border-collapse border border-gray-300">
       <thead>
        <tr class="bg-gray-100">
         <th class="border border-gray-300 p-2" data-translate="staff">마사지사</th>
         <th class="border border-gray-300 p-2" data-translate="totalPrice">총 가격</th>
         <th class="border border-gray-300 p-2" data-translate="totalCommission">총 커미션</th>
        </tr>
       </thead>
       <tbody id="statsTable"></tbody>
      </table>
     </div>
    </div>

    <div class="mb-6">
     <h3 class="text-lg font-bold mb-2" data-translate="paymentMethodStatisticsTitle">입금방식별 통계</h3>
     <div class="overflow-x-auto">
      <table class="w-full border-collapse border border-gray-300">
       <thead>
        <tr class="bg-gray-100">
         <th class="border border-gray-300 p-2" data-translate="paymentMethodColumn">입금방식</th>
         <th class="border border-gray-300 p-2" data-translate="amountColumn">금액</th>
        </tr>
       </thead>
       <tbody id="paymentStatsTable"></tbody>
      </table>
     </div>
    </div>

    <div class="p-4 bg-gray-100 rounded">
     <div class="grid grid-cols-3 gap-4">
      <div><strong data-translate="grandTotal">총 금액(QR팁 제외):</strong> <span id="grandTotalPrice">0</span><span id="grandTotalCurrency"></span></div>
      <div><strong data-translate="grandTotalCommission">총 커미션:</strong> <span id="grandTotalCommission">0</span><span id="grandTotalCommissionCurrency"></span></div>
      <div><strong data-translate="profit">수익:</strong> <span id="totalProfit">0</span><span id="totalProfitCurrency"></span></div>
     </div>
    </div>
   </div>

   <!-- DB 관리 -->
   <div id="dbManagementSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
    <h2 class="text-2xl font-bold mb-4" data-translate="dbManagement">DB 관리</h2>
    <div class="mb-6 p-4 bg-gray-100 rounded">
     <h3 class="text-lg font-bold mb-2" data-translate="dataBackupRestoreTitle">데이터 백업 및 복원</h3>
     <div class="grid grid-cols-2 gap-4">
      <div>
       <h4 class="font-semibold mb-2" data-translate="backupButton">백업</h4>
       <div class="flex gap-2 flex-wrap">
        <button onclick="showLocalBackupDialog()" class="bg-green-600 text-white px-3 py-2 rounded hover:bg-green-700 text-sm" data-translate="localBackupButton">로컬 백업</button>
        <button onclick="showGoogleBackupDialog()" class="bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 text-sm" data-translate="googleBackupButton">구글 백업</button>
       </div>
      </div>
      <div>
       <h4 class="font-semibold mb-2" data-translate="restoreButton">복원</h4>
       <div class="flex gap-2 flex-wrap">
        <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreData(event)">
        <button onclick="showLocalRestoreDialog()" class="bg-orange-600 text-white px-3 py-2 rounded hover:bg-orange-700 text-sm" data-translate="localRestoreButton">로컬 복원</button>
        <button onclick="showGoogleRestoreDialog()" class="bg-indigo-600 text-white px-3 py-2 rounded hover:bg-indigo-700 text-sm" data-translate="googleRestoreButton">구글 복원</button>
       </div>
      </div>
     </div>
     <div class="mt-4"><button onclick="exportAllDataExcel()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700" data-translate="exportAllDataButton">전체 데이터 엑셀 내보내기</button></div>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
     <button onclick="manageMenus()" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600" data-translate="menuManagement">메뉴 관리</button>
     <button onclick="manageStaff()" class="bg-green-500 text-white py-3 px-4 rounded hover:bg-green-600" data-translate="staffManagement">직원 관리</button>
     <button onclick="manageRooms()" class="bg-purple-500 text-white py-3 px-4 rounded hover:bg-purple-600" data-translate="roomManagement">방 관리</button>
     <button onclick="manageCustomers()" class="bg-orange-500 text-white py-3 px-4 rounded hover:bg-orange-600" data-translate="customerManagement">고객 관리</button>
     <button onclick="manageCurrency()" class="bg-pink-500 text-white py-3 px-4 rounded hover:bg-pink-600" data-translate="currencyManagement">화폐 단위</button>
     <button onclick="managePaymentMethods()" class="bg-yellow-500 text-white py-3 px-4 rounded hover:bg-yellow-600" data-translate="paymentMethodManagement">입금방식 관리</button>
     <button onclick="manageGuarantee()" class="bg-teal-500 text-white py-3 px-4 rounded hover:bg-teal-600">Guarantee 관리</button>
     <div id="superAdminButtons" style="display: none;"><button onclick="manageAdmins()" class="bg-red-500 text-white py-3 px-4 rounded hover:bg-red-600" data-translate="adminManagement">관리자 관리</button></div>
    </div>
   </div>
  </div>

  <!-- Payment Modal -->
  <div id="paymentModal" class="modal"><div class="modal-content">
    <h3 class="text-xl font-bold mb-4" data-translate="payment">입금 처리</h3>
    <div id="paymentMethods" class="space-y-4 mb-4"></div>
    <div class="mb-4"><strong data-translate="totalAmount">총 금액:</strong> <span id="paymentTotalAmount">0</span><span id="paymentCurrency"></span></div>
    <div class="mb-4"><strong data-translate="enteredAmount">입력된 금액:</strong> <span id="paymentEnteredAmount">0</span><span id="paymentEnteredCurrency"></span></div>
    <div class="flex gap-2"><button onclick="processPayment()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-translate="confirm">확인</button> <button onclick="closePaymentModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="cancel">취소</button></div>
  </div></div>

  <!-- Management Modal -->
  <div id="managementModal" class="modal"><div class="modal-content">
    <h3 id="managementTitle" class="text-xl font-bold mb-4"></h3>
    <div id="managementContent"></div>
    <button onclick="closeManagementModal()" class="mt-4 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="close">닫기</button>
  </div></div>

  <!-- Language Modal -->
  <div id="languageModal" class="modal"><div class="modal-content">
    <h3 class="text-xl font-bold mb-4">언어 선택 / Language / ภาษา / Ngôn ngữ</h3>
    <div class="grid grid-cols-2 gap-4">
      <button onclick="setLanguageAndClose('ko')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">한국어</button>
      <button onclick="setLanguageAndClose('en')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">English</button>
      <button onclick="setLanguageAndClose('th')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">ไทย</button>
      <button onclick="setLanguageAndClose('vi')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">Tiếng Việt</button>
    </div>
    <button onclick="closeLanguageModal()" class="mt-4 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">닫기</button>
  </div></div>

  <!-- Font Modal -->
  <div id="fontModal" class="modal"><div class="modal-content">
    <h3 class="text-xl font-bold mb-4" data-translate="fontSelection">폰트 선택</h3>
    <div class="mb-6 p-4 bg-gray-50 rounded">
     <h4 class="font-bold mb-3" data-translate="fontSize">폰트 크기</h4>
     <div class="grid grid-cols-5 gap-2">
      <button onclick="setFontSize('small')" id="fontSizeSmall" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeSmall">작게</button>
      <button onclick="setFontSize('normal')" id="fontSizeNormal" class="bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600" data-translate="fontSizeNormal">보통</button>
      <button onclick="setFontSize('large')" id="fontSizeLarge" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeLarge">크게</button>
      <button onclick="setFontSize('xlarge')" id="fontSizeXLarge" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeXLarge">매우 크게</button>
      <button onclick="setFontSize('xxlarge')" id="fontSizeXXLarge" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" data-translate="fontSizeXXLarge">최대</button>
     </div>
     <div class="mt-2 text-sm text-gray-600"><span id="fontSizePreview">미리보기 텍스트 - Preview Text - ตัวอย่างข้อความ - Văn bản xem trước</span></div>
    </div>
    <div class="mb-4">
     <h4 class="font-bold mb-3" data-translate="fontFamily">폰트 종류</h4>
     <div class="grid grid-cols-1 gap-3">
      <button onclick="setFontFamily('Arial')" id="fontFamilyArial" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600" style="font-family: Arial;">Arial (기본)</button>
      <button onclick="setFontFamily('Noto Sans KR')" id="fontFamilyNotoKR" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Noto Sans KR', sans-serif;">Noto Sans KR (한글 최적화)</button>
      <button onclick="setFontFamily('Malgun Gothic')" id="fontFamilyMalgun" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Malgun Gothic', sans-serif;">맑은 고딕</button>
      <button onclick="setFontFamily('Nanum Gothic')" id="fontFamilyNanum" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Nanum Gothic', sans-serif;">나눔고딕</button>
      <button onclick="setFontFamily('Roboto')" id="fontFamilyRoboto" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Roboto', sans-serif;">Roboto (영문 최적화)</button>
      <button onclick="setFontFamily('Noto Sans Thai')" id="fontFamilyThai" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Noto Sans Thai', sans-serif;">Noto Sans Thai (태국어)</button>
      <button onclick="setFontFamily('Noto Sans Vietnamese')" id="fontFamilyVietnamese" class="bg-gray-300 text-gray-700 py-3 px-4 rounded hover:bg-gray-400" style="font-family: 'Noto Sans Vietnamese', sans-serif;">Noto Sans Vietnamese (베트남어)</button>
     </div>
    </div>
    <div class="flex gap-2">
     <button onclick="applyFontSettings()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-translate="apply">적용</button>
     <button onclick="closeFontModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="close">닫기</button>
    </div>
  </div></div>
  
  <!-- Google Login Modal (UI only) -->
  <div id="googleLoginModal" class="modal">
    <div class="modal-content">
      <h3 class="text-xl font-bold mb-4">구글 계정 로그인</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2">구글 이메일:</label>
          <input type="email" id="googleEmail" class="w-full border rounded px-3 py-2" placeholder="example@gmail.com">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2">구글 비밀번호:</label>
          <input type="password" id="googlePassword" class="w-full border rounded px-3 py-2" placeholder="비밀번호 입력">
        </div>
        <div class="text-sm text-gray-600">
          * 실제 구글 계정 정보를 입력하세요. (UI 전용 — 실제 OAuth 동작을 위해서는 Supabase OAuth 설정 필요)
        </div>
      </div>
      <div class="flex gap-2 mt-4">
        <button id="googleLoginConfirm" onclick="processGoogleLogin()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">로그인</button>
        <button onclick="closeGoogleLoginModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
      </div>
    </div>
  </div>

// 안전한 Supabase 초기화 — 복사해서 기존 블록을 완전히 교체하세요
const SUPABASE_URL = 'https://lmjtjonlvpqcwdzisijd.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtanRqb25sdnBxY3dkemlzaWpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMjY1NDksImV4cCI6MjA3ODcwMjU0OX0.HmfZaxAnaVEEHfLxnlUHxR-PAjrUnFMVWs839xJmKfw';

// Ensure the CDN script has loaded and create the client safely
let supabase = null;
function initSupabaseClient() {
  if (window.supabase && typeof window.supabase.createClient === 'function') {
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    return true;
  } else {
    console.error('Supabase CDN not loaded (window.supabase is undefined).');
    return false;
  }
}

// Try to initialize now; if CDN is delayed, retry after DOMContentLoaded
if (!initSupabaseClient()) {
  window.addEventListener('DOMContentLoaded', () => {
    if (!initSupabaseClient()) {
      // Last resort: notify user in console/UI
      console.error('Supabase client initialization failed. Verify the <script> for @supabase/supabase-js is present and loaded before this script.');
      alert('Supabase 초기화 실패: 콘솔을 확인하세요.');
    }
  });
}
    // DOM elements
    const loginScreen = document.getElementById('loginScreen');
    const mainScreen = document.getElementById('mainScreen');
    const btnLogin = document.getElementById('btnLogin');
    const btnShowGoogleModal = document.getElementById('btnShowGoogleModal');
    const googleLoginModal = document.getElementById('googleLoginModal');
    const loginUsername = document.getElementById('loginUsername');
    const loginPassword = document.getElementById('loginPassword');

    // Modal helpers
    function openModal(id) {
      const el = document.getElementById(id);
      if (el) el.style.display = 'flex';
    }
    function closeModal(id) {
      const el = document.getElementById(id);
      if (el) el.style.display = 'none';
    }

    // Google modal control
    btnShowGoogleModal?.addEventListener('click', () => openModal('googleLoginModal'));
    function closeGoogleLoginModal() { closeModal('googleLoginModal'); }

    // Language / Font modal wrappers (basic)
    function showLanguageModal() { openModal('languageModal'); }
    function setLanguageAndClose(lang) { setLanguage(lang); closeModal('languageModal'); }
    function closeLanguageModal() { closeModal('languageModal'); }

    function showFontModal() { openModal('fontModal'); }
    function closeFontModal() { closeModal('fontModal'); }
    function applyFontSettings() {
      // 간단한 예: 선택된 폰트/크기 적용 (구현 상세는 저장/복원 필요)
      closeFontModal();
    }

    // Simple modal management
    function closeManagementModal() { closeModal('managementModal'); }
    function showLocalBackupDialog() { alert('로컬 백업(더미)'); }
    function showGoogleBackupDialog() { alert('구글 백업(더미)'); }
    function showLocalRestoreDialog() { document.getElementById('restoreFile').click(); }
    function showGoogleRestoreDialog() { alert('구글 복원(더미)'); }
    function restoreData(e) { const f = e.target.files?.[0]; if (!f) return; const reader = new FileReader(); reader.onload = () => { try { const data = JSON.parse(reader.result); console.log('복원 데이터:', data); alert('복원 완료 (더미)'); } catch (err) { alert('파일 파싱 오류'); } }; reader.readAsText(f); }
    function exportAllDataExcel() { alert('엑셀 내보내기(더미)'); }

    // Simple UI navigation
    function hideAllSections() {
      document.getElementById('orderSection').style.display = 'none';
      document.getElementById('dashboardSection').style.display = 'none';
      document.getElementById('reservationSection').style.display = 'none';
      document.getElementById('statisticsSection').style.display = 'none';
      document.getElementById('dbManagementSection').style.display = 'none';
    }
    function showDashboard() { hideAllSections(); document.getElementById('dashboardSection').style.display = 'block'; }
    function showOrder() { hideAllSections(); document.getElementById('orderSection').style.display = 'block'; }
    function showReservation() { hideAllSections(); document.getElementById('reservationSection').style.display = 'block'; document.getElementById('menuListContainer').style.display = 'block'; }
    function showStatistics() { hideAllSections(); document.getElementById('statisticsSection').style.display = 'block'; }
    function showDBManagement() { hideAllSections(); document.getElementById('dbManagementSection').style.display = 'block'; }

    // Placeholder functions for many UI actions
    function saveStaffOrder() { alert('순번 저장(더미)'); }
    function addMenuRow() { alert('메뉴 행 추가(더미)'); }
    function updateAllMenuTimes() { /* noop */ }
    function addReservation() { alert('예약 추가(더미)'); }
    function showDailyStats() { alert('일간 통계(더미)'); }
    function showWeeklyStats() { alert('주간 통계(더미)'); }
    function showMonthlyStats() { alert('월간 통계(더미)'); }
    function showMenuSales() { alert('월간 메뉴 매출(더미)'); }
    function showMonthlySalesChart() { alert('월간 매출 그래프(더미)'); }
    function downloadExcel() { alert('엑셀 다운로드(더미)'); }
    function manageMenus(){ alert('메뉴 관리(더미)'); }
    function manageStaff(){ alert('직원 관리(더미)'); }
    function manageRooms(){ alert('방 관리(더미)'); }
    function manageCustomers(){ alert('고객 관리(더미)'); }
    function manageCurrency(){ alert('화폐 단위(더미)'); }
    function managePaymentMethods(){ alert('입금방식 관리(더미)'); }
    function manageGuarantee(){ alert('Guarantee 관리(더미)'); }
    function manageAdmins(){ alert('관리자 관리(더미)'); }

    // Language (very basic demo)
    function setLanguage(lang){
      // 실제 번역 맵을 연결하면 각 data-translate 요소의 innerText를 바꿉니다.
      console.log('setLanguage', lang);
      // 간단히 버튼 스타일 토글
      ['langKo','langEn','langTh','langVi'].forEach(id=>document.getElementById(id)?.classList?.remove('bg-blue-500','text-white'));
      if (lang === 'ko') document.getElementById('langKo')?.classList?.add('bg-blue-500','text-white');
      if (lang === 'en') document.getElementById('langEn')?.classList?.add('bg-blue-500','text-white');
      if (lang === 'th') document.getElementById('langTh')?.classList?.add('bg-blue-500','text-white');
      if (lang === 'vi') document.getElementById('langVi')?.classList?.add('bg-blue-500','text-white');
    }

    // Font settings (simple)
    function setFontSize(size){
      const body = document.body;
      if(size === 'small') body.style.fontSize = '12px';
      if(size === 'normal') body.style.fontSize = '16px';
      if(size === 'large') body.style.fontSize = '18px';
      if(size === 'xlarge') body.style.fontSize = '20px';
      if(size === 'xxlarge') body.style.fontSize = '22px';
    }
    function setFontFamily(family){ document.body.style.fontFamily = family; }

    // Login/logout with Supabase
    async function processLogin() {
      const email = loginUsername.value.trim();
      const password = loginPassword.value;
      if(!email || !password){ alert('이메일과 비밀번호를 입력하세요.'); return; }
      btnLogin.disabled = true;
      btnLogin.innerText = '로그인 중...';
      try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) {
          alert('로그인 실패: ' + error.message);
          console.error(error);
          btnLogin.disabled = false;
          btnLogin.innerText = '로그인';
          return;
        }
        // 로그인 성공
        console.log('로그인 성공:', data);
        onLoginChanged(data.user || (await supabase.auth.getUser()).data.user);
      } catch (err) {
        console.error(err);
        alert('로그인 중 오류 발생');
      } finally {
        btnLogin.disabled = false;
        btnLogin.innerText = '로그인';
      }
    }

    // Google login (UI-only placeholder) — 실제 OAuth 사용 시 supabase.auth.signInWithOAuth({...})
    async function processGoogleLogin() {
      const email = document.getElementById('googleEmail').value.trim();
      const pw = document.getElementById('googlePassword').value;
      if(!email || !pw){ alert('구글 이메일/비밀번호를 입력하세요.'); return; }
      // UI placeholder: simulate login by attempting signUp/signIn with provided email (not secure)
      try {
        const { data: signUpData, error: signUpErr } = await supabase.auth.signUp({ email, password: pw });
        if (signUpErr && signUpErr.message && !signUpErr.message.includes('User already registered')) {
          console.error(signUpErr);
        }
        // Try sign in
        const { data, error } = await supabase.auth.signInWithPassword({ email, password: pw });
        if (error) {
          alert('구글 로그인(흉내) 실패: ' + error.message + '\\n실제 구글 OAuth를 사용하려면 Supabase 프로젝트의 OAuth 설정이 필요합니다.');
          return;
        }
        closeGoogleLoginModal();
        onLoginChanged(data.user || (await supabase.auth.getUser()).data.user);
      } catch (err) {
        console.error(err);
        alert('구글 로그인 시도 중 오류');
      }
    }

    async function onLoginChanged(user) {
      if(!user){ // not logged in
        loginScreen.style.display = 'flex';
        mainScreen.style.display = 'none';
        return;
      }
      // show main screen
      loginScreen.style.display = 'none';
      mainScreen.style.display = 'block';
      // show user info
      const shopNameEl = document.getElementById('shopName');
      shopNameEl.innerText = user.email || user?.user_metadata?.full_name || 'My Massage Shop';
      // default show dashboard
      showDashboard();
      // load minimal data if needed — placeholders for now
      console.log('User logged in:', user);
    }

    async function logout(){
      await supabase.auth.signOut();
      // reset UI
      loginUsername.value = '';
      loginPassword.value = '';
      loginScreen.style.display = 'flex';
      mainScreen.style.display = 'none';
    }

    // Initialize: check session
    (async function init() {
      // wire login button
      btnLogin?.addEventListener('click', processLogin);

      // language default
      setLanguage('ko');

      // check existing session
      try {
        const { data } = await supabase.auth.getSession();
        const session = data?.session;
        if (session && session.user) {
          onLoginChanged(session.user);
        } else {
          loginScreen.style.display = 'flex';
          mainScreen.style.display = 'none';
        }
      } catch (err) {
        console.error('세션 확인 오류', err);
        loginScreen.style.display = 'flex';
        mainScreen.style.display = 'none';
      }

      // current time updater
      setInterval(()=> {
        const now = new Date();
        document.getElementById('currentTime').innerText = now.toLocaleTimeString();
      }, 1000);
    })();
  </script>

</body>
</html>
